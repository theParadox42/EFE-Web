var game={currentScene:"load",previousScene:"home",sceneIndex:0,sceneOrder:["load","home","wakeup","run","launchpad","build","rocketbuilt","fly-moon","moon","fly-mars","marslanding","fight","leavemars","fly-venus","ufo","won"],canSave:{run:true,launchpad:true,build:true,rocketbuilt:true,"fly-moon":true,moon:true,"fly-mars":true,marslanding:true,fight:true,leavemars:true,"fly-venus":true,ufo:true},hasPause:{wakeup:true,run:true,launchpad:true,build:true,rocketbuilt:true,"fly-moon":true,moon:true,"fly-mars":true,marslanding:true,fight:true,leavemars:true,"fly-venus":true,ufo:true,playlevel:true},reqControls:{run:true,build:true,"fly-moon":true,"fly-mars":true,fight:true,"fly-venus":true,ufo:true,playlevel:true},paused:false,loadFirstOnPlay:false,continue:function(){this.previousScene=this.currentScene;if(this.sceneOrder[this.sceneIndex+1]){if(typeof this.getFunc().reset=="function")this.getFunc().reset();this.sceneIndex++;this.currentScene=this.sceneOrder[this.sceneIndex];if(typeof this.getFunc().init=="function")this.getFunc().init()}else console.log("End of scenes")},setScene:function(t,i){if(!i){this.previousScene=this.currentScene;if(typeof this.getFunc().reset=="function")this.getFunc().reset()}if(typeof t=="number"){this.currentScene=this.sceneOrder[t]}else if(typeof t=="string"){this.currentScene=t}if(typeof this.getFunc().init=="function")this.getFunc().init();if(typeof t=="number"){this.sceneIndex=t}else{var e=this.sceneOrder.findIndex(function(t){return t==game.currentScene});this.sceneIndex=e>=1?e:0}},getFunc:function(){let t={load:loadFiles,home:Home,choose:ChooseUseSave,wakeup:wakeUpScene,run:runToRocket,launchpad:AtLaunchPad,build:buildRocket,rocketbuilt:RocketBuilt,"fly-moon":flyToMoon,moon:moon,"fly-mars":flyToMars,marslanding:marsLanding,fight:fightMartians,leavemars:leaveMars,"fly-venus":flyToVenus,ufo:ufoBossFight,won:Won,loadsaves:LoadSaves,levelbuilder:levelBuilder,communitylevels:communityLevels,playlevel:playLevel};if(t[this.currentScene]){return t[this.currentScene]}else{console.warn("Unknown scene: "+this.currentScene);this.setScene("home",true);return this.getFunc()}},pause:function(){push();this.paused=true;fill(0,0,0,180);noStroke();rect(0,0,width,height);this.minSide=this.minSide||min(min(width,height),imgs.playbtn.width*2)/2;noStroke();fill(255);ellipse(width/2,height/2-this.minSide*.3,this.minSide*1.1,this.minSide*1.1);rectMode(CENTER);stroke(0);strokeWeight(5);rect(width/2,height/2+this.minSide*.5,width/2,this.minSide*.2);if(this.canSave[this.currentScene]){rect(width/2,height/2+this.minSide*.8,width/2,this.minSide*.2)}textAlign(CENTER,CENTER);noStroke();fill(0);textFont(fonts.londrina);textSize(this.minSide*.15);text(this.currentScene=="playlevel"?"Back":"Home",width/2,height/2+this.minSide*.5);if(this.canSave[this.currentScene]){text("Save",width/2,height/2+this.minSide*.8);textSize(this.minSide*.05);fill(255);text("Going home also saves your progress",width/2,height-this.minSide*.05)}imageMode(CENTER);image(imgs.playbtn,width/2,height/2-this.minSide*.3,this.minSide,this.minSide);pop();if(!isMobile){this.pausedImage=get()}},displayPaused:function(){if(this.paused&&this.pausedImage){image(this.pausedImage,0,0,width,height)}else if(!this.paused){push();fill(255);noStroke();ellipse(25,25,45,45);image(imgs.pausebtn,5,5,40,40);pop()}else{console.log("Paused image not loaded...")}},updatePaused:function(){if(this.paused){if(dist(mouseX,mouseY,width/2,height/2-this.minSide*.3)<this.minSide*.55){cursor(HAND);if(clicked){this.paused=false}}else if(mouseX>width/4&&mouseX<width*3/4&&mouseY>height/2+this.minSide*.4&&mouseY<height/2+this.minSide*.6){cursor(HAND);if(clicked){if(this.currentScene!="playlevel")this.saveCurrentProgress();this.setScene(this.currentScene=="playlevel"?this.previousScene:"home")}}else if(this.canSave[this.currentScene]&&mouseX>width/4&&mouseX<width*3/4&&mouseY>height/2+this.minSide*.7&&mouseY<height/2+this.minSide*.9){cursor(HAND);if(clicked){this.saveProgress()}}}else{if(mouseX<50&&mouseY<50){cursor(HAND);if(clicked){this.pause();clicked=false}else if(pressed){pressed=false}}}},alreadyLoaded:false,saveCurrentProgress:function(){if(!this.canSave[this.currentScene])return;var t=this.saveProgress(null,true);localStorage.currentSave=JSON.stringify(t)},saveProgress:function(t,i){if(!this.canSave[this.currentScene])return console.log("Not a valid scene to save from");var e={};e.scene=t||this.currentScene;var s=0;switch(e.scene){case"run":s=loadRun.level;break;case"build":s=bGame.level;break}var h=new Date;e.date={year:h.getYear(),month:h.getMonth(),day:h.getDate(),hour:h.getHours(),minute:h.getMinutes()};if(typeof s!="undefined")e.data=s;if(i)return e;var r=JSON.parse(localStorage.saves||"[]");r.unshift(e);localStorage.saves=JSON.stringify(r)},retrieveCurrentProgress:function(){if(!localStorage.currentSave)return console.log("No saves found");var t;try{t=JSON.parse(localStorage.currentSave)}catch(t){return console.warn("Unparsable data type")}if(typeof t!="object")return console.warn("Not an object");return t},retrieveProgress:function(t,i){t=t||0;if(!localStorage.saves)return console.log("No saves found");var e;try{e=JSON.parse(localStorage.saves)}catch(t){return console.warn("Unparsable data type")}if(typeof e!="object"||!e.length)return console.warn("Not an array");if(i)return e;var s=e[t];if(typeof s!="object")return console.warn("Not an object");return s},loadProgress:function(t){var i=t?t:this.retrieveCurrentProgress();if(i.data){switch(i.scene){case"run":loadRun.level=i.data;break;case"build":bGame.level=i.data;break}}this.setScene(i.scene)},run:function(){if(this.hasPause[this.currentScene]){this.updatePaused();if(this.paused){this.displayPaused();resetInput();return}}else this.paused=false;if(isMobile&&this.reqControls[this.currentScene])updateMobile();this.getFunc()();if(isMobile&&this.reqControls[this.currentScene])displayMobile();resetInput();if(this.hasPause[this.currentScene])this.displayPaused()},init:function(){let t=this.sceneOrder.indexOf(function(t){return t==this.currentScene});this.sceneIndex=t>=0?t:this.sceneIndex;if(isMobile){createMobileControls()}if(typeof this.getFunc().init=="function"){this.getFunc().init()}},resize:function(){if(typeof this.getFunc().resize=="function"){this.getFunc().resize()}}};let keys={},keysReleased={};var clicked=false,pressed=false,canPress=true;function keyPressed(){keys[key]=true;keys[keyCode]=true}function keyReleased(){keys[key]=false;keys[keyCode]=false;keysReleased[key]=true;keysReleased[keyCode]=true}function mousePressed(){if(canPress){pressed=true;canPress=false}}function mouseReleased(){canPress=true;clicked=true}function resetInput(){keysReleased={};clicked=false;pressed=false}function setup(){createCanvas(windowWidth,windowHeight);background(255);angleMode(DEGREES);game.init()}function draw(){cursor("default");game.run()}function windowResized(){}function mobileControl(t,i,e,s,h,r){this.x=t;this.y=i;this.w=e;this.h=s;this.key=h;this.txt=r}mobileControl.prototype.update=function(){if(mouseX>this.x&&mouseX<this.x+this.w&&mouseY>this.y&&mouseY<this.y+this.h){if(mouseIsPressed){mouseIsPressed=false}if(pressed){keysReleased[this.key]=true;pressed=false}if(clicked){clicked=false}}keys[this.key]=false;for(var t=0;t<touches.length;t++){let i=touches[t].x;let e=touches[t].y;if(i>this.x&&i<this.x+this.w&&e>this.y&&e<this.y+this.h){keys[this.key]=true;break}}};mobileControl.prototype.display=function(){push();translate(this.x,this.y);fill(0,0,0,128);stroke(0,0,0,200);strokeWeight(5);rect(0,0,this.w,this.h);fill(255,255,255,128);textAlign(CENTER,CENTER);textFont(fonts.pixel);textSize(20);text(this.txt,this.w/2,this.h/2);pop()};let mobileControls=[];function createMobileControls(){let t=80;let i=t;let e=10;let s=2*e;let h=3*e;function r(e,s,h,r,a){let o=t;if(a){o=abs(a-e)}mobileControls.push(new mobileControl(e,s,o,i,h,r))}r(e,height-i-e,LEFT_ARROW,"<");r(s+t,height-i-e,DOWN_ARROW,"v");r(s+t,height-i*2-s,UP_ARROW,"^");r(h+t*2,height-i-e,RIGHT_ARROW,">");r(width-t-e,height-i-e,"x","X");r(width-t*2-s,height-i-e,"z","Z");r(s*2+t*3,height-i-e,32,"Space",width-t*2-h)}function updateMobile(){for(var t=0;t<mobileControls.length;t++){mobileControls[t].update()}}function displayMobile(){for(var t=0;t<mobileControls.length;t++){mobileControls[t].display()}}var isMobile=function(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}();{{function BBlock(t,i,e,s){this.x=t;this.y=i;this.w=e;this.h=s;this.img=imgs.garbage}BBlock.prototype.collide=function(t){let i=abs(t.vx),e=abs(t.vy);if(t.x+t.w+i+1>this.x&&t.x-i-1<this.x+this.w&&t.y+t.h+e>=this.y&&t.y-e<=this.y+this.h){if(t.x+t.w-i*2-1>this.x&&t.x+i*2+1<this.x+this.w){if(t.y+t.h/2>this.y+this.h/2){t.y=max(t.y,this.y+this.h);if(t.y<=this.y+this.h){t.vy=max(t.vy,0)}}else{t.y=min(t.y,this.y-t.h);if(t.y+t.h>=this.y){t.vy=min(t.vy,0);t.grounded=true}}}else if(t.y+t.h-e-1>this.y&&t.y+e+1<this.y+this.h){if(t.x+t.w/2>this.x+this.w/2){t.x=max(t.x,this.x+this.w);if(t.x<=this.x+this.w){t.vx=max(t.vx,0)}}else{t.x=min(t.x,this.x-t.w);if(t.x+t.w>=this.x){t.vx=min(t.vx,0)}}}}};BBlock.prototype.display=function(){image(this.img,this.x,this.y,this.w,this.h)};BBlock.prototype.run=function(t){if(t)this.collide(t);this.display()}}{function BAsphalt(t,i,e,s){BBlock.call(this,t,i,e,s);this.img=imgs.asphalt}BAsphalt.prototype=Object.create(BBlock.prototype)}{function BSpike(t,i,e,s){BBlock.call(this,t,i,e,s);this.img=imgs.spike;this.m=this.x+this.w/2}BSpike.prototype=Object.create(BBlock.prototype);BSpike.prototype.collide=function(t){var i=abs(t.vx),e=abs(t.vy);if(t.x+t.w-1-i>this.x&&t.x+1+i<this.x+this.w&&t.y+t.h-1>this.y&&t.y+1<this.y+this.h){if(t.x+t.w<this.x+this.w/2){if(t.y+t.h>map(t.x+t.w,this.x,this.m,this.y+this.h,this.y)){t.kill()}}else if(t.x>this.x+this.w/2){if(t.y+t.h>map(t.x,this.m,this.x+this.w,this.y,this.y+this.h)){t.kill()}}else{t.kill()}}};function BDSpike(t,i,e,s){BSpike.call(this,t,i,e,s)}BDSpike.prototype=Object.create(BSpike.prototype);BDSpike.prototype.collide=function(t){var i=abs(t.vx),e=abs(t.vy);if(t.x+t.w-1-i>this.x&&t.x+1+i<this.x+this.w&&t.y+t.h-1>this.y&&t.y+1<this.y+this.h){if(t.x+t.w<this.x+this.w/2){if(t.y<map(t.x+t.w,this.x,this.m,this.y,this.y+this.h)){t.kill()}}else if(t.x>this.x+this.w/2){if(t.y+t.h<map(t.x,this.m,this.x+this.w,this.y+this.h,this.y)){t.kill()}}else{t.kill()}}};BDSpike.prototype.display=function(){push();translate(this.x,this.y+this.h/2);scale(1,-1);image(this.img,0,-this.h/2,this.w,this.h);pop()}}{function BPlatform(t,i,e,s){BBlock.call(this,t,i,e,s);this.img=imgs.platform}BPlatform.prototype=Object.create(BBlock.prototype);BPlatform.prototype.collide=function(t){let i=abs(t.vx),e=abs(t.vy);if(t.x+t.w+i+1>this.x&&t.x-i-1<this.x+this.w&&t.y+t.h+e>this.y&&t.y-e<this.y+this.h){if(t.x+t.w-i*2-1>this.x&&t.x+i*2+1<this.x+this.w){if(t.y+t.h-e-1<this.y&&!(keys[DOWN_ARROW]||keys.s)&&t.vy>0){t.y=min(t.y,this.y-t.h);if(t.y+t.h>=this.y){t.vy=min(t.vy,0);if(t.vy>=0){t.grounded=true}}}}}}}{function BToxic(t,i,e,s){BBlock.call(this,t,i,e,s);this.img=imgs.toxic.clone()}BToxic.prototype=Object.create(BBlock.prototype);BToxic.prototype.collide=function(t){var i=abs(t.vx),e=abs(t.vy);if(t.x+t.w-1-i>this.x&&t.x+1+i<this.x+this.w&&t.y+t.h-1-e>this.y&&t.y+1+e<this.y+this.h){t.health-=5;t.vx*=.5;t.vy*=.7;t.tint.r-=40;t.tint.b-=40}};BToxic.prototype.display=function(){push();translate(this.x+this.w/2,this.y+this.h/2);drawAnimation(this.img,0,0,this.w,this.h);pop()}}{function BFire(t,i,e,s){BToxic.call(this,t,i,e,s);this.img=imgs.fire.clone()}BFire.prototype=Object.create(BToxic.prototype);BFire.prototype.collide=function(t){if(t.x+t.w-1>this.x&&t.x+1<this.x+this.w&&t.y+t.h-1>this.y&&t.y+1<this.y+this.h){t.health-=6;t.tint.g-=18;t.tint.b-=25}}}{function BRefinery(t,i,e,s){BBlock.call(this,t,i,e,s);this.img=imgs.refinery}BRefinery.prototype=Object.create(BBlock.prototype)}{function BSmoke(t,i,e,s){BToxic.call(this,t,i,e,s);this.img=imgs.smoke.clone()}BSmoke.prototype=Object.create(BToxic.prototype);BSmoke.prototype.collide=function(t){if(t.affectedBy.air)return;if(t.x+t.w>this.x&&t.x<this.x+this.w&&t.y+t.h>this.y&&t.y<this.y+this.h){t.affectedBy.air=true;t.vy-=.6}}}{function BWater(t,i,e,s){BBlock.call(this,t,i,e,s);this.img=imgs.water}BWater.prototype=Object.create(BBlock.prototype);BWater.prototype.collide=function(t){if(t.affectedBy.water)return;if(t.x+t.w>this.x&&t.x<this.x+this.w&&t.y+t.h>this.y&&t.y<this.y+this.h){t.tint.r-=10.5;t.tint.g-=10.2;if(t.tint.r<=0){t.health--}t.vx*=.75;t.vy*=.75;if((keys[32]||keys[" "]||keys[UP_ARROW]||keys.w)&&t.vy>1.4){t.vy-=20}t.affectedBy.water=true}}}{function BProton(t,i,e,s){BToxic.call(this,t,i,e,s);this.img=imgs.proton.clone();this.field=300;this.strength=1}BProton.prototype=Object.create(BToxic.prototype);BProton.prototype.collide=function(t){let i=dist(t.x+t.w/2,t.y+t.h/2,this.x+this.w/2,this.y+this.h/2);if(i<this.field){let e=map(i,0,this.field,2,0);let s=t.x+t.w/2-(this.x+this.w/2);let h=t.y+t.h/2-(this.y+this.h/2);let r=mag(s,h);s*=e/r;h*=e/r;if(s){t.vx+=s*this.strength}if(h){t.vy+=h*this.strength}if(typeof this.collide2=="function")this.collide2(t,i)}}}{function BBlackHole(t,i,e,s){BProton.call(this,t,i,e,s);this.img=imgs.blackhole.clone();this.field=300;this.strength=-2}BBlackHole.prototype=Object.create(BProton.prototype);BBlackHole.prototype.collide2=function(t,i){if(i<this.w/2+t.w/2){for(var e in t.tint){t.tint[e]-=20;t.health-=1;t.w*=.99,t.h*=.99}}}}}{{function BPortal(t,i,e,s){BBlock.call(this,t,i,e,s);this.img=imgs.portal;this.w*=2;this.h*=2}BPortal.prototype=Object.create(BBlock.prototype);BPortal.prototype.display=function(){push();imageMode(CENTER);translate(this.x+this.w/2,this.y+this.h/2);rotate(frameCount);image(this.img,0,0,this.w,this.h);pop()};BPortal.prototype.collide=function(t){if(t.x>this.x&&t.x+t.w<this.x+this.w&&t.y+t.h/2>this.y&&t.y<this.y+this.h){if(bGame.canPass){let i=.05;t.hasControl=false;t.w=lerp(t.w,0,i);t.h=lerp(t.h,0,i);t.vx=0;t.vy=0;t.x=lerp(t.x,this.x+this.w/2-t.w/2,i);t.y=lerp(t.y,this.y+this.h/2-t.h/2,i);t.r+=5}else{push();textAlign(CENTER,BOTTOM);textFont(fonts.pixel);textSize(30);fill(0,0,0);text("Collect all the parts!",t.x+t.w/2+2,t.y-3);fill(255,0,0);text("Collect all the parts!",t.x+t.w/2,t.y-5);pop()}}}}{function BSpawn(t,i,e,s){BBlock.call(this,t,i,e,s)}BSpawn.prototype=Object.create(BBlock.prototype);BSpawn.prototype.collide=function(){};BSpawn.prototype.display=function(){ellipse(this.x+this.w/2,this.y+this.h/2,this.w,this.h)}}{var BPart=[];BPart[0]=function(t,i,e,s){this.x=t;this.y=i;this.w=e;this.h=s;this.collectIndex=0;if(!this.img){this.img=imgs.rocketfin}this.imgw=this.imgw||this.img.width;this.imgh=this.imgh||this.img.height;if(max(this.imgw,this.imgh)==this.imgw){this.dw=this.w;this.dh=this.w*this.imgh/this.imgw}else{this.dh=this.h;this.dw=this.h*this.imgw/this.imgh}this.collected=false};BPart[0].prototype=Object.create(BBlock.prototype);BPart[0].prototype.display=function(){push();imageMode(CENTER);translate(this.x+this.w/2,this.y+this.h/2+sin(frameCount)*10-5);scale(cos(frameCount*5),1);image(this.img,0,0,this.dw,this.dh);pop()};BPart[0].prototype.collide=function(t){let i=abs(t.vx)*2,e=abs(t.vy)*2;if(t.x+t.w-i>this.x&&t.x+i<this.x+this.w&&t.y+t.h-e>this.y&&t.y+e<this.y+this.h){this.collected=true;t.collected.push(this.collectIndex)}};BPart[1]=function(t,i,e,s){this.img=imgs.rockettail;BPart[0].call(this,t,i,e,s);this.collectIndex=1};BPart[1].prototype=Object.create(BPart[0].prototype);BPart[2]=function(t,i,e,s){this.img=this.img||imgs.rocketengine;this.imgw=this.img.getWidth();this.imgh=this.img.getHeight();BPart[0].call(this,t,i,e,s);this.collectIndex=2};BPart[2].prototype=Object.create(BPart[0].prototype);BPart[2].prototype.display=function(){push();translate(this.x+this.w/2,this.y+this.h/2+sin(frameCount)*10-5);scale(cos(frameCount*5),1);drawAnimation(this.img,0,0,this.dw,this.dh);pop()};BPart[3]=function(t,i,e,s){this.img=imgs.rocketflame;BPart[2].call(this,t,i,e,s)};BPart[3].prototype=Object.create(BPart[2].prototype)}}{function BAir(t,i,e,s){BBlock.call(this,t,i,e,s);this.img=imgs.x}BAir.prototype=Object.create(BBlock.prototype);BAir.prototype.display=function(t){if(t)image(this.img,this.x,this.y,this.w,this.h)};BAir.prototype.collide=function(){}}let bGame={maps:[],map:[],current:{},blocks:[],buildings:[],player:null,level:0,bw:100,bh:100,h:0,w:0,sw:0,sh:0,key:{},scaleFactor:0,canPass:true,mode:"story",run:function(){var t=!this.player||!(this.player instanceof BPlayer);for(var i=0;i<this.buildings.length;i++){this.buildings[i].run(this.player)}push();noStroke();fill(255,50);rect(0,0,width,height);pop();push();scale(this.scaleFactor);if(!t){translate(this.player.getTransX(),0);this.player.update()}for(var i=this.blocks.length-1;i>-1;i--){var e=t?0:(this.blocks[i].x+this.player.transX)*this.scaleFactor;if(e+this.blocks[i].w*this.scaleFactor>-1&&e<width+1){this.blocks[i].run(this.player);if(this.blocks[i].collected){this.blocks.splice(i,1);this.canPass=true}}}if(!t)this.player.display();pop();if(!t){push();noStroke();fill(lerpColor(color(255,0,0),color(0,255,0),constrain(this.player.health/100,0,1)));rect(width-210,10,max(this.player.health,0)*2,50);noFill();stroke(0);strokeWeight(10);rect(width-210,10,200,50);pop()}},getConst:function(t){switch(t){case"a":return BAsphalt;break;case"#":return BBlock;break;case"r":return BRefinery;break;case"-":return BPlatform;break;case"'":return BSmoke;break;case"^":return BSpike;break;case"v":return BDSpike;break;case"~":return BWater;break;case"x":return BToxic;break;case"o":return BProton;break;case"0":return BBlackHole;break;case"f":return BFire;break;case"%":return BPortal;break;case"*0":return BPart[0];break;case"*1":return BPart[1];break;case"*2":return BPart[2];break;case"*3":return BPart[3];break;case"_":return BAir;break;default:return null;break}},init:function(){this.load()},next:function(){if(this.mode!="story"){game.setScene(this.gobackto);if(this.rawLevelObject.levelBuilderLevel){this.rawLevelObject.verified=true;levelBuilder.save()}return}this.level++;if(this.maps[this.level]){this.load()}else{game.continue()}},load:function(){this.mode=game.currentScene=="build"?"story":"freeplay";if(!this.maps[this.level]&&this.mode=="story")return;if(this.mode=="story"){this.map=this.maps[this.level].map}else if(!this.map)return;this.scaleFactor=height/this.map.length/this.bh;this.h=this.map.length*this.bh;this.w=this.map[0].length*this.bw;this.sw=1/this.scaleFactor*width;this.sh=1/this.scaleFactor*height;this.buildings=[];for(var t=0;t<20;t++){this.buildings.push(new BuildBuilding(random(width),random(2,6),random(height*3/4,height/2),~~random(imgs.buildings.length)))}this.buildings.sort(function(t,i){return i.z-t.z});this.reload()},reload:function(){this.blocks=[];this.player=null;this.canPass=true;for(var t=0;t<this.map.length;t++){for(var i=0;i<this.map[t].length;i++){let e=this.map[t][i];if(e=="*"){e+=this.maps[this.level].item;this.canPass=false}let s=i*this.bw;let h=t*this.bh;if(this.getConst(e)){this.blocks.push(new(this.getConst(e))(s,h,this.bw,this.bh))}if(e=="@"){this.player=new BPlayer(s,h+this.bh,this.bh*.75)}}}},reset:function(){this.level=0}};$.getJSON("/scripts/buildrocket/levels.json",function(t){bGame.maps=t.levels});function buildRocket(){background(200,225,255);bGame.run()}buildRocket.init=function(){bGame.init()};buildRocket.reset=function(){bGame.reset()};function BPlayer(t,i,e){this.vx=0;this.vy=0;this.img=imgs.player;this.w=e;this.h=this.w*this.img.height/this.img.width;this.x=t;this.y=i-this.h;this.grounded=false;this.hasControl=true;this.r=0;this.health=100;this.affectedBy={};this.collected=[];this.tint={r:255,g:255,b:255};this.transX=0;this.ptransX=this.transX;this.walkingFrame=0;this.isRunning=false}BPlayer.prototype.control=function(){if(keys[RIGHT_ARROW]||keys.d){this.vx+=5}if(keys[LEFT_ARROW]||keys.a){this.vx-=5}if((keys[UP_ARROW]||keys.w||keys[" "]||keys[32])&&this.grounded){this.vy-=17}else if((keys[DOWN_ARROW]||keys.s)&&!this.grounded){this.vy+=.2}};BPlayer.prototype.updateAnimation=function(){if(frameCount%8==0){if(this.grounded&&abs(this.vx)>.1){this.walkingFrame=(this.walkingFrame+1)%imgs.players.length;this.img=imgs.players[this.walkingFrame]}else{this.img=imgs.player}}};BPlayer.prototype.update=function(){this.updateAnimation();this.tint.r=constrain(this.tint.r+10,0,255);this.tint.g=constrain(this.tint.g+10,0,255);this.tint.b=constrain(this.tint.b+10,0,255);if(this.hasControl){this.control()}if(!this.grounded){this.vy+=.5}this.vx*=.7;this.vy*=.99;this.vx=constrain(this.vx,-15,15);this.vy=constrain(this.vy,-25,25);this.x+=this.vx;this.y+=this.vy;if(this.x<0){this.x=0;this.vx=max(this.vx,0)}else if(this.x+this.w>bGame.w){this.x=bGame.w-this.w;this.vx=min(this.vx,0)}if(this.y>bGame.h||this.health<0)this.kill();if(this.w<.5){bGame.next()}this.grounded=false;this.affectedBy={}};BPlayer.prototype.display=function(){push();translate(this.x+this.w/2,this.y+this.h/2);rotate(this.r);if(this.vx>=0)scale(-1,1);if(!isMobile)tint(this.tint.r,this.tint.g,this.tint.b);image(this.img,-this.w/2,-this.h/2,this.w,this.h);noTint();pop()};BPlayer.prototype.kill=function(){bGame.reload()};BPlayer.prototype.getTransX=function(t,i,e){this.ptransX=this.transX;var s=t?0:bGame.sw/3;var h=(t?i:0)||bGame.w;var r=(t?e:0)||bGame.sw;if(this.x<s){this.transX=0}else if(this.x<h-s*2){this.transX=-this.x+s}else if(r>h){this.transX=0}else{this.transX=-h+r}return this.transX||0};function AtLaunchPad(){AtLaunchPad.draw()}AtLaunchPad.draw=function(){this.update();background(100,200,255);push();noStroke();fill(100,120,120,100);for(var t=0;t<this.buildings.length;t++){var i=this.buildings[t];if(t/5==round(t/5)){rect(0,0,width,height)}image(i.img,i.x,i.y,i.w,i.h)}pop();push();translate(width/2,0);push();noStroke();fill(0,150,20);rect(-width/2-1,height-this.gh,width+2,this.gh+1);fill(0,50);var e=this.rocket.w*((this.rocket.y+700)/(this.rocket.oy+700));e=max(e,0);ellipse(this.rocket.x,this.rocket.oy-this.rocket.h/50,e,e/5);ellipse(this.player.x+this.player.w/2,this.player.y+this.player.h,this.player.w,this.player.w/5);pop();if(this.rocket.on){var s=this.rocket.w/2;drawAnimation(imgs.rocketflame,this.rocket.x,this.rocket.y-this.rocket.h/6,s,s*imgs.rocketflame.getHeight()/imgs.rocketflame.getWidth())}image(imgs.largerocket,this.rocket.x-this.rocket.w/2,this.rocket.y-this.rocket.h,this.rocket.w,this.rocket.h);push();translate(this.player.x,this.player.y);scale(-1,1);image(imgs.player,-this.player.w,0,this.player.w,this.player.h);pop();if(this.player.talking){push();fill(255);stroke(230);strokeWeight(5);textSize(30);textFont(fonts.pixel);var h=textWidth(this.player.text)+15,r=50;rect(this.player.x+this.player.w/2-h/2,this.player.y-r-15,h,r);fill(0);noStroke();textAlign(CENTER,CENTER);text(this.player.text,this.player.x+this.player.w/2,this.player.y-r/2-15);pop()}pop()};AtLaunchPad.update=function(){if(this.rocket.on){this.rocket.y-=20}switch(this.stage){case"runin":if(this.player.x<-width/6){this.player.x+=5;this.timedelay=0}else if(this.timedelay<50){this.timedelay++;this.rocket.x=noise(frameCount/12.7)*50-25}else{this.timedelay=0;this.stage="takeoff";this.rocket.on=true}break;case"takeoff":this.rocket.x=noise(frameCount/12.7)*50-25;if(this.rocket.y<-1e3){this.stage="idea";this.rocket.on=false;this.player.talking=true;this.timeDelay=0}break;case"idea":if(this.timeDelay<80){this.timeDelay++}else{this.player.ti++;this.timeDelay=0;if(this.player.ti>=this.player.texts.length){this.stage="runout";this.player.talking=false}else{this.player.text=this.player.texts[this.player.ti]}}break;case"runout":this.player.x+=8;if(this.player.x>width*1.1){game.continue()}break}};AtLaunchPad.init=function(){this.stage="runin";this.timeDelay=0;this.gh=50+height/5.7;this.rocket={x:0,y:height-100,w:height/4,h:height/1.3,on:false};this.rocket.oy=this.rocket.y;this.rocket.w=this.rocket.h*imgs.largerocket.width/imgs.largerocket.height;this.player={x:-width/2-100,y:height-150,h:100,texts:["Oh @!%#!","They just left!","But wait...","I bet they left enough stuff to build...","I bet they left enough stuff to build...","My own rocket!","I must go collect the parts"],text:"Oh @!%#!",ti:0};this.player.w=this.player.h*imgs.player.width/imgs.player.height;this.buildings=[];for(var t=-100;t<width+100;t+=90){var i=random(height/2,height*3/4);var e=imgs.buildings[~~random(imgs.buildings.length)];var s={img:e,x:t+random(50),y:height-this.gh-i,h:i,w:i*e.width/e.height};this.buildings.push(s)}this.buildings.sort(function(t,i){return t.h-i.h})};function leaveMars(){leaveMars.draw()}leaveMars.init=function(){this.background={img:imgs.marsbackground,x:0,y:0};this.background.aspect=this.background.img.width/this.background.img.height;let t=width/height;if(this.background.aspect>t){this.background.h=height;this.background.w=this.background.h*this.background.aspect}else{this.background.w=width;this.background.h=this.background.w*(1/this.background.aspect)}this.ground={img:imgs.marsarena,x:width/4,y:height*2/3,w:width,h:10};this.ground.h=this.ground.w*this.ground.img.height/this.ground.img.width;this.letter={img:imgs.letter,x:this.ground.x+this.ground.w/2,y:this.ground.y-5,w:100,h:100};this.letter.h=this.letter.w;this.letter.y-=this.letter.h;this.rock={img:imgs.marsrock,x:this.letter.x-20,y:this.ground.y,w:this.letter.w+80,h:1};this.rock.h=this.rock.w*this.rock.img.height/this.rock.img.width;this.rock.y-=this.rock.h;this.rocket={img:imgs.rocketOff,x:this.ground.x+30,y:this.ground.y,w:150,h:1};this.rocket.h=this.rocket.w*this.rocket.img.getHeight()/this.rocket.img.getWidth();this.rocket.ch=this.rocket.h*23/24;this.rocket.y-=this.rocket.ch;this.player={img:imgs.player,x:width*1.1,y:this.ground.y,w:this.rocket.w/2,h:1,display:true,s:1};this.player.h=this.player.w*this.player.img.height/this.player.img.width;this.player.y-=this.player.h;this.fuels=[];this.stage="walkin"};leaveMars.draw=function(){this.update();this.display()};leaveMars.update=function(){switch(this.stage){case"walkin":this.player.x-=5;var t=this.rocket.x+this.rocket.w*2;if(this.player.x<=t){this.player.x=t;this.stage="throwfuel";this.fuelThrown=0}break;case"throwfuel":if(frameCount%20==0&&this.fuelThrown<10){var i={img:imgs.fueltank,x:this.player.x+this.player.w/2,y:this.player.y+this.player.h/2,w:this.player.w*.8,vy:-this.player.h/20,vx:-this.player.w/20};i.h=i.w*i.img.height/i.img.width;i.y-=i.h/2;i.x-=i.w/2;this.fuels.push(i);this.fuelThrown++}else if(this.fuelThrown==10&&this.fuels.length==0){this.stage="goinrocket"}for(var e=this.fuels.length-1;e>-1;e--){var s=this.fuels[e];s.vy+=.39;s.x+=s.vx;s.y+=s.vy;if(s.x+s.w/2<this.rocket.x+this.rocket.w/2){this.fuels.splice(e,1)}}break;case"goinrocket":this.player.x-=5;if(this.player.x+this.player.w/2<this.rocket.x+this.rocket.w/2){this.player.display=false;this.stage="launch";this.rocket.img=imgs.rocketOn}break;case"launch":this.rocket.y-=20;if(this.rocket.y<-this.rocket.h*2){game.continue()}break}};leaveMars.displayObject=function(t){if(typeof t.img.getHeight=="function"){drawAnimation(t.img,t.x+t.w/2,t.y+t.h/2,t.w,t.h)}else{image(t.img,t.x,t.y,t.w,t.h)}};leaveMars.display=function(){this.displayObject(this.background);this.displayObject(this.rock);this.displayObject(this.letter);for(var t=0;t<this.fuels.length;t++){this.displayObject(this.fuels[t])}if(this.player.display){push();translate(this.player.x+this.player.w/2,this.player.y);scale(this.player.s,1);image(this.player.img,-this.player.w/2,0,this.player.w,this.player.h);pop()}this.displayObject(this.rocket);this.displayObject(this.ground)};function marsLanding(){marsLanding.draw()}marsLanding.init=function(){this.background={img:imgs.marsbackground,x:0,y:0};this.background.aspect=this.background.img.width/this.background.img.height;let t=width/height;if(this.background.aspect>t){this.background.h=height;this.background.w=this.background.h*this.background.aspect}else{this.background.w=width;this.background.h=this.background.w*(1/this.background.aspect)}this.ground={img:imgs.marsarena,x:width/4,y:height*2/3,w:width,h:10};this.ground.h=this.ground.w*this.ground.img.height/this.ground.img.width;this.letter={img:imgs.letter,x:this.ground.x+this.ground.w/2,y:this.ground.y-5,w:100,h:100};this.letter.h=this.letter.w;this.letter.y-=this.letter.h;this.largeletter={img:imgs.largeletter,x:0,y:0,w:min(width,height)-50,h:1,display:false};this.largeletter.h=this.largeletter.w;this.largeletter.x=width/2-this.largeletter.w/2;this.largeletter.y=height/2-this.largeletter.h/2;this.rock={img:imgs.marsrock,x:this.letter.x-20,y:this.ground.y,w:this.letter.w+80,h:1};this.rock.h=this.rock.w*this.rock.img.height/this.rock.img.width;this.rock.y-=this.rock.h;this.rocket={img:imgs.rocketOn,x:this.ground.x+30,y:-300,w:150,h:1};this.rocket.h=this.rocket.w*this.rocket.img.getHeight()/this.rocket.img.getWidth();this.rocket.collideH=this.rocket.h*23/24;this.working=1;this.stutterIndex=0;this.stutterTimer=5;this.stutterPath=[1,1,1,1,.3,1,1,1,.3,1,.3,.3,1,.3,.3,.3,0];this.player={img:imgs.player,x:this.rocket.x+this.rocket.w/4,y:this.ground.y,w:this.rocket.w/2,h:1,display:false,s:-1};this.player.h=this.player.w*this.player.img.height/this.player.img.width;this.player.y-=this.player.h;this.martian={img:imgs.martian,x:width/2,y:-5,w:150,h:1};this.martian.h=this.martian.w*this.martian.img.height/this.martian.img.width;this.martian.y-=this.martian.h;this.text=["Oh &@#$!","I'm out of fuel!","I better go find some..."];this.textIndex=0;this.textTime=100;this.textTimer=this.textTime;this.playertext=this.text[0];this.displaytext=false;this.stage="landing"};marsLanding.draw=function(){this.update();this.display()};marsLanding.update=function(){switch(this.stage){case"landing":this.rocket.y+=15;if(this.rocket.y+this.rocket.collideH>=this.ground.y){this.rocket.y=this.ground.y-this.rocket.collideH;this.stage="player";this.rocket.img=imgs.rocketOff;this.player.display=true}break;case"player":this.player.x+=5;if(this.player.x>=this.rock.x){this.player.x=this.rock.x+5;this.stage="letter";this.letterdelay=15;this.letter.y-=this.player.h/3}break;case"letter":if(this.letterdelay>0){this.letterdelay--}else if(!this.largeletter.display){this.largeletter.display=true}else if(clicked||keys[32]||keys[" "]){this.largeletter.display=false;this.stage="gotorocket";this.player.s=1;this.letter.y+=this.player.h/3}break;case"gotorocket":this.player.x-=5;if(this.player.x<=this.rocket.x){this.player.display=false;this.player.x=this.rocket.x+this.rocket.w/2-this.player.w/2;this.stage="checkfuel"}break;case"checkfuel":this.stutterTimer--;if(this.stutterTimer<=0){this.stutterTimer+=5;this.stutterIndex++;this.working=this.stutterPath[this.stutterIndex]}if(this.working>.5){this.rocket.img=imgs.rocketOn}else if(this.working<.1){this.stage="nofuel";this.player.display=true;this.player.s=-1}else{this.rocket.img=imgs.rocketOff}break;case"nofuel":if(this.player.x<this.rocket.x+this.rocket.w+15){this.player.x+=5}else{this.displaytext=true;this.textTimer--;if(this.textTimer<=0){this.textTimer=this.textTime;this.textIndex++;if(this.textIndex>=this.text.length){this.stage="leave";this.displaytext=false}else{this.playertext=this.text[this.textIndex]}}}break;case"leave":this.player.x+=5;if(this.player.x>width*1.1){this.stage="martian"}break;case"martian":if(this.martian.y+this.martian.h<this.ground.y){this.martian.y+=15;this.martian.y=min(this.martian.y,this.ground.y-this.martian.h)}else{this.martian.x+=5;if(this.martian.x>width*1.1){game.continue()}}break}};marsLanding.displayObject=function(t){image(t.img,t.x,t.y,t.w,t.h)};marsLanding.display=function(){this.displayObject(this.background);this.displayObject(this.ground);this.displayObject(this.rock);this.displayObject(this.letter);this.displayObject(this.martian);if(this.player.display){push();translate(this.player.x+this.player.w/2,this.player.y);scale(this.player.s,1);image(this.player.img,-this.player.w/2,0,this.player.w,this.player.h);pop()}drawAnimation(this.rocket.img,this.rocket.x+this.rocket.w/2,this.rocket.y+this.rocket.h/2,this.rocket.w,this.rocket.h);if(this.displaytext){push();fill(255);stroke(232);strokeWeight(2);textSize(25);textFont(fonts.pixel);var t=textAscent()+textDescent();textAlign(LEFT,TOP);rect(this.player.x-5,this.player.y-t-20,textWidth(this.playertext)+10,t+15);noStroke();fill(0);text(this.playertext,this.player.x,this.player.y-t-10);pop()}if(this.largeletter.display){push();noStroke();fill(0,80);rect(0,0,width,height);pop();this.displayObject(this.largeletter)}};function RocketBuilt(){RocketBuilt.draw()}RocketBuilt.init=function(){this.ground={y:height*5/6};this.buildings=[];for(var t=-100;t<width+100;t+=90){var i=random(height/2,height*3/4);var e=imgs.buildings[~~random(imgs.buildings.length)];var s={img:e,x:t+random(50),y:this.ground.y-i,h:i,w:i*e.width/e.height};this.buildings.push(s)}this.buildings.sort(function(t,i){return t.h-i.h});this.player={x:-100,y:this.ground.y+30,w:80,h:0,img:imgs.player,showing:true};this.player.h=this.player.w*this.player.img.height/this.player.img.width;this.player.y-=this.player.h;this.pieces=[{x:width/2-15,y:-100,w:100,img:imgs.rocketfin,falling:true,landY:this.ground.y+10},{x:width/2+30,y:-500,w:100,img:imgs.rocketengine.images[0],falling:true,landY:this.ground.y+25},{x:width/2+15,y:-200,w:100,img:imgs.rockettail,falling:true,landY:this.ground.y+50}];for(var t=0;t<this.pieces.length;t++){var h=this.pieces[t];h.h=h.w*h.img.height/h.img.width}this.light={x:width/2,y:height/2,w:width/100,h:height/100,a:255,on:false};this.rocket={img:imgs.rocketOff,built:false,x:width/2,y:this.ground.y+70,w:250,countdown:20};this.rocket.h=this.rocket.w*this.rocket.img.getHeight()/this.rocket.img.getWidth();this.rocket.y-=this.rocket.h;this.stage="enter"};RocketBuilt.draw=function(){this.update();this.display()};RocketBuilt.update=function(){switch(this.stage){case"enter":this.player.x+=5;if(this.player.x>width/3){this.stage="pieces"}break;case"pieces":var t=true;for(var i=0;i<this.pieces.length;i++){var e=this.pieces[i];if(e.falling){e.y+=15;if(e.y+e.h>e.landY){e.falling=false;e.y=e.landY-e.h}t=false}}if(t){this.stage="light";this.light.on=true}break;case"light":if(this.light.w>width*4){this.light.w=width*3;this.light.h=height*3;this.light.a=254;this.pieces=[];this.rocket.built=true}else if(this.light.a==255){this.light.w*=1.1;this.light.h*=1.1}else if(this.light.a<=0){this.stage="board"}else{this.light.a-=5}break;case"board":if(this.player.x+this.player.w/2<this.rocket.x+this.rocket.w/2){this.player.x+=5}else{this.stage="takeoff";this.rocket.img=imgs.rocketOn;2;this.player.showing=false}break;case"takeoff":if(this.rocket.countdown>0){this.rocket.countdown--}else if(this.rocket.y<-height){game.continue()}else{this.rocket.y-=20}break}};RocketBuilt.display=function(){background(100,200,255);push();noStroke();fill(100,120,120,100);for(var t=0;t<this.buildings.length;t++){var i=this.buildings[t];if(t/5==round(t/5)){rect(0,0,width,height)}image(i.img,i.x,i.y,i.w,i.h)}rect(0,0,width,height);fill(0,80,0);rect(0,this.ground.y,width,height-this.ground.y);pop();if(this.player.showing){push();translate(this.player.x+this.player.w/2,this.player.y);scale(-1,1);image(this.player.img,-this.player.w,0,this.player.w,this.player.h);pop()}for(var t=0;t<this.pieces.length;t++){var e=this.pieces[t];image(e.img,e.x,e.y,e.w,e.h)}if(this.rocket.built){drawAnimation(this.rocket.img,this.rocket.x+this.rocket.w/2,this.rocket.y+this.rocket.h/2,this.rocket.w,this.rocket.h)}if(this.light.on){push();noStroke();fill(255,this.light.a);ellipse(this.light.x,this.light.y,this.light.w,this.light.h);pop()}};function UfoCutScene(){UfoCutScene.draw()}UfoCutScene.init=function(){};UfoCutScene.update=function(){};UfoCutScene.display=function(){};UfoCutScene.draw=function(){this.update();this.display()};function wakeUpScene(){wakeUpScene.draw()}wakeUpScene.draw=function(){background(255);this.update();push();scale(1/this.c.s);translate(-this.c.tx,-this.c.ty);image(this.roomimg,0,0,this.rw,this.rh);image(imgs[this.openMouth?"newsclosed":"newsopen"],this.tv.x,this.tv.y,this.tv.w,this.tv.h);if(this.player.isSleeping){push();translate(this.player.tx,this.player.y);scale(-1,1);rotate(90);var t=this.rw/5;image(imgs.player,0,0,this.player.w,this.player.h);pop()}else{push();translate(this.player.tx,this.player.y);scale(-1,1);var t=this.rw/5;image(imgs.player,this.player.x,0,this.player.w,this.player.h);fill(0,50);noStroke();ellipse(this.player.x+this.player.w*.45,this.player.h*.99,this.player.w,this.player.w/4);pop()}this.textBox.run();pop()};wakeUpScene.update=function(){this.time++;this.mouthDelay--;if(this.mouthDelay<=0){this.openMouth=!this.openMouth;this.mouthDelay+=random(30,80)}if(this.time>30&&this.stage=="sleep"){this.stage="zoom";this.c.t=0}if(this.player.runAway){this.player.x-=8;if(this.player.x<-width)game.continue()}switch(this.stage){case"zoom":var t=.05;var i={x:this.tv.x-width*.1,y:this.tv.y-width*.05,s:3};i.s=1/i.s;this.c.t++;if(this.c.t<100){this.c.tx=lerp(this.c.tx,i.x,t);this.c.ty=lerp(this.c.ty,i.y,t);this.c.s=lerp(this.c.s,i.s,t)}else{this.stage="subtitles"}break;case"subtitles":this.textBox.show=true;this.c.t=0;break;case"zoomout":this.textBox.show=false;this.c.t++;if(this.c.t<100){var t=.05;this.c.tx=lerp(this.c.tx,0,t);this.c.ty=lerp(this.c.ty,0,t);this.c.s=lerp(this.c.s,1,t)}else{this.stage="###";this.textBox.show=true;this.player.isSleeping=false;this.player.y=this.rh*.52;this.player.x-=this.player.w}break;case"###":if(!this.textBox.show){this.stage="player"}break;case"player":this.textBox.show=false;this.player.runAway=true;break}};wakeUpScene.init=function(){this.time=0;this.stage="sleep";this.roomimg=imgs.homeroom;var t=this.roomimg;var i=t.width/t.height;var e=width/height;if(i<e){this.rw=width;this.rh=width/i}else{this.rh=height;this.rw=this.rh*i}var s={w:170,h:100,tv:{x:74,y:44,w:22,h:12}};var h=this.rw/s.w;this.tv={x:h*s.tv.x,y:h*s.tv.y,w:h*s.tv.w,h:h*s.tv.h};this.player={tx:this.rw*.38,x:0,y:this.rh*.58,w:this.rw/15,isSleeping:true};this.player.h=this.player.w*imgs.player.height/imgs.player.width;this.openMouth=false;this.mouthDelay=50;this.c={tx:0,ty:0,s:1};this.textBox.init();this.textBox.x=width/2-this.textBox.w/2;this.textBox.y=25;this.player.x=0};wakeUpScene.textBox={x:0,y:0,w:400,h:200,padding:10,text:"",textShowing:0,line:0,show:false,run:function(){if(this.show===true){if(this.textShowing>=this.text.length&&(keysReleased[" "]||keysReleased[32]||clicked)){this.line++;if(this.line==7){this.parent.stage="zoomout"}if(this.line<8){this.text=this.conversation[this.line];this.textShowing=0}else if(this.parent.stage=="###"){this.show=false;this.text=""}}else if(keysReleased[" "]||keysReleased[32]||clicked){this.textShowing=this.text.length}this.adjust();this.display();this.textShowing+=.5}},adjust:function(){var t=this.parent;if(t.stage=="subtitles"){this.x=t.tv.x-1;this.y=t.tv.y-1;this.w=t.tv.w+2;this.h=t.tv.h+2;this.ts=8;this.bg=color(0,200);this.st=color(0,0);this.tc=color(255,200);this.tst=color(0,0)}else if(t.stage=="###"){this.w=300;this.h=50;this.x=t.player.tx-t.player.x-this.w/2-t.player.w/2;this.y=t.player.y-this.h-this.padding;this.ts=20;this.bg=null;this.st=null;this.tc=null;this.tst=null}},display:function(){push();fill(this.bg||232);stroke(this.st||255);strokeWeight(5);rect(this.x,this.y,this.w,this.h);fill(this.tc||0);stroke(this.tst||255);strokeWeight(1);textFont(fonts.pixel);textSize(this.ts||15);if(this.line<9){text(this.text.substr(0,this.textShowing),this.x+this.padding,this.y+this.padding,this.w-this.padding*2,this.h-this.padding*2)}if(this.line===0&&this.textShowing>=this.text.length){text("Press space to continue",this.x+this.padding,this.y+this.h-this.padding)}pop()},init:function(){this.parent=wakeUpScene;this.x=width/2-this.w/2;this.y=height-this.h-20;this.line=0;this.text=this.conversation[this.line];this.show=false;this.textShowing=0}};wakeUpScene.textBox.conversation=["Clint Stinkwood: Good afternoon ladies and gentlemen, I'm Clint Stinkwood and I'm here in Los Angeles, at The News Show studio, a few miles away from the launch site of the Savior space shuttle.","Clint Stinkwood: We're just minutes away from the \"All aboard\" time, at which point the Savior will close all it's doors and prepare for launch.","Clint Stinkwood: It's been a long and hard journey to get to this point, the human race is no longer capable of remaining here on earth with all of the toxic waste that has filled our streets and cities.","Clint Stinkwood: After many years of trying to study and inventions, we are finally ready for the human race to make the epic journey to Mars on the Savior, where we will rebuild our civilization.","Clint Stinkwood: It's time to say goodbye to our once beautiful and colorful planet earth, and make way for a new era of cleanliness and save living once again!","Clint Stinkwood: I'm Clint Stinkwood on channel 953.673B, The News Show, and I'll see you next time on the planet Mars.","PLEASE NOTE THAT ANYONE NOT ON THE SAVIOR BY THE ALL ABOARD TIME WILL BE LEFT BEHIND. IF YOU HAVE NOT YET ENTERED THE SHUTTLE, PLEASE GET YOU AND YOUR FAMILY MEMBERS ONTO IT AS SOON AS POSSIBLE.","Tom: Oh @!%#! I gotta go!"];function MBullet(t,i,e){this.x=t;this.y=i;this.w=40;this.h=10;this.vx=e}MBullet.prototype.collide=function(t){let i=abs(this.vx);if(this.x+i>t.x&&this.x-i<t.x+t.w&&this.y+this.h/2>t.y&&this.y-this.h/2<t.y+t.h){t.kvx+=this.vx>0?15:-15;if(typeof t.jump=="function")t.jump();t.health--;this.dead=true}};MBullet.prototype.update=function(){this.x+=this.vx};MBullet.prototype.display=function(){noStroke();push();fill(200,225,255);rectMode(CENTER);rect(this.x,this.y,this.w,this.h);pop()};MBullet.prototype.run=function(t){for(var i=0;i<t.length;i++){this.collide(t[i])}this.update();this.display()};function MFuel(t,i,e){this.x=t;this.y=i;this.img=imgs.fueltank;this.w=e;this.h=this.w*this.img.height/this.img.width;this.collected=false}MFuel.prototype.collide=function(t){if(t.x+t.w>this.x&&t.x<this.x+this.w&&t.y+t.h>this.y&&t.y<this.y+this.h){this.collected=true;t.fuel++}};MFuel.prototype.display=function(){push();translate(this.x+this.w/2,this.y);scale(cos(frameCount*3),1);image(this.img,-this.w/2,0,this.w,this.h);pop()};MFuel.prototype.run=function(t){this.collide(t);this.display()};let mGame={player:null,martians:[],bullets:[],fuels:[],rocks:[],ground:{y:0,w:5e3,h:0,display:function(){push();imageMode(CENTER);image(this.img,0,this.y+this.h/2,this.w,this.h);pop()},collide:function(t){for(var i=0;i<t.length;i++){let e=t[i];let s=abs(e.vy)*2;if(e.x+e.w>-this.w/2&&e.x<this.w/2&&e.y+e.h+s/2>this.y&&e.y+e.h*.9-s<this.y){e.y=this.y-e.h;e.vy=min(e.vy,0);e.grounded=true}}}},background:{w:0,h:0,img:{}},transX:0,transY:0,timePassed:0,init:function(t){this.player=new MPlayer(-30,-200,60);this.ground.img=imgs.marsarena;this.ground.h=this.ground.w*this.ground.img.height/this.ground.img.width;this.background={img:imgs.marsbackground,x:0,y:0};this.background.aspect=this.background.img.width/this.background.img.height;let i=width/height;if(this.background.aspect>i){this.background.h=height+200*(1/this.background.aspect);this.background.w=this.background.h*this.background.aspect}else{this.background.w=width+200*this.background.aspect;this.background.h=this.background.w*(1/this.background.aspect)}this.bw=this.ground.w/40;if(typeof t=="object"){this.rocks=[];for(var e=0;e<t.length;e++){let i=t[e];if(typeof i.x=="string"){i.x=parseFloat(i.x)}if(typeof i.y=="string"){i.y=parseFloat(i.y)}this.rocks.push(new MRock(map(i.x,-100,100,-this.ground.w/2,this.ground.w/2-this.bw),i.y,this.bw))}}this.reload();this.freeplayLevel=null},reload:function(){this.player.reset();this.martians=[];this.martians.push(new Martian(-this.ground.w/2+50,-200,100));this.bullets=[];this.fuels=[];this.timePassed=0},reset:function(){this.player=new MPlayer(-30,-200,60);this.reload()},finish:function(){if(game.currentScene=="playlevel"){if(this.freeplayLevel&&this.freeplayLevel.levelBuilderLevel){this.freeplayLevel.verified=true;levelBuilder.save()}game.setScene(this.gobackto)}else{game.continue()}},run:function(){this.timePassed++;if(this.martians.length<constrain(map(this.timePassed,50,1e3,1,3),1,8)&&frameCount%180==0){if(this.player.x>0){this.martians.push(new Martian(random(-this.ground.w/2,-width/2-110),-200,100))}else{this.martians.push(new Martian(random(this.ground.w/2-100,width/2+110),-200,100))}}push();translate(map(this.transX,-this.ground.w/2,this.ground.w/2,-50,50)+width/2,map(this.transY,-height,height,-50,50)+height/2);imageMode(CENTER);image(this.background.img,0,0,this.background.w,this.background.h);pop();push();this.player.update();translate(this.transX+width/2,this.transY+height/2);this.ground.display();this.ground.collide([this.player].concat(this.martians));for(var t=this.martians.length-1;t>-1;t--){this.martians[t].run(this.player);if(this.martians[t].dead){this.martians.splice(t,1)}}for(var t=0;t<this.rocks.length;t++){this.rocks[t].run([this.player].concat(this.martians))}this.player.display();for(var t=this.bullets.length-1;t>-1;t--){this.bullets[t].run(this.martians);if(this.bullets[t].dead){this.bullets.splice(t,1)}}for(var t=this.fuels.length-1;t>-1;t--){this.fuels[t].run(this.player);if(this.fuels[t].collected){this.fuels.splice(t,1)}}pop();this.player.displayStatus()}};function fightMartians(){background(0);mGame.run()}fightMartians.init=function(t){mGame.init(t||mrocks)};function Martian(t,i,e){this.x=t;this.y=i;this.vx=0;this.kvx=0;this.vy=0;this.img=imgs.martian;this.w=e;this.h=this.w*this.img.height/this.img.width;this.maxHealth=random(1.5,2.5);this.health=this.maxHealth;this.dhealth=this.health;this.dead=false}Martian.prototype.jump=function(){if(this.grounded&&this.vy>=-.5){this.vy-=15;this.grounded=false}};Martian.prototype.collide=function(t){let i=abs(this.vx)+abs(t.vx),e=abs(this.vy)+abs(t.vy);if(this.x+this.w-i>t.x&&this.x+i<t.x+t.w&&this.y+this.h-e>t.y&&this.y+e<t.y+t.h){this.jump();t.damage();if(this.x+this.w/2>t.x+t.w/2){t.kvx-=25;this.kvs-=15}else{t.kvx+=25;this.kvs+=15}}};Martian.prototype.control=function(t){if(this.x>t.x+t.w){this.vx-=2.5}else if(this.x+this.w<t.x){this.vx+=2.5}else{this.jump()}};Martian.prototype.update=function(t){this.control(t);if(this.collision){this.jump();this.collision=false}if(!this.grounded){this.vy+=.5}this.vx*=.75;this.kvx*=.9;this.vy*=.99;this.x+=this.vx+this.kvx;this.y+=this.vy;this.grounded=false;if(this.health<=0){if(~~random(2)){mGame.fuels.push(new MFuel(this.x+this.w/8,this.y,this.w*6/8))}this.dead=true}if(this.y>height*1.5){this.dead=true}this.dhealth=lerp(this.dhealth,this.health,.1);if(this.y>height*3){this.dead=true}};Martian.prototype.display=function(){push();translate(this.x+this.w/2,this.y);push();if(this.vx>=0)scale(-1,1);image(this.img,-this.w/2,0,this.w,this.h);pop();if(this.health!=this.maxHealth){push();fill(lerpColor(color(200,0,0),color(0,200,0),this.dhealth/this.maxHealth));noStroke();rect(-this.w/2,-50,this.dhealth/this.maxHealth*this.w,30);stroke(100);strokeWeight(2);strokeCap(SQUARE);noFill();rect(-this.w/2,-50,this.w,30);pop()}pop()};Martian.prototype.run=function(t){this.collide(t);this.update(t);this.display()};function MPlayer(t,i,e){this.x=t;this.y=i;this.ox=this.x;this.oy=this.y;this.vx=0;this.kvx=0;this.vy=0;this.img=imgs.player;this.w=e;this.h=this.w*this.img.height/this.img.width;this.gun=imgs.moonGun;this.gun.w=this.w/2;this.gun.h=this.gun.w;this.fuelIcon=imgs.fueltank;this.heartIcon=imgs.pixelheart;this.maxlifes=3;this.lifes=this.maxlifes;this.maxHealth=6;this.health=this.maxHealth;this.dhealth=this.health;this.neededFuel=10;this.fuel=0;this.dfuel=this.fuel;this.reload=0;this.reloadTime=36;this.cooldownTime=30;this.cooldown=this.cooldownTime;this.direction=RIGHT}MPlayer.prototype.damage=function(){if(this.cooldown==0){this.health--;this.cooldown=this.cooldownTime}};MPlayer.prototype.control=function(){if(keys[RIGHT_ARROW]||keys.d){this.vx+=5;this.direction=RIGHT}if(keys[LEFT_ARROW]||keys.a){this.direction=LEFT;this.vx-=5}if((keys[UP_ARROW]||keys.w)&&this.grounded&&this.vy>-1){this.vy-=20;this.grounded=false}if((keys[32]||keys[" "])&&this.reload==0){this.reload=this.reloadTime;mGame.bullets.push(new MBullet(this.x+this.w/2,this.y+this.h/9+this.h/2,20*(this.direction==RIGHT?1:-1)+this.vx))}};MPlayer.prototype.update=function(){this.control();if(this.reload>0){this.reload--}if(this.cooldown>0){this.cooldown--}this.vy+=.5;this.vx*=.75;this.kvx*=.9;this.vy*=.99;this.x+=this.vx+this.kvx;this.y+=this.vy;var t=.2;mGame.transX=lerp(mGame.transX,constrain(-this.x,-mGame.ground.w,mGame.ground.w),t);mGame.transY=lerp(mGame.transY,max(-this.y-this.h/2,-height),t);if(this.y>height*1.5)this.health-=.2;if(this.health<=0){this.lifes--;if(this.lifes<=0){mGame.reset()}else{mGame.reload()}}this.grounded=false;if(this.fuel>=this.neededFuel){mGame.finish()}this.dfuel=lerp(this.dfuel,this.fuel,.1);this.dhealth=lerp(this.dhealth,this.health,.1)};MPlayer.prototype.display=function(){if(this.cooldown==0||frameCount%8<4){push();translate(this.x+this.w/2,this.y+this.h/2);if(this.direction==RIGHT)scale(-1,1);imageMode(CENTER);image(this.img,0,0,this.w,this.h);scale(-1,1);image(this.gun,-this.w/8,this.h/9,this.gun.w,this.gun.h);pop()}};MPlayer.prototype.displayStatus=function(){push();translate(width,0);push();noStroke();for(var t=0;t<this.lifes;t++){let i=50;image(this.heartIcon,-(t+1)*200/3+i/8-30,10,i,i)}fill(lerpColor(color(200,0,0),color(0,200,0),this.dhealth/this.maxHealth));rect(-230,70,this.dhealth/this.maxHealth*200,50);fill(200,120,0);rect(-230,130,this.dfuel/this.neededFuel*200,50);imageMode(CENTER);image(this.fuelIcon,-130,155,40*this.fuelIcon.width/this.fuelIcon.height,40);pop();push();stroke(100);strokeWeight(5);strokeCap(SQUARE);noFill();rect(-230,70,200,50);rect(-230,130,200,50);pop();pop()};MPlayer.prototype.reset=function(){this.x=this.ox;this.y=this.oy;this.vx=0;this.vy=0;this.health=this.maxHealth};function MRock(t,i,e){this.x=t;this.y=0;this.img=imgs.marsrock;this.w=e;this.h=this.w*this.img.height/this.img.width;this.y-=this.h*(i+1)}MRock.prototype.collide=function(t){let i=abs(t.vx)+abs(t.kvx),e=abs(t.vy);if(t.x+t.w+i+1>this.x&&t.x-i-1<this.x+this.w&&t.y+t.h+e>this.y&&t.y-e<this.y+this.h){if(t.x+t.w-i*2-1>this.x&&t.x+i*2+1<this.x+this.w){if(t.y+t.h/2>this.y+this.h/2){t.y=max(t.y,this.y+this.h);if(t.y<=this.y+this.h){t.vy=max(t.vy,0)}}else{t.y=min(t.y,this.y-t.h);t.vy=min(t.vy,0);if(t.vy>=0){t.grounded=true}}}else if(t.y+t.h-e-1>this.y&&t.y+e+1<this.y+this.h){if(t instanceof Martian){t.collision=true}if(t.x+t.w/2>this.x+this.w/2){t.x=max(t.x,this.x+this.w);if(t.x<=this.x+this.w){t.vx=max(t.vx,0);t.kvx=max(t.kvx,0)}}else{t.x=min(t.x,this.x-t.w);if(t.x+t.w>=this.x){t.vx=min(t.vx,0);t.kvx=min(t.kvx,0)}}}}};MRock.prototype.display=function(){push();image(this.img,this.x,this.y,this.w,this.h);pop()};MRock.prototype.run=function(t){for(var i=0;i<t.length;i++){this.collide(t[i])}this.display()};let mrocks=[{x:-100,y:0},{x:-99,y:.8},{x:-96,y:0},{x:-50,y:0},{x:-47,y:.2},{x:-44,y:0},{x:17,y:0},{x:20,y:0},{x:23,y:0},{x:22,y:.8},{x:18,y:.8},{x:20,y:1.6},{x:60,y:0},{x:62,y:.75},{x:64,y:1.5},{x:64.5,y:.75},{x:64.5,y:0},{x:80,y:0},{x:83,y:.5}];function Asteroid(t,i,e){this.x=t;this.y=i;this.radius=e;this.health=3;this.dead=false;this.frame=0}Asteroid.prototype.run=function(t){this.display();if(!this.dead){if(t)this.collide(t)}if(this.health<1){this.dead=true}};Asteroid.prototype.collide=function(t){let i=dist(this.x,this.y,t.x,t.y);let e=this.radius+(t.w+t.h)/4;if(i<e){this.dead=true;t.health--}for(var s in lasers){let t=lasers[s];i=dist(this.x,this.y,t.x,t.y);e=t.radius+this.radius;if(i<e){t.dead=true;this.health--}}};Asteroid.prototype.display=function(){if(this.dead){this.img=imgs.explosion[round(this.frame/2)];this.frame++}else{this.img=imgs.asteroid}push();imageMode(CENTER);image(this.img,this.x,this.y,this.radius*2,this.radius*2);pop()};let asteroids=[];function Laser(t,i,e,s,h){this.x=t+sin(e)*50;this.y=i-cos(e)*50;this.r=e;this.radius=10;this.speed=s;this.dead=false;this.belongsTo=h||"player"}Laser.prototype.run=function(){this.display();this.update()};Laser.prototype.update=function(){this.x+=this.speed*sin(this.r);this.y-=this.speed*cos(this.r)};Laser.prototype.display=function(){stroke(201,34,34);push();strokeWeight(this.radius);translate(this.x,this.y);rotate(this.r);line(0,0,0,this.radius);pop()};let lasers=[];var bosses=[];function loadLevel(t){flySigns=[];asteroids=[];bosses=[];for(var i in t.boss){bosses.push(new UfoBoss(t.boss[i][0],t.boss[i][1]))}for(var i in t.asteroids){let e=t.asteroids[i];asteroids.push(new Asteroid(e[0],e[1],e[2]))}ufos=[];for(var i in t.ufos){let e=t.ufos[i];ufos.push(new Ufo(e[0],e[1]*height/100))}}function loadDynamicLevel(t){flySigns=[];asteroids=[];ufos=[];bosses=[];if(t.asteroids){for(var i=0;i<t.asteroids.length;i++){let s=t.asteroids[i];for(var e=0;e<s.length;e++){if(typeof s[e]=="string"){s[e]=parseFloat(s[e])}}asteroids.push(new Asteroid(s[0]/100*height,s[1]/100*height,s[2]/200*height))}}if(t.ufos){for(var i=0;i<t.ufos.length;i++){let s=t.ufos[i];for(var e=0;e<s.length;e++){if(typeof s[e]=="string"){s[e]=parseFloat(s[e])}}ufos.push(new Ufo(s[0]/100*height,s[1]/100*height,s[2]/200*height))}}if(t.boss){for(var i=0;i<t.boss.length;i++){var s=t.boss[i];for(var e=0;e<s.length;e++){if(typeof s[e]=="string"){s[e]=parseFloat(s[e])}}bosses.push(new UfoBoss(s[0]/100*height,s[1]/100*height,s[2]/200*height))}}}function FlyPlayer(t,i){this.x=t;this.y=i;this.vx=0;this.vy=0;this.maxv=14;this.r=90;this.health=3;this.w=100;this.h=40;this.speed=5;this.rvel=0;this.offImg={};this.onImg={};this.shootCooldown=0;this.thrustCooldown=30}FlyPlayer.prototype.init=function(){this.offImg=imgs.rocketOff;this.onImg=imgs.rocketOn;this.h=this.w*this.onImg.getHeight()/this.onImg.getWidth()};FlyPlayer.prototype.run=function(){this.display();this.control();this.update();this.collide();if(this.health<1){game.getFunc().init()}};FlyPlayer.prototype.displayHealth=function(){push();stroke(94,94,94);strokeWeight(10);fill(0,0,0);rect(width-200,50,150,50);fill(39,183,20);noStroke();rect(width-200+5,55,map(this.health,0,3,0,140),40);pop()};FlyPlayer.prototype.update=function(){this.shootCooldown++;this.thrustCooldown++;this.r+=this.rvel;this.rvel*=.9;this.x+=this.vx;this.y+=this.vy;var t=mag(this.vx,this.vy);if(t>this.maxv){this.vx*=this.maxv/t;this.vy*=this.maxv/t}this.speed*=.9;this.speed=constrain(this.speed,-5,5);if(this.y-this.h/1.7>height){this.y-=height+this.h/1.8+this.h/1.7}else if(this.y+this.h/1.7<0){this.y+=height+this.h/1.8+this.h/1.7}};FlyPlayer.prototype.collide=function(){for(var t in lasers){var i=lasers[t];if(i.belongsTo!=="player"){let t=dist(this.x,this.y,i.x,i.y);let e=i.radius+(this.w+this.h)/4;if(t<e){i.dead=true;this.health--}}}};FlyPlayer.prototype.control=function(){if((keys[" "]||keys[32])&&this.thrustCooldown>30){this.speed+=.3;this.vx*=.8;this.vy*=.8;this.vx+=this.speed*sin(this.r);this.vy-=this.speed*cos(this.r)}else{this.vx*=.99;this.vy*=.99}if(keys.z&&this.shootCooldown>15){lasers.push(new Laser(this.x,this.y,this.r,20));this.shootCooldown=0}if(keys[RIGHT_ARROW]||keys.d){this.rvel+=.5}if(keys[LEFT_ARROW]||keys.a){this.rvel-=.5}if(keys.x){this.speed*=.8;this.vx*=.8;this.vy*=.8}};FlyPlayer.prototype.display=function(){push();imageMode(CENTER);translate(this.x,this.y);rotate(this.r);if(keys[" "]||keys[32]){drawAnimation(this.onImg,0,0,this.w,this.h)}else{drawAnimation(this.offImg,0,0,this.w,this.h)}pop()};let flyPlayer=new FlyPlayer(100,100);let stars=[];function displayStars(){for(var t=0;t<7e3;t+=imgs.stars.width*(height/imgs.stars.height)){push();translate(t,0);scale(height/imgs.stars.height);image(imgs.stars,0,0);pop()}}function drawStars(){push();noStroke();for(var t in stars){var i=stars[t];fill(255,255,255,i.a);ellipse(i.x,i.y,i.d,i.d)}pop()}function FlySign(t,i){this.x=t;this.w=600;this.h=350;this.y=height/2-this.h/2;this.txt=i;this.padding=100;this.img=imgs.spacesign.clone()}FlySign.prototype.display=function(t){push();drawAnimation(this.img,this.x+this.w/2,this.y+this.h/2,this.w,this.h);fill(0);noStroke();textSize(35);textFont(fonts.pixel);text(this.txt,this.x+this.padding,this.y+this.padding,this.w-this.padding*2,this.h-this.padding*2);pop()};let flySigns=[];function Ufo(t,i,e){this.x=t;this.y=i;this.radius=e||100;this.img=imgs.ufo.clone();this.w=this.radius*2;this.h=this.w*this.img.getHeight()/this.img.getWidth();this.radius=(this.w+this.h)/4;this.speed=5;this.health=2;this.frame=0}Ufo.prototype.run=function(t){this.display();if(!this.dead){if(t){this.collide(t);if(dist(this.x,this.y,t.x,t.y)<1e3)this.update(t)}}if(this.health<1){this.dead=true}};Ufo.prototype.update=function(t){if(this.x<t.x)this.x+=this.speed;if(this.x>t.x)this.x-=this.speed;if(this.y<t.y)this.y+=this.speed;if(this.y>t.y)this.y-=this.speed};Ufo.prototype.collide=function(t){let i=dist(this.x,this.y,t.x,t.y);let e=this.radius+(t.w+t.h)/4;if(i<e){this.dead=true;t.health--}for(var s in lasers){let t=lasers[s];i=dist(this.x,this.y,t.x,t.y);e=t.radius+this.radius;if(i<e){t.dead=true;this.health--}}};Ufo.prototype.display=function(){push();translate(this.x,this.y);if(this.dead){let t=imgs.explosion[~~(this.frame/2)];this.frame++;imageMode(CENTER);image(t,0,0,this.radius*2,this.radius*2)}else{drawAnimation(this.img,0,0,this.w,this.h)}pop()};let ufos=[];function buildPlatformer(){background(200,225,250);push();translate(0,buildPlatformer.itemBarHeight);scale(buildPlatformer.scaleFactor);if(buildPlatformer.player)translate(buildPlatformer.player.getTransX(true,buildPlatformer.w),0);buildPlatformer.displayGrid();for(var t in buildPlatformer.blocks){buildPlatformer.blocks[t].display()}pop();buildPlatformer.itemBar();if(mouseY>buildPlatformer.itemBarHeight){buildPlatformer.displayItem()}if(mouseIsPressed&&buildPlatformer.placing){buildPlatformer.placeItem();buildPlatformer.reload()}}buildPlatformer.init=function(){this.bw=100;this.bh=100;this.itemsKey=["_","a","#","r","-","'","^","v","~","x","o","0","f","%","player","pause","edit","left","right"];this.items=Array(this.itemsKey.length);this.itemPadding=width/100;this.iw=width/this.items.length-this.itemPadding*2;for(var t in this.itemsKey){var i=bGame.getConst(this.itemsKey[t]);if(i){this.items[t]=new i(0,0)}else{this.items[t]=new BuildMenuButton(this.itemsKey[t])}this.items[t].w=this.iw;this.items[t].h=this.iw;this.items[t].keyValue=this.itemsKey[t]}this.itemSpace=this.items.length*100;this.itemBarHeight=width/this.items.length;this.load();this.player=new BPlayer(0,0)};buildPlatformer.load=function(){var t=currentBuildingLevel.level;this.scaleFactor=(height-this.itemBarHeight)/(t.length*this.bh);this.h=t.length*this.bh;this.w=t[0].length*this.bw;this.sw=1/this.scaleFactor*width;this.sh=1/this.scaleFactor*height;this.reload()};buildPlatformer.reload=function(){this.blocks=[];var t=currentBuildingLevel.level;for(var i=0;i<t.length;i++){for(var e=0;e<t[i].length;e++){let s=t[i][e];let h=e*this.bw;let r=i*this.bh;if(bGame.getConst(s)){this.blocks.push(new(bGame.getConst(s))(h,r,this.bw,this.bh))}if(s=="@"){this.blocks.push(new BuildMenuButton("@",h,r,this.bw*.75,this.bw))}}}};buildPlatformer.placeItem=function(){var t=currentBuildingLevel.level;var i=(mouseY-this.itemBarHeight)/this.scaleFactor;var e=mouseX/this.scaleFactor-this.player.transX;if(mouseY<this.itemBarHeight)return;var s=floor(e/this.bw);var h=floor(i/this.bh);if(this.placingItem=="@"){for(var r=0;r<t.length;r++){for(var a=0;a<t[r].length;a++){if(t[r][a]=="@"){currentBuildingLevel.level[r]=currentBuildingLevel.level[r].replaceAt(a,"_")}}}}currentBuildingLevel.level[h]=currentBuildingLevel.level[h].replaceAt(s,this.placingItem);currentBuildingLevel.verified=false};buildPlatformer.itemBar=function(){push();fill(41,41,41,100);noStroke();rect(0,0,width,this.itemBarHeight);var t=0;for(var i in this.items){var e=this.items[i];var t=map(i,0,this.items.length,0,width);e.x=t+this.itemPadding;e.y=this.itemPadding;e.display(true);if(mouseX>e.x&&mouseX<e.x+e.w&&mouseY>e.y&&mouseY<e.y+e.h){cursor(HAND);if(clicked){if(e.notBlock){switch(e.type){case"pause":levelBuilder.pause();break;case"edit":levelBuilder.editStats();break;case"player":this.placing=true;this.placingItem="@";break}}else{this.placing=true;this.placingItem=this.itemsKey[i]}clicked=false}else if(mouseIsPressed){if(e.notBlock){if(e.type=="left"){this.player.x-=10}else if(e.type=="right"){this.player.x+=10}}}}}pop();if(keys[LEFT_ARROW]||keys.a){this.player.x-=10}else if(keys[RIGHT_ARROW]||keys.d){this.player.x+=10}this.player.x=constrain(this.player.x,0,this.w-this.sw)};buildPlatformer.displayGrid=function(){var t=currentBuildingLevel.level;for(var i in t){for(var e in t[i]){var s=e*this.bw;var h=i*this.bh;push();stroke(255,64);strokeWeight(2);noFill();rectMode(LEFT);rect(s,h,this.bw,this.bh);pop()}}};buildPlatformer.displayItem=function(){if(this.placing){var t=this.items.find(function(t){return t.keyValue==buildPlatformer.placingItem||t.keyValue=="player"&&buildPlatformer.placingItem=="@"});if(!t)return console.warn("No item to display");var i={x:t.x,y:t.y,w:t.w,h:t.h};var e=this.bh*1.2/t.h;t.w*=e;t.h*=e;t.x=mouseX-t.w/2;t.y=mouseY-t.h/2;t.display(true);for(var s in i){t[s]=i[s]}}};String.prototype.replaceAt=function(t,i){var e=this.split("");e[t]=i;return e.join("")};function BuildMenuButton(t,i,e,s,h){this.notBlock=true;this.x=i||0;this.y=e||0;this.type=t;this.img={};switch(t){case"pause":this.img=imgs.pausebtn;break;case"edit":this.img=imgs.editicon;break;case"player":this.img=imgs.player;break;case"@":this.img=imgs.player;break;case"left":this.img=imgs.leftarrow;break;case"right":this.img=imgs.rightarrow;break;default:this.img=imgs.x;break}if(t=="@"&&typeof s=="number"){this.w=s;this.h=this.img.height/this.img.width*this.w;this.bw=h}else{this.w=s||100;this.h=this.w}}BuildMenuButton.prototype.display=function(){push();var t=this.x+(this.w||this.bw)/2;translate(t,0);if(this.type=="@"||this.type=="player")scale(-1,1);translate(-t,0);imageMode(CORNER);let i=this.img;if(this.type=="@"){image(i,this.x,this.y+this.bw-this.h,this.w,this.h)}else if(this.type=="player"){var e=this.w*i.width/i.height;image(i,this.x+this.w/2-e/2,this.y,e,this.h)}else{image(i,this.x,this.y,this.w,this.h)}pop()};function communityLevels(){background(225);communityLevels.home.check();if(!communityLevels.hasLoaded){if(cLevels.length>0){communityLevels.hasLoaded=true;communityLevels.init()}push();textAlign(CENTER);fill(0);textFont(fonts.londrina);textSize(40);let t="";let i=frameCount%100;t+=i>25?i>50?i>75?"...":"..":".":"";text("Loading."+t,width/2,height/2);pop()}else{push();translate(0,100);scroller.update();let a=20;var t=a;var i=a;let o=communityDisplays[0].w;let l=communityDisplays[0].h;var e=floor(width/(o+a));var s=0;var h=0;for(var r=0;r<communityDisplays.length;r++){communityDisplays[r].draw(t,i);s++;t+=a+o;if(s>=e){t=a;s=0;if(r!=communityDisplays.length-1){i+=l+a;if(i+l>height-150){h=i+l-height+150+a}}}}scroller.maxY=-h;pop()}push();noStroke();fill(0,0,0,10);rect(0,95,width,10);fill(255);rect(0,0,width,100);textAlign(CENTER,BOTTOM);fill(0);textFont(fonts.arcade);textSize(50);stroke(200);strokeWeight(3);text("Community Levels",width/2,75);pop();push();fill(255);stroke(0);strokeWeight(5);textFont(fonts.bladerunner);textSize(25);communityLevels.home.display(color(0));pop()}communityLevels.hasLoaded=false;communityLevels.init=function(){communityLevels.home=new Button("Home",10,height-60,100,50,function(){game.setScene("home")});if(cLevels.length<=0||communityDisplays.length>0)return;var t=cLevels.filter(function(t){return t.featured});var i=cLevels.filter(function(t){return!t.featured});cLevels=t.concat(i);communityLevels.hasLoaded=true;for(var e=0;e<cLevels.length;e++){communityDisplays.push(new LevelDisplay(cLevels[e],200,250))}scroller.reset()};let scroller={x:0,y:0,ax:0,ay:0,update:function(){if(mouseY<200&&mouseY>100){this.y=min(this.y+map(mouseY,100,200,15,5),0)}else if(mouseY>height-100){this.y=max(this.y-map(mouseY,height,height-100,15,5),this.maxY||0)}if(keys[DOWN_ARROW]||keys.s){this.y=max(this.y-10,this.maxY||0)}if(keys[UP_ARROW]||keys.w){this.y=min(this.y+10,0)}this.ax=this.x;this.ay=this.y+100;translate(this.x,this.y)},reset:function(){this.x=0;this.y=0;this.ax=0;this.ay=0}};let cLevels=[];function getCommunityLevels(){var t="https://escape-from-earth.herokuapp.com/levels";$.getJSON(t,function(t){cLevels=t}).catch(function(){t="/scripts/levelbuilder/stashedcommunitylevels.json";$.getJSON(t,function(t){console.log("Failed to load external resource, stuck with local");communityLevels.level=t}).catch(function(t){console.log("Failed to load any community levels")})})}getCommunityLevels();setInterval(getCommunityLevels,1e4);function postLevel(t){t.waitingForUpdate=true;$.post("https://escape-from-earth.herokuapp.com/levels/new",t,function(t){getCommunityLevels();for(var i=0;i<levelsBuilt.length;i++){var e=levelsBuilt[i];if(e.waitingForUpdate){if(e.title==t.title&&e.creator==t.creator||e._id==t._id){levelsBuilt[i]=t;var e=levelsBuilt[i];e.waitingForUpdate=false;e.uploaded=true;console.log("Updated level _id");levelBuilder.save()}}}}).catch(function(t,i,e){console.log("Error posting new level");console.log(i);console.log(e)})}function LevelBuilderLevel(t,i,e,s){this.title=t||"New Level";this.creator=i||"Anonymous";this.type=e||"";this.difficulty=s||1;this.verified=false;this.uploaded=false;this.waitingForUpdate=false;this.levelBuilderLevel=true;switch(this.type){case"run":this.map="_______________%";break;case"build":this.level=["________________________","________________________","________________________","________________________","________________________","________________________","________________________"];break;case"space":this.objects={width:200,asteroids:[],ufos:[],boss:[]};break;case"mars":this.objects={blocks:[]};break}}LevelBuilderLevel.updateLevel=function(t,i,e,s,h){t.title=i||t.title;t.creator=e||t.creator;if(s){switch(t.type){case"run":var r=t.map.split("");while(r.length>s){r.pop();r[r.length-1]="%"}while(r.length<s){r.push("%");r[r.length-2]="_"}t.map=r.join("");break;case"build":if(h){while(t.level.length>h){t.level.pop()}while(t.level.length<h){var a=new Array(t.level[0].length);a.fill("_");t.level.push(a.join(""))}}if(s){while(t.level[0].length>s){for(var o=0;o<t.level.length;o++){t.level[o]=t.level[o].replaceAt(t.level[o].length-1,"")}}while(t.level[0].length<s){for(var o=0;o<t.level.length;o++){t.level[o]+="_"}}}break}}};function LevelDisplay(t,i,e,s){this.level=t;this.x=0;this.y=0;this.w=i;this.h=e;this.editable=s}LevelDisplay.prototype.go=function(){playLevel.setup(this.level,game.currentScene);console.log(this.level);game.setScene("playlevel")};LevelDisplay.prototype.check=function(){if(this.editable){if(mouseX>this.x+10&&mouseX<this.x+this.w-10){if(mouseY>max(this.y+this.w+50+scroller.ay,100)&&mouseY<this.y+this.w+90+scroller.ay){cursor(HAND);if(clicked){if(mouseX<this.x+this.w/2){this.go()}else{levelBuilder.openLevel(this.level.index)}}pressed=false,clicked=false}else if(this.level.verified){if(mouseY>max(this.y+this.w+100+scroller.ay,100)&&mouseY<this.y+this.w+140+scroller.ay&&mouseX>this.x+this.w/2+5){cursor(HAND);if(clicked){postLevel(this.level)}pressed=false,clicked=false}}}return}if(mouseX>this.x&&mouseX<this.x+this.w&&mouseY>max(100,this.y+scroller.ay)&&mouseY<this.y+scroller.ay+this.h){cursor(HAND);if(pressed){this.go();pressed=false}else if(clicked){clicked=false}}};LevelDisplay.prototype.display=function(){push();var t;switch(this.level.type){case"run":t=imgs.runthumb;break;case"build":t=imgs.buildthumb;break;case"space":t=imgs.spacethumb;break;case"mars":t=imgs.marsthumb;break;default:t=imgs.x;break}image(t,this.x,this.y,this.w,this.w);fill(this.level.featured?color(200,150,0):0);textAlign(LEFT,TOP);textFont(fonts.londrina);textSize(15);var i=textAscent()+textDescent();text(this.level.title,this.x+5,this.y+this.w+5,this.w-10,i);text(this.level.creator,this.x+5,this.y+this.w+5+i,this.w-10,i);if(this.editable){push();fill(245);strokeWeight(5);stroke(10);rect(this.x+10,this.y+this.w+50,this.w/2-15,40,5);rect(this.x+this.w/2+5,this.y+this.w+50,this.w/2-15,40,5);if(this.level.verified){rect(this.x+this.w/2+5,this.y+this.w+100,this.w/2-15,40,5)}fill(10);noStroke();textFont(fonts.londrina);textSize(12);textAlign(CENTER,CENTER);text("Play",this.x+5+this.w/4,this.y+this.w+70);text("Edit",this.x-5+this.w*3/4,this.y+this.w+70);if(this.level.verified){text("Upload",this.x-5+this.w*3/4,this.y+this.w+120)}fill(this.level.verified?color(0,200,0):color(200,0,0));textAlign(LEFT,CENTER);textSize(20);text(this.level.verified?"Verified":"Unverified",this.x+10,this.y+this.w+120);pop()}strokeWeight(5);noFill();stroke(0);rect(this.x,this.y,this.w,this.h,8);pop()};LevelDisplay.prototype.draw=function(t,i){this.x=t;this.y=i;this.check();this.display()};var communityDisplays=[],levelBuildDisplays=[];var levelsBuilt=JSON.parse(localStorage.myLevels||"[]");var currentBuildingLevel=null;function levelBuilder(){if(levelBuilder.isPaused)return levelBuilder.paused();if(levelBuilder.isEditingStats)return levelBuilder.editingStats();levelBuilder.getFunc()()}levelBuilder.getFunc=function(){switch(levelBuilder.building){case"run":return buildRunMap;break;case"build":return buildPlatformer;break;case"space":return buildSpaceLevel;break;case"mars":return buildArena;break;case"new":return createNewLevel;break;case"none":return levelBuilderMenu;break;default:levelBuilder.building="none";return levelBuilderMenu;break}};levelBuilder.setType=function(t){levelBuilder.building=t;if(typeof this.getFunc().init=="function")this.getFunc().init();this.save()};levelBuilder.addLevel=function(t){levelsBuilt.unshift(t);this.save();console.log("added a level")};levelBuilder.removeLevel=function(t){levelsBuilt.splice(t,1);this.save()};levelBuilder.openLevel=function(t){currentBuildingLevel=levelsBuilt[t];this.setType(currentBuildingLevel.type);currentBuildingLevel.levelBuilderLevel=true};levelBuilder.save=function(){for(var t=0;t<levelsBuilt.length;t++){levelsBuilt[t].index=t}localStorage.myLevels=JSON.stringify(levelsBuilt||"[]")};levelBuilder.pause=function(){this.isPaused=true;this.isEditingStats=false;push();resetMatrix();noStroke();fill(0,0,0,200);rect(0,0,width,height);pop();if(!isMobile){this.pausedImg=get()}};levelBuilder.paused=function(){push();resetMatrix();if(isMobile){background(80,80,80)}else{image(this.pausedImg,0,0,width,height)}fill(255);textFont(fonts.londrina);textSize(80);textAlign(CENTER,TOP);text(currentBuildingLevel.name,width/2,10);fill(245);stroke(10);strokeWeight(3);rect(width/4,100,width/2,80,20);rect(width/4,200,width/4-10,80,20);rect(width/2+10,200,width/4-10,80,20);rect(width/4,300,width/4-10,60,20);rect(width/2+10,300,width/4-10,60,20);noStroke();fill(10);textFont(fonts.londrina);textSize(50);textAlign(CENTER,CENTER);text("Resume",width/2,140);textSize(30);text("Save",width/4,240,width/4);text("Save & Quit",width/2+10,240,width/4-10);textSize(25);text("Delete Level",width/4,330,width/4);text("Play",width/2+10,330,width/4-10);pop();if(mouseX>width/4&&mouseX<width*3/4){if(mouseY>100&&mouseY<180){cursor(HAND);if(clicked){this.isPaused=false}}if(mouseX<width/2-10){if(mouseY>200&&mouseY<280){cursor(HAND);if(clicked){this.save()}}else if(mouseY>300&&mouseY<360){cursor(HAND);if(clicked){this.removeLevel(currentBuildingLevel.index);this.setType("none");this.isPaused=false}}}else if(mouseX>width/2+10){if(mouseY>200&&mouseY<280){cursor(HAND);if(clicked){this.save();this.setType("none");this.isPaused=false}}else if(mouseY>300&&mouseY<360){cursor(HAND);if(clicked){playLevel.setup(currentBuildingLevel,game.currentScene);game.setScene("playlevel");this.isPaused=false}}}}clicked=false};levelBuilder.editStats=function(){this.isEditingStats=true;this.isPaused=false;this.ei={};var t=this.ei;t.title=createInput(currentBuildingLevel.title,"text");t.title.attribute("placeholder","Title");t.title.position(width/4,50);t.title.style("width",width/2+"px");t.title.addClass("big-text");t.creator=createInput(currentBuildingLevel.creator,"text");t.creator.attribute("placeholder","Creator");t.creator.position(width/4,150);t.creator.style("width",width/2+"px");t.creator.addClass("big-text");var i,e,s,h,r,a;switch(currentBuildingLevel.type){case"run":i=true;e=10;s=currentBuildingLevel.map.length;break;case"build":i=true;e=15;s=currentBuildingLevel.level[0].length;h=true;r=6;a=currentBuildingLevel.level.length;break;case"space":i=true;e=200;s=currentBuildingLevel.objects.width;break}var o=250;if(i){t.width=createInput(s,"number");t.width.attribute("placeholder","Width");t.width.position(width/4,250);t.width.style("width",width/2+"px");t.minWidth=e;o+=80}if(h){t.height=createInput(a,"number");t.height.attribute("placeholder","Height");t.height.position(width/4,330);t.height.style("width",width/2+"px");t.minHeight=r;o+=80}t.submit=createButton("Save");t.submit.position(width/4,o);t.submit.style("width",width/4-10+"px");t.submit.mouseReleased(function(){t.waitFor.submit=true});t.cancel=createButton("Cancel");t.cancel.position(width/2+10,o);t.cancel.style("width",width/4-10+"px");t.cancel.mouseReleased(function(){t.waitFor.cancel=true});t.waitFor={};t.destroyInputs=function(){for(var i in t){if(typeof t[i]=="object"){if(typeof t[i].remove=="function")t[i].remove()}}}};levelBuilder.editingStats=function(){background(245);var t=this.ei;if(t.width){if(t.width.value()<t.minWidth){t.width.style("color","#ff0000")}else{t.width.style("color","#000000")}}if(t.height){if(t.height.value()<t.minHeight){t.height.style("color","#ff0000")}else{t.height.style("color","#000000")}}if(clicked){if(t.waitFor.submit){if(t.width){t.width.value(max(t.minWidth,t.width.value()))}if(t.height){t.height.value(max(t.minHeight,t.height.value()))}LevelBuilderLevel.updateLevel(currentBuildingLevel,t.title.value(),t.creator.value(),t.width?t.width.value():null,t.height?t.height.value():null);this.isEditingStats=false;t.destroyInputs();this.save();if(typeof this.getFunc().init=="function")this.getFunc().init()}else if(t.waitFor.cancel){this.isEditingStats=false;t.destroyInputs()}}};levelBuilder.init=function(){this.isPaused=false;this.isEditingStats=false;this.setType(levelBuilder.building||"none");levelBuilderMenu.init()};levelBuilder.createNew=function(){levelBuilder.building="new"};function buildArena(){buildArena.run()}buildArena.init=function(){this.dock={w:100,h:100,p:10,items:["pause","edit","switch"]};this.dock.w*=this.dock.items.length;this.background={img:imgs.marsbackground,x:0,y:0};this.background.aspect=this.background.img.width/this.background.img.height;let t=width/height;if(this.background.aspect>t){this.background.h=height;this.background.w=this.background.h*this.background.aspect}else{this.background.w=width;this.background.h=this.background.w*(1/this.background.aspect)}this.ground={img:imgs.marsarena,x:width/2,y:height*3/4,w:width*7/8};buildArena.updateBlocks();this.bw=mGame.bw;var i=new MRock(0,0,this.bw);this.bh=i.h;this.bm=this.ground.w/mGame.ground.w;this.sm=1/this.bm;this.mode="rock";this.constraints={x:{min:-100,max:100},y:{min:0,max:15}}};buildArena.updateBlocks=function(){mGame.init(currentBuildingLevel.objects.blocks);this.rocks=mGame.rocks};buildArena.run=function(){this.display();this.displayObjects();this.runDock();if(clicked){this.placeObject()}};buildArena.placeObject=function(){currentBuildingLevel.verified=false;if(this.mode=="rock"){var t=constrain(map(mouseX,this.ground.x-this.ground.w/2+this.bw*this.bm/2,this.ground.x+this.ground.w/2-this.bw*this.bm/2,-100,100),this.constraints.x.min,this.constraints.x.max);var i=constrain(map(mouseY+this.bh*this.bm/2,this.ground.y,this.ground.y-this.bh*this.bm,0,1),this.constraints.y.min,this.constraints.y.max);currentBuildingLevel.objects.blocks.push({x:t,y:i})}else{for(var e=this.rocks.length-1;e>-1;e--){var s=this.rocks[e].x;var h=this.rocks[e].y;var r=s+this.rocks[e].w;var a=h+this.rocks[e].h;s*=this.bm;h*=this.bm;r*=this.bm;a*=this.bm;s+=this.ground.x;h+=this.ground.y;r+=this.ground.x;a+=this.ground.y;if(mouseX>s&&mouseX<r&&mouseY>h&&mouseY<a){currentBuildingLevel.objects.blocks.splice(e,1)}}}this.updateBlocks()};buildArena.display=function(){image(this.background.img,0,0,this.background.w,this.background.h);image(this.ground.img,this.ground.x-this.ground.w/2,this.ground.y,this.ground.w,this.ground.w*this.ground.img.height/this.ground.img.width);var t=map(this.constraints.y.max+1,0,1,this.ground.y,this.ground.y-this.bh*this.bm);push();fill(0,100);noStroke();beginShape();vertex(0,0);vertex(width,0);vertex(width,height);vertex(0,height);vertex(0,0);vertex(this.ground.x-this.ground.w/2,t);vertex(this.ground.x-this.ground.w/2,this.ground.y);vertex(this.ground.x+this.ground.w/2,this.ground.y);vertex(this.ground.x+this.ground.w/2,t);vertex(this.ground.x-this.ground.w/2,t);endShape();pop()};buildArena.displayObjects=function(){push();translate(this.ground.x,this.ground.y);scale(this.bm);for(var t=0;t<this.rocks.length;t++){this.rocks[t].display()}pop()};buildArena.runDock=function(){push();noStroke();fill(200,150);rect(0,0,this.dock.w,this.dock.h,this.dock.p);var t=this.dock.p,i=this.dock.p,e=this.dock.w/this.dock.items.length-this.dock.p*2,s=this.dock.h-this.dock.p*2;for(var h=0;h<this.dock.items.length;h++){var r=this.dock.items[h];var a={pause:"pausebtn",edit:"editicon",switch:this.mode=="rock"?"marsrock":"x"};if(typeof imgs[a[r]]=="object"){image(imgs[a[r]],t,i,e,s)}if(mouseX>t&&mouseX<t+e&&mouseY>i&&mouseY<i+s){cursor(HAND);if(clicked){if(r=="switch"){this.mode=this.mode=="rock"?"x":"rock"}else{var o={pause:"pause",edit:"editStats"};if(typeof levelBuilder[o[r]]=="function"){levelBuilder[o[r]]()}}}}t+=this.dock.w/this.dock.items.length}if(mouseX<this.dock.w&&mouseY<this.dock.h){pressed=false,clicked=false}pop()};function levelBuilderMenu(){background(225);levelBuilderMenu.home.check();if(levelsBuilt.length<=0){push();textAlign(CENTER,BOTTOM);fill(0);textFont(fonts.londrina);textSize(40);text("You don't have any levels",width/2,height/2-60);pop();push();fill(255);stroke(0);strokeWeight(5);textFont(fonts.londrina);textSize(25);levelBuilderMenu.newLevel.draw(color(0));pop()}else if(levelBuildDisplays.length>0){push();translate(0,100);scroller.update();let o=20;var t=o;var i=o;let l=levelBuildDisplays[0].w;let n=levelBuildDisplays[0].h;var e=floor(width/(l+o));var s=0;var h=0;for(var r=-1;r<levelBuildDisplays.length;r++){if(r==-1){push();fill(240);strokeWeight(5);stroke(10);rect(t,i,l,n,o);push();strokeWeight(10);var a=min(l,n/2)/4;line(t+l/2-a,i+n/4,t+l/2+a,i+n/4);line(t+l/2,i+n/4-a,t+l/2,i+n/4+a);pop();textFont(fonts.londrina);textSize(25);noStroke();fill(10);textAlign(CENTER,CENTER);text("New Level",t,i+n/4+a,l,n*3/4-a);if(mouseX>t&&mouseX<t+l&&mouseY>max(100,scroller.ay+i)&&mouseY<max(i+n+scroller.ay)){cursor(HAND);if(clicked){clicked=false;levelBuilderMenu.newLevel.func()}}pop()}else{levelBuildDisplays[r].draw(t,i)}s++;t+=o+l;if(s>=e){t=o;s=0;if(r!=communityDisplays.length-1){i+=n+o;if(i+n>height-150){h=i+n-height+150+o}}}}scroller.maxY=-h;pop()}else{levelBuilderMenu.createDisplays()}push();noStroke();fill(0,0,0,10);rect(0,95,width,10);fill(255);rect(0,0,width,100);textAlign(CENTER,BOTTOM);fill(0);textFont(fonts.arcade);textSize(50);stroke(200);strokeWeight(3);text("Level Builder",width/2,75);pop();push();fill(255);stroke(0);strokeWeight(5);textFont(fonts.bladerunner);textSize(25);levelBuilderMenu.home.display(color(0));pop()}levelBuilderMenu.init=function(){this.home=new Button("Home",10,height-60,100,50,function(){game.setScene("home")});this.newLevel=new Button("New Level",width/2-100,height/2-30,200,60,function(){levelBuilder.building="new";createNewLevel.init()});this.createDisplays();scroller.reset()};levelBuilderMenu.createDisplays=function(){levelBuildDisplays=[];for(var t=0;t<levelsBuilt.length;t++){levelBuildDisplays.push(new LevelDisplay(levelsBuilt[t],200,350,true))}};function createNewLevel(){background(255);localStorage.author=inputs.creator.value();if(createNewLevel.waitForRelease&&clicked){clicked=false;createLevel()}}createNewLevel.init=function(){this.waitForRelease=false;inputs.name=createInput("New Level","text");inputs.name.position(width/4,50);inputs.name.addClass("big-text");inputs.name.attribute("placeholder","Level Name");inputs.name.style("width",width/2+"px");inputs.creator=createInput(localStorage.author||"Anonymous","text");inputs.creator.position(width/4,150);inputs.creator.addClass("big-text");inputs.creator.attribute("placeholder","Creator");inputs.creator.style("width",width/2+"px");inputs.type=createSelect("run");inputs.type.position(width/4,250);inputs.type.style("width",width/2+"px");inputs.type.option("Run","run");inputs.type.option("Platformer","build");inputs.type.option("Space","space");inputs.type.option("Mars","mars");inputs.submit=createButton("Create!");inputs.submit.position(width/4,320);inputs.submit.style("width",width/2+50+"px");inputs.submit.mouseReleased(function(){createNewLevel.waitForRelease=true})};function createLevel(){levelBuilder.addLevel(new LevelBuilderLevel(inputs.name.value(),inputs.creator.value(),inputs.type.value()));levelBuilder.openLevel(0);levelBuilder.setType(inputs.type.value());inputs.destroyAll();clicked=false}var inputs={};inputs.destroyAll=function(){for(var t in inputs){if(typeof inputs[t]!="function"){inputs[t].remove()}}};function playLevel(){let t=playLevel.level;switch(t.type){case"run":runToRocket();break;case"build":buildRocket();break;case"space":FlyFreeplay();break;case"mars":fightMartians();break;default:game.setScene("home");break}}playLevel.init=function(){let t=playLevel.level;switch(t.type){case"run":loadRun.init();break;case"build":bGame.init();break;case"space":FlyFreeplay.init();break;case"mars":fightMartians.init(t.objects.blocks);mGame.freeplayLevel=t;break;default:game.setScene("home");break}};playLevel.level={};playLevel.gobackto="communitylevels";playLevel.setup=function(t,i){playLevel.level=t;let e=playLevel.level;switch(e.type){case"run":loadRun.current=e;loadRun.gobackto=i;break;case"build":bGame.rawLevelObject=e;bGame.map=e.level;bGame.gobackto=i;break;case"space":FlyFreeplay.set(e,i);break;case"mars":mGame.gobackto=i;break;default:game.setScene("communitylevels");break}};function buildRunMap(){background(200,225,250);if(typeof currentBuildingLevel!="object")return levelBuilder.setType("none");if(typeof buildRunObjs.length!="number")buildRunMap.update();push();translate(runPlayer.transX,0);runGround.display();for(var t=0;t<buildRunObjs.length;t++){var i=buildRunObjs[t];i.display()}push();stroke(0);strokeWeight(2);for(var t=0;t<currentBuildingLevel.map.length+1;t++){line(t*runObstacleWidth,0,t*runObstacleWidth,height)}pop();if(currentBuildingLevel.map.length>=10){push();fill(240);strokeWeight(5);stroke(10);var e=(currentBuildingLevel.map.length-1)*runObstacleWidth;var s=runObstacleWidth;var h=10;rect(e+5,h,s-10,s-10);strokeWeight(7);line(e+15,h+(s-10)/2,e+s-15,h+(s-10)/2);mouseX-=runPlayer.transX;if(mouseX>e+5&&mouseX<e+s-10&&mouseY>h&&mouseY<h+s-10){cursor(HAND);if(clicked){clicked=false;buildRunMap.menu.popMap()}}mouseX+=runPlayer.transX;pop()}pop();runPlayer.updateTranslate(true,currentBuildingLevel.map);buildRunMap.menu.runItems();if(clicked){buildRunMap.menu.handleClick()}}var buildRunObjs=null;buildRunMap.init=function(){this.carrying="x";runPlayer.reset();runPlayer.x=0;runGround.init();this.menu.init()};buildRunMap.menu={carrying:"_",items:{},paused:false,pause:function(){resetMatrix();push();fill(0,0,0,150);noStroke();rect(0,0,width,height);pop();this.pausedImg=get();this.paused=true},update:function(){buildRunObjs=[];var t=currentBuildingLevel.map;for(var i=0;i<t.length;i++){switch(t[i]){case"x":buildRunObjs.push(new RunTrash(i*runObstacleWidth));break;case"c":buildRunObjs.push(new RunCar(i*runObstacleWidth));break;case"^":buildRunObjs.push(new RunSpike(i*runObstacleWidth));break;case"l":buildRunObjs.push(new RunStreetLight(i*runObstacleWidth));break}}},getDockDimensions:function(){var t=this.items.length*this.iconSize+this.items.length*this.padding,i=this.padding*2+this.iconSize,e=width/2-t/2,s=this.padding;return{x:e,y:s,w:t,h:i}},runItems:function(){var t,i;push();fill(255,200);noStroke();var e=this.getDockDimensions();rect(e.x,e.y,e.w,e.h,this.padding);var s=0;for(var h in this.items){if(h=="length")continue;var r=map(s,0,this.items.length,e.x+this.padding,e.x+e.w-this.padding);image(this.items[h].img,r+(this.iconSize-this.items[h].w)/2,e.y+this.padding+(this.iconSize-this.items[h].h)/2,this.items[h].w,this.items[h].h);if(mouseX>r&&mouseX<r+this.iconSize&&mouseY>e.y+this.padding&&mouseY<e.y+e.h-this.padding){cursor(HAND);if(clicked){if(h=="pause"){t=true}else if(h=="edit"){i=true}else{this.carrying=h}clicked=false}}s++}pop();var a={cy:height/2,w:175,h:175};push();rectMode(CENTER);fill(255,200);noStroke();rect(0,a.cy,a.w*2,a.h,20);rect(width,a.cy,a.w*2,a.h,20);pop();var o=5;if(keys[RIGHT_ARROW]||keys.d){runPlayer.x+=o}if(keys[LEFT_ARROW]||keys.a){runPlayer.x-=o}if(mouseIsPressed){o*=3}if(mouseY>a.cy-a.h/2&&mouseY<a.cy+a.h/2){if(mouseX<a.w){if(clicked){clicked=false}runPlayer.x-=o}else if(mouseX>width-a.w){runPlayer.x+=o;if(clicked){clicked=false}}}if(t)return levelBuilder.pause();if(i)return levelBuilder.editStats();if(mouseX>e.x&&mouseX<e.x+e.w&&mouseY>e.y&&mouseY<e.y+e.h){clicked=false}else{cursor("none");var l=this.items[this.carrying];image(l.img,mouseX-l.w/2,mouseY-l.h/2,l.w,l.h)}},popMap:function(){var t=currentBuildingLevel.map.split("");t.pop();if(t[t.length-1]=="="){t[t.length-2]="_"}t[t.length-1]="%";currentBuildingLevel.map=t.join("");this.update()},handleClick:function(){this.placeBlock();this.verified=false},placeBlock:function(){var t=floor((mouseX-runPlayer.transX)/runObstacleWidth);var i=currentBuildingLevel.map.split("");if(i[t]=="="){i[t-1]="_"}else if(i[t]=="c"){i[t+1]="_"}i[t]=this.carrying;if(this.carrying=="c"){i[t+1]="="}currentBuildingLevel.map=i.join("");if(currentBuildingLevel.map[currentBuildingLevel.map.length-1]!="%"){currentBuildingLevel.map+="%"}this.update()},init:function(){this.padding=20;this.iconSize=80;this.update();var t={x:"trash","^":"spike",l:"streetlight",c:"brokenCar",_:"x",pause:"pausebtn",edit:"editicon"};this.items={};this.items.length=0;for(var i in t){this.items[i]={img:imgs[t[i]]};if(this.items[i].img.width>this.items[i].img.height){this.items[i].w=this.iconSize;this.items[i].h=this.iconSize*this.items[i].img.height/this.items[i].img.width}else{this.items[i].h=this.iconSize;this.items[i].w=this.iconSize*this.items[i].img.width/this.items[i].img.height}this.items.length++}}};function buildSpaceLevel(){buildSpaceLevel.run()}buildSpaceLevel.init=function(){this.objects=currentBuildingLevel.objects;this.dock={w:150,h:height,p:10,items:["asteroids","ufos","boss","x","pause","edit","left","right","+","-"]};this.nm=height/100;this.loadObjects();this.carrying="asteroids";this.carryingsize=25;this.tx=0};buildSpaceLevel.loadObjects=function(){flyPlayer=new FlyPlayer(50,height/2);flyPlayer.init();this.w=this.objects.width*this.nm;loadDynamicLevel(this.objects)};buildSpaceLevel.runDock=function(){push();fill(50,200);rect(0,0,this.dock.w,this.dock.h);var t=this.dock.p;var i=height/this.dock.items.length-this.dock.p*2;var e=this.dock.w-this.dock.p*2;var s=e/i;noStroke();for(var h=0;h<this.dock.items.length;h++){var r=null;switch(this.dock.items[h]){case"asteroids":r=imgs.asteroid;break;case"ufos":r=imgs.ufo.images[0];break;case"boss":r=imgs.ufoboss;break;case"x":r=imgs.x;break;case"pause":r=imgs.pausebtn;break;case"edit":r=imgs.editicon;break;case"left":r=imgs.leftarrow;break;case"right":r=imgs.rightarrow;break;case"+":r=imgs.plussign;break;case"-":r=imgs.minussign;break}if(r){var a=r.width;var o=r.height;var l=r.width/r.height;if(l<s){a*=i/o;o=i;image(r,this.dock.p+e/2-a/2,t,a,o)}else{o*=e/a;a=e;image(r,this.dock.p+e/2-a/2,t,a,o)}}if(mouseX>this.dock.p&&mouseX<this.dock.p+e&&mouseY>t&&mouseY<t+i){cursor(HAND);if(clicked){clicked=false;var n=this.dock.items[h];if(n=="asteroids"||n=="ufos"||n=="boss"||n=="x"){this.carrying=n}else{switch(n){case"pause":levelBuilder.pause();break;case"edit":levelBuilder.editStats();break}}}else if(mouseIsPressed){switch(this.dock.items[h]){case"left":this.tx-=30;break;case"right":this.tx+=30;break;case"+":this.carryingsize++;break;case"-":this.carryingsize--;break}this.carryingsize=constrain(this.carryingsize,5,80)}}t+=i+this.dock.p*2}pop();if(keys[LEFT_ARROW]||keys.a){this.tx-=30}if(keys[RIGHT_ARROW]||keys.d){this.tx+=30}if(clicked){if(mouseX<this.dock.w){clicked=false}}};buildSpaceLevel.displayObjects=function(){push();background(0,0,0);this.transX=0;var t=this.w;if(flyPlayer.x>0&&flyPlayer.x<t){this.transX=-flyPlayer.x}else if(flyPlayer.x>t){this.transX=-t}translate(this.transX,0);displayStars();for(var i=0;i<asteroids.length;i++){asteroids[i].display()}for(var i=0;i<ufos.length;i++){ufos[i].display()}for(var i=0;i<bosses.length;i++){bosses[i].display()}pop()};buildSpaceLevel.display=function(){push();translate(this.dock.w,0);this.displayObjects();pop();this.displayHoldingObject()};buildSpaceLevel.displayHoldingObject=function(){var t=this.carryingsize*this.nm,i=null;switch(this.carrying){case"asteroids":i=imgs.asteroid;break;case"ufos":i=imgs.ufo.images[0];break;case"boss":i=imgs.ufoboss;break;case"x":i=imgs.x;break}if(mouseX>this.dock.w){if(clicked){this.placeObject()}if(i){push();imageMode(CENTER);image(i,mouseX,mouseY,t,t*i.height/i.width);pop()}}if(i&&!isMobile){push();tint(255,255,255,100);image(i,width-t,0,t,t*i.height/i.width);pop()}};buildSpaceLevel.run=function(){this.display();this.runDock();this.tx=constrain(this.tx,0,this.w-width+this.dock.w);flyPlayer.x=this.tx};buildSpaceLevel.placeObject=function(){var t=mouseX-this.dock.w-this.transX;var i=mouseY;if(this.objects[this.carrying]&&this.objects[this.carrying]instanceof Array){var e=t/height*100;var s=i/height*100;this.objects[this.carrying].push([e,s,this.carryingsize])}else if(this.carrying=="x"){for(var h in this.objects){if(typeof this.objects[h]=="object"&&this.objects[h]instanceof Array){for(var r=this.objects[h].length-1;r>-1;r--){var a=this.objects[h][r];var o=a[0]*this.nm;var l=a[1]*this.nm;var n=a[2]*this.nm||100;if(dist(t,i,o,l)<n){this.objects[h].splice(r,1)}}}}}this.loadObjects();currentBuildingLevel.verified=false};function loadSpecial(){loadAnimation();imgs.explosion=Array(11);let t="0";for(var i=0;i<imgs.explosion.length;i++){if(i>9){t=""}imgs.explosion[i]=loadImage("/art/space/explosion/"+t+i+".png")}imgs.buildings=Array(7);for(var i=0;i<imgs.buildings.length;i++){imgs.buildings[i]=loadImage("/art/earth/buildings/0"+i+".png")}imgs.players=Array(5);for(var i=0;i<imgs.players.length;i++){var e=i;if(i==0){e=""}imgs.players[i]=loadImage("/art/earth/player/player"+e+".png")}}function drawAnimation(t,i,e,s,h){if(!t){return console.warn("No animation provided")}push();translate(i,e);scale(s/t.getWidth(),h/t.getHeight());animation(t,0,0);pop()}let imgs={},fonts={};function loadFiles(){fileLoader.run()}loadFiles.init=function(){fileLoader.loadAll()};let fileLoader={loaded:0,loadProgress:0,needed:0,neededTypes:0,loadIndex:0,loading:"animations",typeIndex:0,counter:0,timeNeeded:0,order:["animations","fonts","images"],paths:{fonts:[],images:[],animations:[]},onLoad:function(t){fileLoader.loaded++},failed:function(t){console.warn("File didn't load. Error was: "+t+"\nContinuing");fileLoader.onLoad()},loadOne:function(){if(this.loadIndex>=this.paths[this.loading].length){this.loadIndex=0;this.typeIndex++;if(this.typeIndex>=this.neededTypes){return true}this.loading=this.order[this.typeIndex]}let t=this.loading=="fonts"?fonts:imgs;let i=this.loading=="animations"?loadAnimation:this.loading=="images"?loadImage:loadFont;let e,s,h,r,a;e=this.paths[this.loading][this.loadIndex];name=this.paths.names[this.loading][this.loadIndex];if(this.loading=="animations"){s=e[1];h=e[2]}else{s=e;h=fileLoader.onLoad;r=fileLoader.failed}if(r){t[name]=i(s,h,r)}else{t[name]=i(s,h)}if(this.loading=="animations"){this.onLoad();t[name].frameDelay=e[0]||4}this.loadIndex++;return false},loadAll:function(){frameRate(30);loadSpecial();while(!this.loadOne()){}},update:function(){this.loadProgress=min(this.loadProgress+.01,this.loaded/this.needed);if(this.loaded<this.needed){this.loadProgress=this.loaded/this.needed;this.counter++}else if(this.timeNeeded==0){this.timeNeeded=this.counter;this.counter=0}else{this.counter++;this.loadProgress=this.counter/this.timeNeeded}if(this.loadProgress>=1){frameRate(60);game.continue(true)}},display:function(){background(0);push();textAlign(CENTER);fill(255);textSize(50);text("Loading "+this.loading+"...",width/2,height/2);stroke(255);strokeWeight(5);rect(width/2-200,height/2+50,this.loadProgress*400,50,10);push();noFill();rect(width/2-200,height/2+50,400,50,10);pop();pop()},run:function(){this.update();this.display()}};$.getJSON("/scripts/load/files.json",function(t){fileLoader.paths=t;for(var i in t){if(i!="names"){for(var e in t[i]){fileLoader.needed++}}}for(var i in t.names){fileLoader.neededTypes++}});function RunBuilding(t,i,e,s){this.x=t;this.y=runGround.y-e;this.z=i;this.vx=1/this.z;this.img=imgs.buildings[s];this.w=e*this.img.width/this.img.height;this.h=e}RunBuilding.prototype.update=function(t){this.x-=this.vx*(t.ptransX-t.transX);if(this.x+this.w+10<0){this.x+=width+this.w+15}else if(this.x-10>width){this.x-=width+this.w+15}};RunBuilding.prototype.display=function(){push();image(this.img,this.x,this.y,this.w,this.h);pop()};RunBuilding.prototype.run=function(t){if(t)this.update(t);this.display()};function BuildBuilding(t,i,e,s){RunBuilding.call(this,t,i,e,s);this.y=height-e;this.vx*=bGame.scaleFactor}BuildBuilding.prototype=Object.create(RunBuilding.prototype);function RunCar(t){this.x=t;this.img=imgs.brokenCar;this.w=runObstacleWidth*2;this.h=this.w*this.img.height/this.img.width;this.y=runGround.y-this.h}RunCar.prototype.display=function(){image(this.img,this.x,this.y,this.w,this.h)};RunCar.prototype.collide=function(t){let i=abs(t.vx),e=abs(t.vy);if(t.x+t.w+i>this.x&&t.x-i<this.x+this.w&&t.y+t.h+e>this.y){if(t.y+t.h-e*2-1<this.y){t.y=min(t.y,this.y-t.h);t.vy=min(t.vy,0);t.grounded=true}if(t.x+t.w+i>this.x&&t.x+t.w<=this.x+i){t.vx=constrain(t.vx,-100,0);t.x=this.x-t.w}}};RunCar.prototype.run=function(t){var i=this.x+runPlayer.transX;if(i+runPlayer.vx+this.w>0&&i-runPlayer.vx<width){this.collide(t);this.display()}};function RunCloud(t){this.x=t;this.y=random(60,120);this.vx=random(-3,3);this.z=random(1.5,4);this.zvx=1/this.z;this.img=imgs.cloud.clone();this.w=random(230,350);this.h=this.w*this.img.getHeight()/this.img.getWidth()}RunCloud.prototype.update=function(t){this.x-=this.zvx*(t.ptransX-t.transX)+this.vx;if(this.x+this.w+10<0){this.x+=width+this.w+15}else if(this.x-10>width){this.x-=width+this.w+15}};RunCloud.prototype.display=function(){push();drawAnimation(this.img,this.x,this.y,this.w,this.h);pop()};RunCloud.prototype.run=function(t){this.update(t);this.display()};function RunGround(){this.y=0;this.h=100;this.particles=[]}RunGround.prototype.init=function(){this.stroke=color(0,160,50);this.strokeWeight=10;this.fill=color(80,50,0);this.y=height-this.h;this.reset()};RunGround.prototype.reset=function(){this.particles=[];for(var t=0;t<width*this.h/5e3;t++){this.particles[t]={x:random(width),y:random(this.h-this.strokeWeight)+this.y+this.strokeWeight,w:random(15,30),sat:random(80,100)}}};RunGround.prototype.display=function(){push();translate(-runPlayer.transX,0);stroke(this.stroke);strokeWeight(this.strokeWeight);fill(this.fill);rect(-25,this.y+this.strokeWeight/2,width+50,this.h+this.strokeWeight);pop();push();noStroke();for(var t=0;t<this.particles.length;t++){var i=this.particles[t];fill(i.sat,i.sat*.8,0,100);rect(i.x,i.y,i.w,i.w,5);if(i.x+i.w<-runPlayer.transX){i.x+=i.w*2+width}}pop()};let runGround=new RunGround;function runToRocket(){background(200,225,255);for(var t=0;t<runScenery.length;t++){runScenery[t].run(runPlayer)}fill(255,255,255,60);rect(0,0,width,height);push();translate(runPlayer.transX,0);for(var t=0;t<runSigns.length;t++){runSigns[t].display(runPlayer)}runPlayer.run();runGround.display();for(var t=0;t<runObstacles.length;t++){runObstacles[t].run(runPlayer)}pop()}runToRocket.init=function(){loadRun.init()};runToRocket.reload=function(){loadRun.reload()};runToRocket.reset=function(){loadRun.reset()};function RunNext(t){this.x=t}RunNext.prototype.collide=function(t){if(t.x>this.x){t.controlTrans=false;if(t.x>this.x+width){loadRun.next()}}};RunNext.prototype.run=function(t){this.collide(t)};let runObstacles=[],runSigns=[],runScenery=[];var loadRun={level:0,maps:[],current:{},map:"",key:{},buildings:20,clouds:3,hasLoaded:false,mode:"story",init:function(){this.mode=game.currentScene=="run"?"story":"freeplay";if(this.maps.length==0&&this.mode=="story"){return null}runGround.init();runPlayer.init();this.txtKey={j:'Click, Space, UP or "W" to jump!',f:"Use the arrow keys to move faster/slower",d:"S/DOWN to duck"};this.key={c:RunCar,x:RunTrash,"^":RunSpike,l:RunStreetLight,"%":RunNext};this.load();this.hasLoaded=true},load:function(){if(!this.maps[this.level]&&this.maps.length!=0&&this.mode=="story")return game.continue();if(this.mode!="story"&&!this.current)return false;if(this.mode=="story"){this.current=this.maps[this.level]}this.map=this.current.map;this.signs=this.current.txt;this.reload()},reload:function(){runPlayer.reset();runGround.reset();runScenery=[];runSigns=[];runObstacles=[];for(var t=0;t<this.map.length;t++){var i=t*runObstacleWidth;var e=this.key[this.map[t]];if(e)runObstacles.push(new e(i))}if(this.signs){for(var t=0;t<this.signs.length;t++){var s=this.txtKey[this.signs[t]];if(s)runSigns.push(new RunSign(t*runObstacleWidth,s))}}for(var t=0;t<this.buildings;t++){runScenery.push(new RunBuilding(random(-200,width+200),random(2,6),random(400,500),~~random(imgs.buildings.length)))}for(var t=0;t<this.clouds;t++){runScenery.push(new RunCloud(random(-200,width+200)))}runScenery.sort(function(t,i){return i.z-t.z})},next:function(){if(this.mode=="story"){this.level++;this.load()}else{game.setScene(this.gobackto);if(this.current.levelBuilderLevel){this.current.verified=true;levelBuilder.save()}}},reset:function(){this.level=0}};var runObstacleWidth=100;$.getJSON("/scripts/runtorocket/runmap.json",function(t){loadRun.maps=t.levels});function RunPlayer(t,i){this.x=t;this.ox=t;this.y=i;this.w=50;this.h=this.w;this.slowSpeed=6;this.normalSpeed=10;this.fastSpeed=15;this.vx=this.normalSpeed;this.gvx=this.vx;this.vy=0;this.mvx=5;this.mvy=20;this.transX=0;this.ptransX=this.transX;this.controlTrans=true;this.grounded=false;this.ducking=false;this.walkingFrame=0}RunPlayer.prototype.init=function(){this.img=imgs.player;this.h=this.w*this.img.height/this.img.width;this.y=runGround.y-this.h;this.oy=this.y;this.dh=this.h/2.3;this.oh=this.h};RunPlayer.prototype.collide=function(){if(this.y+this.h+this.vy>runGround.y){this.grounded=true;this.y=runGround.y-this.h}};RunPlayer.prototype.control=function(){var t=this.y+this.h;var i=this.ducking?.6:1;if(keys[RIGHT_ARROW]||keys.d){this.gvx=this.fastSpeed*i}else if(keys[LEFT_ARROW]||keys.a){this.gvx=this.slowSpeed*i}else{this.gvx=this.normalSpeed*i}if((keys[UP_ARROW]||keys.w||keys[32]||keys[" "]||pressed)&&this.grounded&&this.vy>=0){this.vy-=16;this.grounded=false}else if(keys[DOWN_ARROW]||keys.s){if(this.grounded&&!this.ducking){this.ducking=true}else if(!this.grounded){this.ducking=false;this.vy+=.3}}else{this.ducking=false}this.h=this.ducking?this.dh:this.oh;this.y=t-this.h+1};RunPlayer.prototype.update=function(){this.collide();if(this.grounded){this.vy=min(0,this.vy)}this.control();if(!this.grounded){this.img=imgs.player}else if(frameCount%10==0){this.walkingFrame++;this.walkingFrame=this.walkingFrame%imgs.players.length;this.img=imgs.players[this.walkingFrame]}this.vy+=.5;this.vy*=.99;this.vy=constrain(this.vy,-this.mvy,this.mvy);this.vx=lerp(this.vx,this.gvx,.1);this.x+=this.vx;this.y+=this.vy;this.y=min(this.y,runGround.y-this.h);this.grounded=false;this.updateTranslate()};RunPlayer.prototype.updateTranslate=function(t,i){this.ptransX=this.transX;this.viewSpace=t?0:width/3;if(this.x>this.viewSpace&&this.controlTrans){this.transX=-this.x+this.viewSpace}if(t){this.x=constrain(this.x,0,i.length*runObstacleWidth-width);if(this.x+width>=i.length*runObstacleWidth){this.transX=-i.length*runObstacleWidth+width}}};RunPlayer.prototype.display=function(){push();translate(this.x+this.w/2,this.y);if(this.vx>=0)scale(-1,1);image(this.img,-this.w/2,0,this.w,this.h);pop()};RunPlayer.prototype.run=function(){this.update();this.display()};RunPlayer.prototype.reset=function(){this.vx=0;this.vy=0;this.x=this.ox;this.y=this.oy;this.transX=0;this.controlTrans=true};let runPlayer=new RunPlayer(-100,0);function RunSign(t,i){this.x=t;this.y=50;this.w=500;this.h=250;this.dx=this.x+this.w;this.txt=i;this.padding=50}RunSign.prototype.display=function(t){if(t.x>this.x&&this.x<this.dx){this.x+=t.vx}push();image(imgs.woodsign,this.x,this.y,this.w,this.h);fill(0);noStroke();textSize(40);textFont(fonts.pixel);text(this.txt,this.x+this.padding,this.y+this.padding,this.w-this.padding*2,this.h-this.padding*2);pop()};function RunSpike(t){this.x=t;this.img=imgs.spike;this.w=runObstacleWidth;this.h=round(this.w*this.img.height/this.img.width);this.y=runGround.y-this.h}RunSpike.prototype.run=function(t){var i=this.x+runPlayer.transX;if(i+runPlayer.vx+this.w>0&&i-runPlayer.vx<width){this.display();this.collide(t)}};RunSpike.prototype.collide=function(t){function i(){loadRun.reload()}if(t.x+t.w>this.x&&t.x<this.x+this.w&&t.y+t.h>this.y&&t.y<this.y+this.h){if(t.x+t.w<this.x+this.w/2){if(t.y+t.h>map(t.x+t.w,this.x,this.x+this.w/2,this.y+this.h,this.y))i()}else if(t.x>this.x+this.w/2){if(t.y+t.h>map(t.x,this.x+this.w/2,this.x+this.w,this.y,this.y+this.h))i()}else i()}};RunSpike.prototype.display=function(){push();translate(this.x,this.y);image(this.img,0,0,this.w,this.h);pop()};function RunStreetLight(t){this.img=imgs.streetlight;this.w=runObstacleWidth;this.h=this.w*this.img.height/this.img.width;this.x=t;this.y=runGround.y-this.h;this.ly=this.y+this.h*12/22}RunStreetLight.prototype.collide=function(t){let i=abs(t.vx);let e=abs(t.vy);if(t.x+t.w>this.x&&t.x<this.x+this.w&&t.y+t.h+e>this.y&&t.y-e<this.ly){if(t.x>this.x+this.w/2){if(t.y+t.h>map(t.x,this.x+this.w/2,this.x+this.w,this.y,this.ly-this.h/10)){loadRun.reload()}}else{loadRun.reload()}}};RunStreetLight.prototype.display=function(){image(this.img,this.x,this.y,this.w,this.h)};RunStreetLight.prototype.run=function(t){this.collide(t);this.display()};function RunTrash(t){this.x=t;this.img=imgs.trash;this.w=runObstacleWidth;this.h=this.w*this.img.height/this.img.width;this.y=runGround.y-this.h}RunTrash.prototype.display=function(){image(this.img,this.x,this.y,this.w,this.h)};RunTrash.prototype.collide=function(t){let i=abs(t.vx),e=abs(t.vy);if(t.x+t.w+i>this.x&&t.x-i<this.x+this.w&&t.y+t.h+e>this.y){if(t.y+t.h-e*2-1<this.y){t.y=min(t.y,this.y-t.h);t.vy=min(t.vy,0);t.grounded=true}if(t.x+t.w+i>this.x&&t.x+t.w<=this.x+i){t.vx=constrain(t.vx,-100,0);t.x=this.x-t.w}}};RunTrash.prototype.run=function(t){var i=this.x+runPlayer.transX;if(i+runPlayer.vx+this.w>0&&i-runPlayer.vx<width){this.collide(t);this.display()}};function Button(t,i,e,s,h,r){this.text=t;this.x=i;this.y=e;this.w=s;this.h=h;this.func=typeof r=="function"?r:function(){console.log("Placeholder function for button with text "+this.text)}}Button.prototype.check=function(){if(mouseX>this.x&&mouseY>this.y&&mouseX<this.x+this.w&&mouseY<this.y+this.h){cursor(HAND);if(pressed){pressed=false}if(clicked){clicked=false;this.func()}}};Button.prototype.display=function(t,i){push();rect(this.x,this.y,this.w,this.h,5);if(i){strokeWeight(2);stroke(i)}else{noStroke()}if(t){fill(t)}else{fill(255)}textAlign(CENTER,CENTER);text(this.text,this.x+this.w/2,this.y+this.h/2);pop()};Button.prototype.draw=function(t,i){this.check();this.display(t,i)};function ChooseUseSave(){background(0);image(imgs.stars,0,0,width,height);push();translate(200,200);rotate(-45);let t=200;drawAnimation(imgs.rocketOn,0,0,t,t*imgs.rocketOn.height/imgs.rocketOn.width);pop();fill(0,0,0,100);rect(0,0,width,height);push();noStroke();textSize(50);fill(255);textAlign(CENTER,TOP);textFont(fonts.londrina);text("Would you like to start over, or resume your current game?",20,50,width-40,300);pop();push();fill(0,0,0,100);stroke(200);strokeWeight(5);textFont(fonts.londrina);textSize(50);var i=ChooseUseSave;i.resume.draw();i.restart.draw();textSize(25);i.alwaysResume.draw();i.alwaysRestart.draw();i.back.draw();pop()}ChooseUseSave.init=function(){this.resume=new Button("Resume",width/2-300,320,290,100,function(){game.loadProgress()});this.alwaysResume=new Button("Always Resume",width/2-300,440,290,100,function(){game.loadFirstOnPlay="always";game.loadProgress()});this.restart=new Button("Restart",width/2+10,320,290,100,function(){game.setScene(2)});this.alwaysRestart=new Button("Delete Save & Play",width/2+10,440,290,100,function(){localStorage.currentSave="";game.setScene("home");game.continue()});this.back=new Button("Back",width/2-100,560,200,80,function(){game.setScene("home")})};function Home(){background(0);image(imgs.stars,0,0,width,height);push();translate(200,200);rotate(-45);let t=200;drawAnimation(imgs.rocketOn,0,0,t,t*imgs.rocketOn.height/imgs.rocketOn.width);pop();fill(0,0,0,100);rect(0,0,width,height);push();noStroke();textSize(80);fill(200);textAlign(CENTER,BOTTOM);textFont(fonts.bladerunner);text("Escape From",width/2,height/2-150);fill(255);strokeWeight(1);stroke(255);textAlign(CENTER,TOP);textSize(120);textFont(fonts.arcade);text("EARTH",width/2,height/2-150);pop();push();fill(0,0,0,100);stroke(200);strokeWeight(5);textFont(fonts.londrina);textSize(50);Home.play.draw();textSize(25);Home.build.draw();Home.community.draw();if(localStorage.saves){Home.load.draw()}pop()}Home.init=function(){Home.play=new Button("Play Story Mode",width/2-200,height/2+10,400,100,function(){if(game.loadFirstOnPlay=="always"){return game.loadProgress()}else if(game.loadFirstOnPlay=="never"){game.continue();return}else if(localStorage.currentSave){return game.setScene("choose")}game.continue()});Home.build=new Button("Build Levels",width/2-200,height/2+130,190,100,function(){game.setScene("levelbuilder")});Home.community=new Button("Play Community\nLevels",width/2+10,height/2+130,190,100,function(){game.setScene("communitylevels")});Home.load=new Button("Load Save",width/2-150,height/2+250,300,60,function(){game.setScene("loadsaves")})};let hasWon=localStorage.hasWon?true:false;function LoadSaves(){background(0);image(imgs.stars,0,0,width,height);push();translate(200,200);rotate(-45);let t=200;drawAnimation(imgs.rocketOn,0,0,t,t*imgs.rocketOn.height/imgs.rocketOn.width);pop();fill(0,0,0,100);rect(0,0,width,height);push();noStroke();textSize(80);fill(200);textAlign(CENTER,TOP);textFont(fonts.arcade);text("Load Saves",width/2,100);fill(255);strokeWeight(1);stroke(255);textAlign(CENTER,TOP);textSize(50);textFont(fonts.londrina);var i=LoadSaves.displaySave;textSize(20);fill(255,255,255,200);stroke(0);strokeWeight(5);textAlign(CENTER,CENTER);var e=50,s=50,h=10,r=10;var a=e,o=200+s;const l=200,n=70;var u=game.retrieveProgress(0,true);if(!u)game.setScene("home");else{for(var d=0;d<u.length;d++){var c=u[d];i(c,a,o,l,n);a+=l+h;if(a+l>width-e){a=e;o+=n+s}if(o+n>height-s){u.pop()}}}pop();push();fill(0,0,0,100);stroke(200);strokeWeight(5);textFont(fonts.londrina);textSize(25);LoadSaves.HomeBtn.draw();pop()}LoadSaves.displaySave=function(t,i,e,s,h){rect(i,e,s,h,10);push();fill(0);stroke(100);strokeWeight(2);var r;switch(t.scene){case"run":r="Run To Rocket";break;case"build":r="Build Rocket";break;case"fly-moon":r="Fly to the Moon";break;case"moon":r="Moon";break;case"fly-mars":r="Fly to Mars";break;case"fight":r="Mars";break;case"fly-venus":r="Fly to Venus";break;case"ufo":r="UFO Fight";break;default:r=t.scene;break}if(typeof t.data=="number"){r+=" - "+t.data}if(t.date){r+="\n"+t.date.month+"/"+t.date.day+" - "+t.date.hour+":"+t.date.minute}text(r,i+s/2,e+h/2);pop();if(mouseX>i&&mouseX<i+s&&mouseY>e&&mouseY<e+h){cursor(HAND);if(clicked){game.loadProgress(t)}}};LoadSaves.init=function(){this.HomeBtn=new Button("Home",10,height-60,100,50,function(){game.setScene("home")})};function Won(){background(0);image(imgs.stars,0,0,width,height);push();translate(200,200);rotate(-45);let t=200;drawAnimation(imgs.rocketOn,0,0,t,t*imgs.rocketOn.height/imgs.rocketOn.width);pop();fill(0,0,0,100);rect(0,0,width,height);push();noStroke();textSize(80);fill(200);textAlign(CENTER,BOTTOM);textFont(fonts.arcade);text("Congratulations!",width/2,height/2-150);fill(255);strokeWeight(1);stroke(255);textAlign(CENTER,TOP);textSize(50);textFont(fonts.londrina);text("You made your own rocket, defeated martians, destroyed the UFO, and safely landed on Venus",100,height/2-150,width-200,200);pop();fill(0,0,0,200);textSize(40);textFont(fonts.londrina);strokeWeight(5);stroke(240);Won.menu.draw()}Won.init=function(){Won.menu=new Button("Menu",width/2-150,height/2+50,300,60,function(){game.setScene("home")});localStorage.hasWon="true";hasWon=localStorage.hasWon;game.loadFirstOnPlay=false;localStorage.currentSave=""};function UfoBoss(t,i,e){this.x=t;this.y=i;this.img=imgs.ufoboss;this.r=e||300;this.w=this.r*2;this.h=this.w*this.img.height/this.img.width;this.r=(this.w+this.h)/4;this.health=100;this.radius=this.w/2;this.frame=0;this.shootWait=120}UfoBoss.prototype.run=function(t){this.display();this.collide(t);this.update(t)};UfoBoss.prototype.update=function(t){if(this.health<1){this.dead=true;this.img=imgs.explosion[round(this.frame/2)];this.frame++}if(frameCount%this.shootWait===0){lasers.push(new Laser(this.x,this.y,-atan2(this.x-t.x,this.y-t.y),4,"boss"));this.shootWait=round(random(80,140))}};UfoBoss.prototype.collide=function(t){let i=dist(this.x,this.y,t.x,t.y);let e=this.r+(t.w+t.h)/4;if(i<e){t.x-=t.vx;t.y-=t.vy;t.thrustCooldown=0;var s=mag(t.vx,t.vy)*2;var h=t.x-this.x;var r=t.y-this.y;var a=mag(h,r);var o=s/a;h*=o;r*=o;t.vx+=h;t.vy+=r;t.health--}for(var l in lasers){let t=lasers[l];if(t.belongsTo!=="boss"){i=dist(this.x,this.y,t.x,t.y);e=t.radius+this.radius;if(i<e){t.dead=true;this.health--}}}};UfoBoss.prototype.display=function(){push();translate(this.x,this.y);imageMode(CENTER);image(this.img,0,0,this.w,this.h);pop();this.displayHealth()};UfoBoss.prototype.displayHealth=function(){push();noStroke();fill(204,14,14);rect(this.x-this.w/3,this.y-this.h*.8,this.w*2/3*this.health/100,this.h*.2);stroke(94,94,94);strokeWeight(10);noFill();rect(this.x-this.w/3,this.y-this.h*.8,this.w*2/3,this.h*.2);pop()};function ufoBossFight(){background(0,0,0);push();if(flyPlayer.x>width/2){translate(-flyPlayer.x+width/2,0)}displayStars();for(var t in lasers){lasers[t].run();if(lasers[t].dead){lasers.splice(t,1)}}for(var t=ufos.length-1;t>-1;t--){ufos[t].run(flyPlayer);if(ufos[t].dead&&ufos[t].frame>20){ufos.splice(t,1)}}for(var t in bosses){bosses[t].run(flyPlayer);if(bosses[t].dead&&bosses[t].frame>20){bosses.splice(t,1);if(bosses.length===0){game.continue()}}}flyPlayer.run();for(var t=asteroids.length-1;t>-1;t--){asteroids[t].run(flyPlayer);if(asteroids[t].dead&&asteroids[t].frame>20){asteroids.splice(t,1)}}pop();flyPlayer.displayHealth()}ufoBossFight.level={boss:[[1500,window.innerHeight/2]]};ufoBossFight.init=function(){lasers=[];flyPlayer=new FlyPlayer(50,height/2);flyPlayer.init();loadLevel(this.level)};let moonGun={appear:false,x:0,y:0,run:function(){if(this.appear){this.display();let t=moonPlayer;if(this.x>t.x+t.w/4){this.x-=3}if(this.y<t.y+t.h/2){this.y+=3}}},display:function(){push();translate(this.x,this.y);scale(.025);image(imgs.moonGun,0,0);pop()},init:function(){this.x=manOnTheMoon.x;this.y=height/2}};function moon(){for(var t=0;t<width;t+=height){image(imgs.stars,t,0,height,height)}manOnTheMoon.run();image(imgs.moon,0,0,width,height);moonShip.run();moonPlayer.run();moonGun.run();moonTextBox.run()}moon.init=function(){manOnTheMoon.init();moonShip.init();moonPlayer.init();moonTextBox.init();moonGun.init()};let manOnTheMoon={x:0,y:0,w:0,h:0,img:0,appear:false,run:function(){this.display();if(this.appear&&this.y>height*.67-this.h/2){this.y-=3}else if(this.appear&&moonTextBox.line<20){moonTextBox.show=true}},display:function(){push();translate(this.x,this.y);imageMode(CENTER);image(this.img,0,0,this.w,this.h);pop()},init:function(){this.img=imgs.momdefault;this.w=max(width/3,height/2);this.h=this.w*this.img.height/this.img.width;this.x=width/2;this.y=height+this.w*this.img.height/this.img.width-50}};let moonPlayer={x:-500,y:-500,w:40,h:0,direction:"right",wait:0,runAway:false,run:function(){this.display();if(this.appeared){this.wait++;if(this.wait>30){this.direction="left"}if(this.wait>60){this.direction="right"}if(this.wait>65){manOnTheMoon.appear=true}if(this.runAway&&moonGun.x<this.x+this.w/2&&moonGun.y>this.y-this.h/2){this.direction="left";this.x-=3;if(this.x<-this.w/2){game.continue()}}}},display:function(){push();translate(this.x+this.w/2,this.y);if(this.direction==="right")scale(-1,1);image(this.img,-this.w/2,0,this.w,this.h);pop()},appear:function(){this.x=moonShip.x;this.y=moonShip.y-30;this.appeared=true},init:function(){this.img=imgs.player;this.h=this.w*this.img.height/this.img.width}};let moonShip={x:0,y:0,w:100,h:40,moving:true,offImgs:{},onImg:{},playerWait:0,run:function(){if(this.y<height/2+150){this.y+=3}else{this.moving=false;this.playerWait++;if(this.playerWait>40&&this.playerWait<100){moonPlayer.appear()}}this.display()},init:function(){this.x=width/2-350;this.y=-50;this.offImg=imgs.rocketOff;this.onImg=imgs.rocketOn;this.h=this.w*this.onImg.getHeight()/this.onImg.getWidth()},display:function(){push();imageMode(CENTER);translate(this.x,this.y);if(this.moving){drawAnimation(this.onImg,0,0,this.w,this.h)}else{drawAnimation(this.offImg,0,0,this.w,this.h)}pop()}};let moonConversation=["Fee fi fo fum! It is I, the man on the moon!","Wait, your the guy from dream works!","Yes that was me. However, my looks haven't quite stayed the same since I got space Diabetes.","Wow, you've aged so much since then.","How dare you! I'll have you know that I'm at the young age of 4.53 billion years. I'm in my prime! I'm practically fresh out of the womb!","But your hair is gray!","Shut up, space diabetes has some unspeakable effects.","I'm sorry, I shouldn't have mentioned your incredibly miserable space Diabetes.","You're right, you should have! Listen, why did you come to my neck of the woods?","There are no trees here.","Yeah, but there are necks.","You said 'neck' singular.","It's a figure of speech!","Ok sure. In response to your earlier inquiry, I'm here to refuel. The human race abandoned me yesterday and I am heading to Mars. Any advice?","Yeah, don't let the Martians bite you, if you do the tip of the side of your left ring finger will hurt for two weeks, four days, three hours, fourteen minutes, and seventy two seconds","There are martians?","yeah, and I'm warning you, their bites are more painful than you would believe! Don't let them bite you. Here, I want you to have this.","","This gun is incredibly important to me. Take care of it. It has been passed down through my family for generations. My father gave it to me shortly before he passed away, along with a very important message, to uphold the family honor. In his last breath, he requested that--","Ok thanks!"];let moonTextBox={x:0,y:0,w:400,h:200,padding:10,text:"",textShowing:0,line:0,show:false,run:function(){if(this.show===true){if(this.textShowing>=this.text.length&&(keysReleased[" "]||keysReleased[32]||clicked)){this.line++;if(this.line===17){this.line++;moonGun.appear=true}if(this.line<20){this.text=moonConversation[this.line];this.textShowing=0}else{this.show=false;this.text="";moonPlayer.runAway=true}}else if(keysReleased[" "]||keysReleased[32]||clicked){this.textShowing=this.text.length}this.display();this.textShowing+=.5}},display:function(){if(this.line%2==0)this.speaker="Man On The Moon";else this.speaker="Tom";push();fill(232);stroke(240);strokeWeight(5);rect(this.x,this.y,this.w,this.h);fill(0,0,0);textSize(15);stroke(255);strokeWeight(1);textFont(fonts.pixel);if(this.line<20){text(this.speaker+": "+this.text.substr(0,this.textShowing),this.x+this.padding,this.y+this.padding,this.w-this.padding*2,this.h-this.padding*2)}if(this.line===0&&this.textShowing>=this.text.length){text("Press space to continue",this.x+this.padding,this.y+this.h-20-this.padding*2)}pop()},init:function(){this.x=width/2-this.w/2;this.y=height-this.h-20;this.text=moonConversation[this.line];this.textShowing=0}};function FlyFreeplay(){push();background(0,0,0);FlyFreeplay.transX=0;var t=FlyFreeplay.level.w;var i=width/2;if(flyPlayer.x>i&&flyPlayer.x<t){FlyFreeplay.transX=-flyPlayer.x+i}else if(flyPlayer.x>t){FlyFreeplay.transX=-t+i}if(flyPlayer.x>t+i){game.setScene(FlyFreeplay.gobackto);if(FlyFreeplay.levelObject.levelBuilderLevel){FlyFreeplay.levelObject.verified=true;levelBuilder.save()}}translate(FlyFreeplay.transX,0);displayStars();for(var e=lasers.length-1;e>-1;e--){lasers[e].run();if(lasers[e].dead){lasers.splice(e,1)}}for(var e=ufos.length-1;e>-1;e--){ufos[e].run(flyPlayer);if(ufos[e].dead&&ufos[e].frame>20){ufos.splice(e,1)}}for(var e=asteroids.length-1;e>-1;e--){asteroids[e].run(flyPlayer);if(asteroids[e].dead&&asteroids[e].frame>20){asteroids.splice(e,1)}}for(var e=bosses.length-1;e>-1;e--){bosses[e].run(flyPlayer);if(bosses[e].dead&&bosses[e].frame>20){bosses.splice(e,1)}}flyPlayer.run();pop();flyPlayer.displayHealth()}FlyFreeplay.set=function(t,i){this.levelObject=t;this.level=this.levelObject.objects;this.gobackto=i};FlyFreeplay.init=function(){flyPlayer=new FlyPlayer(50,height/2);flyPlayer.init();this.level.w=this.level.width/100*height;loadDynamicLevel(this.level)};let height=window.innerHeight;function flyToMars(){background(0,0,0);push();if(flyPlayer.x>width/2){translate(-flyPlayer.x+width/2,0)}displayStars();for(var t in lasers){lasers[t].run();if(lasers[t].dead){lasers.splice(t,1)}}for(var t=ufos.length-1;t>-1;t--){ufos[t].run(flyPlayer);if(ufos[t].dead&&ufos[t].frame>20){ufos.splice(t,1)}}flyPlayer.run();for(var t=asteroids.length-1;t>-1;t--){asteroids[t].run(flyPlayer);if(asteroids[t].dead&&asteroids[t].frame>20){asteroids.splice(t,1)}}pop();flyPlayer.displayHealth();if(flyPlayer.x>7e3){game.continue()}}flyToMars.level={asteroids:[[1200,height/2,100],[1800,150,95],[2e3,height-100,95],[2400,height-125,80],[2900,height/2,125],[4500,100,100],[4500,height-100,100],[4700,height/2+150,100],[4700,height/2-150,100]],ufos:[[1800,height/2],[3400,200],[4e3,100],[4e3,height-100],[6500,height/2],[6500,100],[6500,height-100]]};flyToMars.init=function(){flyPlayer=new FlyPlayer(50,height/2);flyPlayer.init();loadLevel(this.level)};function flyToMoon(){push();background(0,0,0);if(flyPlayer.x>width/2&&flyPlayer.x<5500){translate(-flyPlayer.x+width/2,0)}else if(flyPlayer.x>5500){translate(-5500+width/2,0)}if(flyPlayer.x>5500+width/2){game.continue()}displayStars();for(var t in flySigns){flySigns[t].display(flyPlayer)}for(var t in lasers){lasers[t].run();if(lasers[t].dead){lasers.splice(t,1)}}flyPlayer.run();for(var t in asteroids){asteroids[t].run(flyPlayer);if(asteroids[t].dead&&asteroids[t].frame>20){asteroids.splice(t,1)}}pop();flyPlayer.displayHealth()}flyToMoon.init=function(){flyPlayer=new FlyPlayer(50,height/2);flyPlayer.init();flySigns=[];flySigns.push(new FlySign(200,"Press space to accelerate, use the left and right arrow keys or a and d to steer"));asteroids=[];flySigns.push(new FlySign(2900,"Look out for asteroids!"));for(var t=-300;t<height+300;t+=300){asteroids.push(new Asteroid(5200,t,150))}flySigns.push(new FlySign(4400,"Press Z to shoot, try blowing up an asteroid"));asteroids.push(new Asteroid(3500,height/2,125))};height=window.innerHeight;function flyToVenus(){background(0,0,0);push();if(flyPlayer.x>width/2){translate(-flyPlayer.x+width/2,0)}displayStars();for(var t in lasers){lasers[t].run();if(lasers[t].dead){lasers.splice(t,1)}}for(var t=ufos.length-1;t>-1;t--){ufos[t].run(flyPlayer);if(ufos[t].dead&&ufos[t].frame>20){ufos.splice(t,1)}}flyPlayer.run();for(var t=asteroids.length-1;t>-1;t--){asteroids[t].run(flyPlayer);if(asteroids[t].dead&&asteroids[t].frame>20){asteroids.splice(t,1)}}pop();flyPlayer.displayHealth();if(flyPlayer.x>4e3){game.continue()}}flyToVenus.level={asteroids:[[1200,height/2,height/2],[3e3,height/2,100],[3e3,height/2-200,100],[3e3,height-200,100]],ufos:[[1600,height/2],[2e3,100],[2400,height-100],[2800,height/2],[3500,height/2],[3500,height]]};flyToVenus.init=function(){flyPlayer=new FlyPlayer(50,height/2);flyPlayer.init();loadLevel(this.level)};