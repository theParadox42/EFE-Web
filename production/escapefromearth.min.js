var game={currentScene:"load",previousScene:"home",sceneIndex:0,sceneOrder:["load","home","wakeup","run","launchpad","build","rocketbuilt","fly-moon","moon","fly-mars","marslanding","fight","leavemars","fly-venus","seeufo","ufo","landonvenus","won"],canSave:{run:!0,launchpad:!0,build:!0,rocketbuilt:!0,"fly-moon":!0,moon:!0,"fly-mars":!0,marslanding:!0,fight:!0,leavemars:!0,"fly-venus":!0,seeufo:!0,ufo:!0,landonvenus:!0},hasPause:{wakeup:!0,run:!0,launchpad:!0,build:!0,rocketbuilt:!0,"fly-moon":!0,moon:!0,"fly-mars":!0,marslanding:!0,fight:!0,leavemars:!0,"fly-venus":!0,seeufo:!0,ufo:!0,playlevel:!0,landonvenus:!0},reqControls:{run:!0,build:!0,"fly-moon":!0,"fly-mars":!0,fight:!0,"fly-venus":!0,seeufo:!0,ufo:!0,playlevel:!0},paused:!1,loadFirstOnPlay:!1,continue:function(){this.previousScene=this.currentScene,this.sceneOrder[this.sceneIndex+1]?("function"==typeof this.getFunc().reset&&this.getFunc().reset(),this.sceneIndex++,this.currentScene=this.sceneOrder[this.sceneIndex],"function"==typeof this.getFunc().init&&this.getFunc().init()):console.log("End of scenes")},setScene:function(t,i){if(i||(this.previousScene=this.currentScene,"function"==typeof this.getFunc().reset&&this.getFunc().reset()),"number"==typeof t?this.currentScene=this.sceneOrder[t]:"string"==typeof t&&(this.currentScene=t),"function"==typeof this.getFunc().init&&this.getFunc().init(),"number"==typeof t)this.sceneIndex=t;else{var e=this.sceneOrder.findIndex(function(t){return t==game.currentScene});this.sceneIndex=e>=1?e:0}},getFunc:function(){let t={wait:waitingForFileCount,load:loadFiles,home:Home,choose:ChooseUseSave,wakeup:wakeUpScene,run:runToRocket,launchpad:AtLaunchPad,build:buildRocket,rocketbuilt:RocketBuilt,"fly-moon":flyToMoon,moon:moon,"fly-mars":flyToMars,marslanding:marsLanding,fight:fightMartians,leavemars:leaveMars,"fly-venus":flyToVenus,seeufo:UfoCutscene,ufo:ufoBossFight,landonvenus:LandOnVenus,won:Won,loadsaves:LoadSaves,levelbuilder:levelBuilder,communitylevels:communityLevels,playlevel:playLevel};return t[this.currentScene]?t[this.currentScene]:(console.warn("Unknown scene: "+this.currentScene),this.setScene("home",!0),this.getFunc())},pause:function(){push(),this.paused=!0,fill(0,0,0,180),noStroke(),rect(0,0,width,height),this.minSide=this.minSide||min(min(width,height),2*imgs.playbtn.width)/2,noStroke(),fill(255),ellipse(width/2,height/2-.3*this.minSide,1.1*this.minSide,1.1*this.minSide),rectMode(CENTER),stroke(0),strokeWeight(5),rect(width/2,height/2+.5*this.minSide,width/2,.2*this.minSide),this.canSave[this.currentScene]&&rect(width/2,height/2+.8*this.minSide,width/2,.2*this.minSide),textAlign(CENTER,CENTER),noStroke(),fill(0),textFont(fonts.londrina),textSize(.15*this.minSide),text("playlevel"==this.currentScene?"Back":"Home",width/2,height/2+.5*this.minSide),this.canSave[this.currentScene]&&(text("Save",width/2,height/2+.8*this.minSide),textSize(.05*this.minSide),fill(255),text("Going home also saves your progress",width/2,height-.05*this.minSide)),imageMode(CENTER),image(imgs.playbtn,width/2,height/2-.3*this.minSide,this.minSide,this.minSide),pop(),isMobile||(this.pausedImage=get())},displayPaused:function(){this.paused&&this.pausedImage?image(this.pausedImage,0,0,width,height):this.paused?console.log("Paused image not loaded..."):(push(),fill(255),noStroke(),ellipse(25,25,45,45),image(imgs.pausebtn,5,5,40,40),pop())},updatePaused:function(){this.paused?dist(mouseX,mouseY,width/2,height/2-.3*this.minSide)<.55*this.minSide?(cursor(HAND),clicked&&(this.paused=!1)):mouseX>width/4&&mouseX<3*width/4&&mouseY>height/2+.4*this.minSide&&mouseY<height/2+.6*this.minSide?(cursor(HAND),clicked&&("playlevel"!=this.currentScene&&this.saveCurrentProgress(),this.setScene("playlevel"==this.currentScene?this.previousScene:"home"))):this.canSave[this.currentScene]&&mouseX>width/4&&mouseX<3*width/4&&mouseY>height/2+.7*this.minSide&&mouseY<height/2+.9*this.minSide&&(cursor(HAND),clicked&&this.saveProgress()):mouseX<50&&mouseY<50&&(cursor(HAND),clicked?(this.pause(),clicked=!1):pressed&&(pressed=!1))},alreadyLoaded:!1,saveCurrentProgress:function(){if(this.canSave[this.currentScene]){var t=this.saveProgress(null,!0);localStorage.currentSave=JSON.stringify(t)}},saveProgress:function(t,i){if(!this.canSave[this.currentScene])return console.log("Not a valid scene to save from");var e={};e.scene=t||this.currentScene;var s=0;switch(e.scene){case"run":s=loadRun.level;break;case"build":s=bGame.level}var h=new Date;if(e.date={year:h.getYear(),month:h.getMonth(),day:h.getDate(),hour:h.getHours(),minute:h.getMinutes()},void 0!==s&&(e.data=s),i)return e;var o=JSON.parse(localStorage.saves||"[]");o.unshift(e),localStorage.saves=JSON.stringify(o)},retrieveCurrentProgress:function(){if(!localStorage.currentSave)return console.log("No saves found");var t;try{t=JSON.parse(localStorage.currentSave)}catch(t){return console.warn("Unparsable data type")}return"object"!=typeof t?console.warn("Not an object"):t},retrieveProgress:function(t,i){if(t=t||0,!localStorage.saves)return console.log("No saves found");var e;try{e=JSON.parse(localStorage.saves)}catch(t){return console.warn("Unparsable data type")}if("object"!=typeof e||!e.length)return console.warn("Not an array");if(i)return e;var s=e[t];return"object"!=typeof s?console.warn("Not an object"):s},loadProgress:function(t){var i=t||this.retrieveCurrentProgress();if(i.data)switch(i.scene){case"run":loadRun.level=i.data;break;case"build":bGame.level=i.data}this.setScene(i.scene)},run:function(){if(this.hasPause[this.currentScene]){if(this.updatePaused(),this.paused)return this.displayPaused(),void resetInput()}else this.paused=!1;isMobile&&this.reqControls[this.currentScene]&&updateMobile(),this.getFunc()(),isMobile&&this.reqControls[this.currentScene]&&displayMobile(),resetInput(),this.hasPause[this.currentScene]&&this.displayPaused()},init:function(){let t=this.sceneOrder.indexOf(function(t){return t==this.currentScene});this.sceneIndex=t>=0?t:this.sceneIndex,isMobile&&createMobileControls(),"function"==typeof this.getFunc().init&&this.getFunc().init()},resize:function(){"function"==typeof this.getFunc().resize&&this.getFunc().resize()}};let keys={},keysReleased={};var theEpicCanvas,clicked=!1,pressed=!1,canPress=!0;function keyPressed(){keys[key]=!0,keys[keyCode]=!0}function keyReleased(){keys[key]=!1,keys[keyCode]=!1,keysReleased[key]=!0,keysReleased[keyCode]=!0}function mousePressed(){canPress&&(pressed=!0,canPress=!1)}function mouseReleased(){canPress=!0,clicked=!0}function resetInput(){keysReleased={},clicked=!1,pressed=!1}function setup(){windowHeight-=30,theEpicCanvas=createCanvas(windowWidth,windowHeight),background(255),angleMode(DEGREES),game.init()}function draw(){cursor("default"),game.run()}function mobileControl(t,i,e,s,h,o){this.x=t,this.y=i,this.w=e,this.h=s,this.key=h,this.txt=o}mobileControl.prototype.update=function(){mouseX>this.x&&mouseX<this.x+this.w&&mouseY>this.y&&mouseY<this.y+this.h&&(mouseIsPressed&&(mouseIsPressed=!1),pressed&&(keysReleased[this.key]=!0,pressed=!1),clicked&&(clicked=!1)),keys[this.key]=!1;for(var t=0;t<touches.length;t++){let i=touches[t].x,e=touches[t].y;if(i>this.x&&i<this.x+this.w&&e>this.y&&e<this.y+this.h){keys[this.key]=!0;break}}},mobileControl.prototype.display=function(){push(),translate(this.x,this.y),fill(0,0,0,128),stroke(0,0,0,200),strokeWeight(5),rect(0,0,this.w,this.h),fill(255,255,255,128),textAlign(CENTER,CENTER),textFont(fonts.pixel),textSize(20),text(this.txt,this.w/2,this.h/2),pop()};let mobileControls=[];function createMobileControls(){let t=80,i=t,e=10;function s(e,s,h,o,n){let r=t;n&&(r=abs(n-e)),mobileControls.push(new mobileControl(e,s,r,i,h,o))}s(e,height-i-e,LEFT_ARROW,"<"),s(20+t,height-i-e,DOWN_ARROW,"v"),s(20+t,height-2*i-20,UP_ARROW,"^"),s(30+2*t,height-i-e,RIGHT_ARROW,">"),s(width-t-e,height-i-e,"x","X"),s(width-2*t-20,height-i-e,"z","Z"),s(40+3*t,height-i-e,32,"Space",width-2*t-30)}function updateMobile(){for(var t=0;t<mobileControls.length;t++)mobileControls[t].update()}function displayMobile(){for(var t=0;t<mobileControls.length;t++)mobileControls[t].display()}var isMobile=navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i);{function BBlock(t,i,e,s){this.x=t,this.y=i,this.w=e,this.h=s,this.img=imgs.garbage}BBlock.prototype.collide=function(t){let i=abs(t.vx),e=abs(t.vy);t.x+t.w+i+1>this.x&&t.x-i-1<this.x+this.w&&t.y+t.h+e>=this.y&&t.y-e<=this.y+this.h&&(t.x+t.w-2*i-1>this.x&&t.x+2*i+1<this.x+this.w?t.y+t.h/2>this.y+this.h/2?(t.y=max(t.y,this.y+this.h),t.y<=this.y+this.h&&(t.vy=max(t.vy,0))):(t.y=min(t.y,this.y-t.h),t.y+t.h>=this.y&&(t.vy=min(t.vy,0),t.grounded=!0)):t.y+t.h-e-1>this.y&&t.y+e+1<this.y+this.h&&(t.x+t.w/2>this.x+this.w/2?(t.x=max(t.x,this.x+this.w),t.x<=this.x+this.w&&(t.vx=max(t.vx,0))):(t.x=min(t.x,this.x-t.w),t.x+t.w>=this.x&&(t.vx=min(t.vx,0)))))},BBlock.prototype.display=function(){image(this.img,this.x,this.y,this.w,this.h)},BBlock.prototype.run=function(t){t&&this.collide(t),this.display()}}{function BAsphalt(t,i,e,s){BBlock.call(this,t,i,e,s),this.img=imgs.asphalt}BAsphalt.prototype=Object.create(BBlock.prototype)}{function BSpike(t,i,e,s){BBlock.call(this,t,i,e,s),this.img=imgs.spike,this.m=this.x+this.w/2}function BDSpike(t,i,e,s){BSpike.call(this,t,i,e,s)}BSpike.prototype=Object.create(BBlock.prototype),BSpike.prototype.collide=function(t){var i=abs(t.vx);abs(t.vy);t.x+t.w-1-i>this.x&&t.x+1+i<this.x+this.w&&t.y+t.h-1>this.y&&t.y+1<this.y+this.h&&(t.x+t.w<this.x+this.w/2?t.y+t.h>map(t.x+t.w,this.x,this.m,this.y+this.h,this.y)&&t.kill():t.x>this.x+this.w/2?t.y+t.h>map(t.x,this.m,this.x+this.w,this.y,this.y+this.h)&&t.kill():t.kill())},BDSpike.prototype=Object.create(BSpike.prototype),BDSpike.prototype.collide=function(t){var i=abs(t.vx);abs(t.vy);t.x+t.w-1-i>this.x&&t.x+1+i<this.x+this.w&&t.y+t.h-1>this.y&&t.y+1<this.y+this.h&&(t.x+t.w<this.x+this.w/2?t.y<map(t.x+t.w,this.x,this.m,this.y,this.y+this.h)&&t.kill():t.x>this.x+this.w/2?t.y+t.h<map(t.x,this.m,this.x+this.w,this.y+this.h,this.y)&&t.kill():t.kill())},BDSpike.prototype.display=function(){push(),translate(this.x,this.y+this.h/2),scale(1,-1),image(this.img,0,-this.h/2,this.w,this.h),pop()}}{function BPlatform(t,i,e,s){BBlock.call(this,t,i,e,s),this.img=imgs.platform}BPlatform.prototype=Object.create(BBlock.prototype),BPlatform.prototype.collide=function(t){let i=abs(t.vx),e=abs(t.vy);t.x+t.w+i+1>this.x&&t.x-i-1<this.x+this.w&&t.y+t.h+e>this.y&&t.y-e<this.y+this.h&&t.x+t.w-2*i-1>this.x&&t.x+2*i+1<this.x+this.w&&t.y+t.h-e-1<this.y&&!keys[DOWN_ARROW]&&!keys.s&&t.vy>0&&(t.y=min(t.y,this.y-t.h),t.y+t.h>=this.y&&(t.vy=min(t.vy,0),t.vy>=0&&(t.grounded=!0)))}}{function BToxic(t,i,e,s){BBlock.call(this,t,i,e,s),this.img=imgs.toxic.clone()}BToxic.prototype=Object.create(BBlock.prototype),BToxic.prototype.collide=function(t){var i=abs(t.vx),e=abs(t.vy);t.x+t.w-1-i>this.x&&t.x+1+i<this.x+this.w&&t.y+t.h-1-e>this.y&&t.y+1+e<this.y+this.h&&(t.health-=5,t.vx*=.5,t.vy*=.7,t.tint.r-=40,t.tint.b-=40)},BToxic.prototype.display=function(){push(),translate(this.x+this.w/2,this.y+this.h/2),drawAnimation(this.img,0,0,this.w,this.h),pop()}}{function BFire(t,i,e,s){BToxic.call(this,t,i,e,s),this.img=imgs.fire.clone()}BFire.prototype=Object.create(BToxic.prototype),BFire.prototype.collide=function(t){t.x+t.w-1>this.x&&t.x+1<this.x+this.w&&t.y+t.h-1>this.y&&t.y+1<this.y+this.h&&(t.health-=6,t.tint.g-=18,t.tint.b-=25)}}{function BRefinery(t,i,e,s){BBlock.call(this,t,i,e,s),this.img=imgs.refinery}BRefinery.prototype=Object.create(BBlock.prototype)}{function BSmoke(t,i,e,s){BToxic.call(this,t,i,e,s),this.img=imgs.smoke.clone()}BSmoke.prototype=Object.create(BToxic.prototype),BSmoke.prototype.collide=function(t){t.affectedBy.air||t.x+t.w>this.x&&t.x<this.x+this.w&&t.y+t.h>this.y&&t.y<this.y+this.h&&(t.affectedBy.air=!0,t.vy-=.6)}}{function BWater(t,i,e,s){BBlock.call(this,t,i,e,s),this.img=imgs.water}BWater.prototype=Object.create(BBlock.prototype),BWater.prototype.collide=function(t){t.affectedBy.water||t.x+t.w>this.x&&t.x<this.x+this.w&&t.y+t.h>this.y&&t.y<this.y+this.h&&(t.tint.r-=10.5,t.tint.g-=10.2,t.tint.r<=0&&t.health--,t.vx*=.75,t.vy*=.75,(keys[32]||keys[" "]||keys[UP_ARROW]||keys.w)&&t.vy>1.4&&(t.vy-=20),t.affectedBy.water=!0)}}{function BProton(t,i,e,s){BToxic.call(this,t,i,e,s),this.img=imgs.proton.clone(),this.field=300,this.strength=1}BProton.prototype=Object.create(BToxic.prototype),BProton.prototype.collide=function(t){let i=dist(t.x+t.w/2,t.y+t.h/2,this.x+this.w/2,this.y+this.h/2);if(i<this.field){let e=map(i,0,this.field,2,0),s=t.x+t.w/2-(this.x+this.w/2),h=t.y+t.h/2-(this.y+this.h/2),o=mag(s,h);h*=e/o,(s*=e/o)&&(t.vx+=s*this.strength),h&&(t.vy+=h*this.strength),"function"==typeof this.collide2&&this.collide2(t,i)}}}{function BBlackHole(t,i,e,s){BProton.call(this,t,i,e,s),this.img=imgs.blackhole.clone(),this.field=300,this.strength=-2}BBlackHole.prototype=Object.create(BProton.prototype),BBlackHole.prototype.collide2=function(t,i){if(i<this.w/2+t.w/2)for(var e in t.tint)t.tint[e]-=20,t.health-=1,t.w*=.99,t.h*=.99}}{function BPortal(t,i,e,s){BBlock.call(this,t,i,e,s),this.img=imgs.portal,this.w*=2,this.h*=2}BPortal.prototype=Object.create(BBlock.prototype),BPortal.prototype.display=function(){push(),imageMode(CENTER),translate(this.x+this.w/2,this.y+this.h/2),rotate(frameCount),image(this.img,0,0,this.w,this.h),pop()},BPortal.prototype.collide=function(t){if(t.x>this.x&&t.x+t.w<this.x+this.w&&t.y+t.h/2>this.y&&t.y<this.y+this.h)if(bGame.canPass){let i=.05;t.hasControl=!1,t.w=lerp(t.w,0,i),t.h=lerp(t.h,0,i),t.vx=0,t.vy=0,t.x=lerp(t.x,this.x+this.w/2-t.w/2,i),t.y=lerp(t.y,this.y+this.h/2-t.h/2,i),t.r+=5}else push(),textAlign(CENTER,BOTTOM),textFont(fonts.pixel),textSize(30),fill(0,0,0),text("Collect all the parts!",t.x+t.w/2+2,t.y-3),fill(255,0,0),text("Collect all the parts!",t.x+t.w/2,t.y-5),pop()}}{function BSpawn(t,i,e,s){BBlock.call(this,t,i,e,s)}BSpawn.prototype=Object.create(BBlock.prototype),BSpawn.prototype.collide=function(){},BSpawn.prototype.display=function(){ellipse(this.x+this.w/2,this.y+this.h/2,this.w,this.h)}}var BPart=[];BPart[0]=function(t,i,e,s){this.x=t,this.y=i,this.w=e,this.h=s,this.collectIndex=0,this.img||(this.img=imgs.rocketfin),this.imgw=this.imgw||this.img.width,this.imgh=this.imgh||this.img.height,max(this.imgw,this.imgh)==this.imgw?(this.dw=this.w,this.dh=this.w*this.imgh/this.imgw):(this.dh=this.h,this.dw=this.h*this.imgw/this.imgh),this.collected=!1},BPart[0].prototype=Object.create(BBlock.prototype),BPart[0].prototype.display=function(){push(),imageMode(CENTER),translate(this.x+this.w/2,this.y+this.h/2+10*sin(frameCount)-5),scale(cos(5*frameCount),1),image(this.img,0,0,this.dw,this.dh),pop()},BPart[0].prototype.collide=function(t){let i=2*abs(t.vx),e=2*abs(t.vy);t.x+t.w-i>this.x&&t.x+i<this.x+this.w&&t.y+t.h-e>this.y&&t.y+e<this.y+this.h&&(this.collected=!0,t.collected.push(this.collectIndex))},BPart[1]=function(t,i,e,s){this.img=imgs.rockettail,BPart[0].call(this,t,i,e,s),this.collectIndex=1},BPart[1].prototype=Object.create(BPart[0].prototype),BPart[2]=function(t,i,e,s){this.img=this.img||imgs.rocketengine,this.imgw=this.img.getWidth(),this.imgh=this.img.getHeight(),BPart[0].call(this,t,i,e,s),this.collectIndex=2},BPart[2].prototype=Object.create(BPart[0].prototype),BPart[2].prototype.display=function(){push(),translate(this.x+this.w/2,this.y+this.h/2+10*sin(frameCount)-5),scale(cos(5*frameCount),1),drawAnimation(this.img,0,0,this.dw,this.dh),pop()},BPart[3]=function(t,i,e,s){this.img=imgs.rocketflame,BPart[2].call(this,t,i,e,s)},BPart[3].prototype=Object.create(BPart[2].prototype);{function BAir(t,i,e,s){BBlock.call(this,t,i,e,s),this.img=imgs.x}BAir.prototype=Object.create(BBlock.prototype),BAir.prototype.display=function(t){t&&image(this.img,this.x,this.y,this.w,this.h)},BAir.prototype.collide=function(){}}let bGame={maps:[],map:[],current:{},blocks:[],buildings:[],player:null,level:0,bw:100,bh:100,h:0,w:0,sw:0,sh:0,key:{},scaleFactor:0,canPass:!0,mode:"story",run:function(){for(var t=!(this.player&&this.player instanceof BPlayer),i=0;i<this.buildings.length;i++)this.buildings[i].run(this.player);push(),noStroke(),fill(255,50),rect(0,0,width,height),pop(),push(),scale(this.scaleFactor),t||(translate(this.player.getTransX(),0),this.player.update());for(i=this.blocks.length-1;i>-1;i--){var e=t?0:(this.blocks[i].x+this.player.transX)*this.scaleFactor;e+this.blocks[i].w*this.scaleFactor>-1&&e<width+1&&(this.blocks[i].run(this.player),this.blocks[i].collected&&(this.blocks.splice(i,1),this.canPass=!0))}t||this.player.display(),pop(),t||(push(),noStroke(),fill(lerpColor(color(255,0,0),color(0,255,0),constrain(this.player.health/100,0,1))),rect(width-210,10,2*max(this.player.health,0),50),noFill(),stroke(0),strokeWeight(10),rect(width-210,10,200,50),pop())},getConst:function(t){switch(t){case"a":return BAsphalt;case"#":return BBlock;case"r":return BRefinery;case"-":return BPlatform;case"'":return BSmoke;case"^":return BSpike;case"v":return BDSpike;case"~":return BWater;case"x":return BToxic;case"o":return BProton;case"0":return BBlackHole;case"f":return BFire;case"%":return BPortal;case"*0":return BPart[0];case"*1":return BPart[1];case"*2":return BPart[2];case"*3":return BPart[3];case"_":return BAir;default:return null}},init:function(){this.load()},next:function(){if("story"!=this.mode)return game.setScene(this.gobackto),void(this.rawLevelObject.levelBuilderLevel&&(this.rawLevelObject.verified=!0,levelBuilder.save()));this.level++,this.maps[this.level]?this.load():game.continue()},load:function(){if(this.mode="build"==game.currentScene?"story":"freeplay",this.maps[this.level]||"story"!=this.mode){if("story"==this.mode)this.map=this.maps[this.level].map;else if(!this.map)return;this.scaleFactor=height/this.map.length/this.bh,this.h=this.map.length*this.bh,this.w=this.map[0].length*this.bw,this.sw=1/this.scaleFactor*width,this.sh=1/this.scaleFactor*height,this.buildings=[];for(var t=0;t<20;t++)this.buildings.push(new BuildBuilding(random(width),random(2,6),random(3*height/4,height/2),~~random(imgs.buildings.length)));this.buildings.sort(function(t,i){return i.z-t.z}),this.reload()}},reload:function(){this.blocks=[],this.player=null,this.canPass=!0;for(var t=0;t<this.map.length;t++)for(var i=0;i<this.map[t].length;i++){let e=this.map[t][i];"*"==e&&(e+=this.maps[this.level].item,this.canPass=!1);let s=i*this.bw,h=t*this.bh;this.getConst(e)&&this.blocks.push(new(this.getConst(e))(s,h,this.bw,this.bh)),"@"==e&&(this.player=new BPlayer(s,h+this.bh,.75*this.bh))}},reset:function(){this.level=0}};function buildRocket(){background(200,225,255),bGame.run()}function BPlayer(t,i,e){this.vx=0,this.vy=0,this.img=imgs.player,this.w=e,this.h=this.w*this.img.height/this.img.width,this.x=t,this.y=i-this.h,this.grounded=!1,this.hasControl=!0,this.r=0,this.health=100,this.affectedBy={},this.collected=[],this.tint={r:255,g:255,b:255},this.transX=0,this.ptransX=this.transX,this.walkingFrame=0,this.isRunning=!1}function LandOnVenus(){LandOnVenus.draw()}function AtLaunchPad(){AtLaunchPad.draw()}function leaveMars(){leaveMars.draw()}function marsLanding(){marsLanding.draw()}$.getJSON("/scripts/buildrocket/levels.json",function(t){bGame.maps=t.levels}),buildRocket.init=function(){bGame.init()},buildRocket.reset=function(){bGame.reset()},BPlayer.prototype.control=function(){(keys[RIGHT_ARROW]||keys.d)&&(this.vx+=5),(keys[LEFT_ARROW]||keys.a)&&(this.vx-=5),(keys[UP_ARROW]||keys.w||keys[" "]||keys[32])&&this.grounded?this.vy-=17:!keys[DOWN_ARROW]&&!keys.s||this.grounded||(this.vy+=.2)},BPlayer.prototype.updateAnimation=function(){frameCount%8==0&&(this.grounded&&abs(this.vx)>.1?(this.walkingFrame=(this.walkingFrame+1)%imgs.players.length,this.img=imgs.players[this.walkingFrame]):this.img=imgs.player)},BPlayer.prototype.update=function(){this.updateAnimation(),this.tint.r=constrain(this.tint.r+10,0,255),this.tint.g=constrain(this.tint.g+10,0,255),this.tint.b=constrain(this.tint.b+10,0,255),this.hasControl&&this.control(),this.grounded||(this.vy+=.5),this.vx*=.7,this.vy*=.99,this.vx=constrain(this.vx,-15,15),this.vy=constrain(this.vy,-25,25),this.x+=this.vx,this.y+=this.vy,this.x<0?(this.x=0,this.vx=max(this.vx,0)):this.x+this.w>bGame.w&&(this.x=bGame.w-this.w,this.vx=min(this.vx,0)),(this.y>bGame.h||this.health<0)&&this.kill(),this.w<.5&&bGame.next(),this.grounded=!1,this.affectedBy={}},BPlayer.prototype.display=function(){push(),translate(this.x+this.w/2,this.y+this.h/2),rotate(this.r),this.vx>=0&&scale(-1,1),isMobile||tint(this.tint.r,this.tint.g,this.tint.b),image(this.img,-this.w/2,-this.h/2,this.w,this.h),noTint(),pop()},BPlayer.prototype.kill=function(){bGame.reload()},BPlayer.prototype.getTransX=function(t,i,e){this.ptransX=this.transX;var s=t?0:bGame.sw/3,h=(t?i:0)||bGame.w,o=(t?e:0)||bGame.sw;return this.x<s?this.transX=0:this.x<h-2*s?this.transX=-this.x+s:this.transX=o>h?0:-h+o,this.transX||0},LandOnVenus.init=function(){this.background={img:imgs.stars,x:0,y:0,w:width,h:height},this.venus={img:imgs.venus,x:3*height/4,y:3*height/4,w:height/2,h:height/2},this.rocket={img:imgs.rocketOn,x:0,y:0,r:135,w:150,init:function(){this.h=this.w*this.img.getHeight()/this.img.getWidth(),this.x-=2*this.h,this.y-=2*this.h}},this.rocket.init()},LandOnVenus.update=function(){this.rocket.x=lerp(this.rocket.x,this.venus.x+this.venus.w/2,.01),this.rocket.y=lerp(this.rocket.y,height+this.venus.h/4,.01);this.rocket.w*=.99,this.rocket.h*=.99,this.rocket.y>height&&game.continue()},LandOnVenus.displayObject=function(t){push(),translate(t.x+t.w/2,t.y+t.h/2),"number"==typeof t.r&&rotate(t.r),"function"==typeof t.img.getHeight?drawAnimation(t.img,0,0,t.w,t.h):image(t.img,-t.w/2,-t.h/2,t.w,t.h),pop()},LandOnVenus.display=function(){this.displayObject(this.background),this.displayObject(this.venus),this.displayObject(this.rocket)},LandOnVenus.draw=function(){background(0),this.update(),this.display()},AtLaunchPad.draw=function(){this.update(),background(100,200,255),push(),noStroke(),fill(100,120,120,100);for(var t=0;t<this.buildings.length;t++){var i=this.buildings[t];t/5==round(t/5)&&rect(0,0,width,height),image(i.img,i.x,i.y,i.w,i.h)}pop(),push(),translate(width/2,0),push(),noStroke(),fill(0,150,20),rect(-width/2-1,height-this.gh,width+2,this.gh+1),fill(0,50);var e=this.rocket.w*((this.rocket.y+700)/(this.rocket.oy+700));if(e=max(e,0),ellipse(this.rocket.x,this.rocket.oy-this.rocket.h/50,e,e/5),ellipse(this.player.x+this.player.w/2,this.player.y+this.player.h,this.player.w,this.player.w/5),pop(),this.rocket.on){var s=this.rocket.w/2;drawAnimation(imgs.rocketflame,this.rocket.x,this.rocket.y-this.rocket.h/6,s,s*imgs.rocketflame.getHeight()/imgs.rocketflame.getWidth())}if(image(imgs.largerocket,this.rocket.x-this.rocket.w/2,this.rocket.y-this.rocket.h,this.rocket.w,this.rocket.h),push(),translate(this.player.x,this.player.y),scale(-1,1),image(imgs.player,-this.player.w,0,this.player.w,this.player.h),pop(),this.player.talking){push(),fill(255),stroke(230),strokeWeight(5),textSize(30),textFont(fonts.pixel);var h=textWidth(this.player.text)+15;rect(this.player.x+this.player.w/2-h/2,this.player.y-50-15,h,50),fill(0),noStroke(),textAlign(CENTER,CENTER),text(this.player.text,this.player.x+this.player.w/2,this.player.y-25-15),pop()}pop()},AtLaunchPad.update=function(){switch(this.rocket.on&&(this.rocket.y-=20),this.stage){case"runin":this.player.x<-width/6?(this.player.x+=5,this.timedelay=0):this.timedelay<50?(this.timedelay++,this.rocket.x=50*noise(frameCount/12.7)-25):(this.timedelay=0,this.stage="takeoff",this.rocket.on=!0);break;case"takeoff":this.rocket.x=50*noise(frameCount/12.7)-25,this.rocket.y<-1e3&&(this.stage="idea",this.rocket.on=!1,this.player.talking=!0,this.timeDelay=0);break;case"idea":this.timeDelay<80?this.timeDelay++:(this.player.ti++,this.timeDelay=0,this.player.ti>=this.player.texts.length?(this.stage="runout",this.player.talking=!1):this.player.text=this.player.texts[this.player.ti]);break;case"runout":this.player.x+=8,this.player.x>1.1*width&&game.continue()}},AtLaunchPad.init=function(){this.stage="runin",this.timeDelay=0,this.gh=50+height/5.7,this.rocket={x:0,y:height-100,w:height/4,h:height/1.3,on:!1},this.rocket.oy=this.rocket.y,this.rocket.w=this.rocket.h*imgs.largerocket.width/imgs.largerocket.height,this.player={x:-width/2-100,y:height-150,h:100,texts:["Oh @!%#!","They just left!","But wait...","I bet they left enough stuff to build...","I bet they left enough stuff to build...","My own rocket!","I must go collect the parts"],text:"Oh @!%#!",ti:0},this.player.w=this.player.h*imgs.player.width/imgs.player.height,this.buildings=[];for(var t=-100;t<width+100;t+=90){var i=random(height/2,3*height/4),e=imgs.buildings[~~random(imgs.buildings.length)],s={img:e,x:t+random(50),y:height-this.gh-i,h:i,w:i*e.width/e.height};this.buildings.push(s)}this.buildings.sort(function(t,i){return t.h-i.h})},leaveMars.init=function(){this.background={img:imgs.marsbackground,x:0,y:0},this.background.aspect=this.background.img.width/this.background.img.height;let t=width/height;this.background.aspect>t?(this.background.h=height,this.background.w=this.background.h*this.background.aspect):(this.background.w=width,this.background.h=this.background.w*(1/this.background.aspect)),this.ground={img:imgs.marsarena,x:width/4,y:2*height/3,w:width,h:10},this.ground.h=this.ground.w*this.ground.img.height/this.ground.img.width,this.letter={img:imgs.letter,x:this.ground.x+this.ground.w/2,y:this.ground.y-5,w:100,h:100},this.letter.h=this.letter.w,this.letter.y-=this.letter.h,this.rock={img:imgs.marsrock,x:this.letter.x-20,y:this.ground.y,w:this.letter.w+80,h:1},this.rock.h=this.rock.w*this.rock.img.height/this.rock.img.width,this.rock.y-=this.rock.h,this.rocket={img:imgs.rocketOff,x:this.ground.x+30,y:this.ground.y,w:150,h:1},this.rocket.h=this.rocket.w*this.rocket.img.getHeight()/this.rocket.img.getWidth(),this.rocket.ch=23*this.rocket.h/24,this.rocket.y-=this.rocket.ch,this.player={img:imgs.player,x:1.1*width,y:this.ground.y,w:this.rocket.w/2,h:1,display:!0,s:1},this.player.h=this.player.w*this.player.img.height/this.player.img.width,this.player.y-=this.player.h,this.fuels=[],this.stage="walkin"},leaveMars.draw=function(){this.update(),this.display()},leaveMars.update=function(){switch(this.stage){case"walkin":this.player.x-=5;var t=this.rocket.x+2*this.rocket.w;this.player.x<=t&&(this.player.x=t,this.stage="throwfuel",this.fuelThrown=0);break;case"throwfuel":if(frameCount%20==0&&this.fuelThrown<10){var i={img:imgs.fueltank,x:this.player.x+this.player.w/2,y:this.player.y+this.player.h/2,w:.8*this.player.w,vy:-this.player.h/20,vx:-this.player.w/20};i.h=i.w*i.img.height/i.img.width,i.y-=i.h/2,i.x-=i.w/2,this.fuels.push(i),this.fuelThrown++}else 10==this.fuelThrown&&0==this.fuels.length&&(this.stage="goinrocket");for(var e=this.fuels.length-1;e>-1;e--){var s=this.fuels[e];s.vy+=.39,s.x+=s.vx,s.y+=s.vy,s.x+s.w/2<this.rocket.x+this.rocket.w/2&&this.fuels.splice(e,1)}break;case"goinrocket":this.player.x-=5,this.player.x+this.player.w/2<this.rocket.x+this.rocket.w/2&&(this.player.display=!1,this.stage="launch",this.rocket.img=imgs.rocketOn);break;case"launch":this.rocket.y-=20,this.rocket.y<2*-this.rocket.h&&game.continue()}},leaveMars.displayObject=function(t){"function"==typeof t.img.getHeight?drawAnimation(t.img,t.x+t.w/2,t.y+t.h/2,t.w,t.h):image(t.img,t.x,t.y,t.w,t.h)},leaveMars.display=function(){this.displayObject(this.background),this.displayObject(this.rock),this.displayObject(this.letter);for(var t=0;t<this.fuels.length;t++)this.displayObject(this.fuels[t]);this.player.display&&(push(),translate(this.player.x+this.player.w/2,this.player.y),scale(this.player.s,1),image(this.player.img,-this.player.w/2,0,this.player.w,this.player.h),pop()),this.displayObject(this.rocket),this.displayObject(this.ground)},marsLanding.init=function(){this.background={img:imgs.marsbackground,x:0,y:0},this.background.aspect=this.background.img.width/this.background.img.height;let t=width/height;this.background.aspect>t?(this.background.h=height,this.background.w=this.background.h*this.background.aspect):(this.background.w=width,this.background.h=this.background.w*(1/this.background.aspect)),this.ground={img:imgs.marsarena,x:width/4,y:2*height/3,w:width,h:10},this.ground.h=this.ground.w*this.ground.img.height/this.ground.img.width,this.letter={img:imgs.letter,x:this.ground.x+this.ground.w/2,y:this.ground.y-5,w:100,h:100},this.letter.h=this.letter.w,this.letter.y-=this.letter.h,this.largeletter={img:imgs.largeletter,x:0,y:0,w:min(width,height)-50,h:1,display:!1},this.largeletter.h=this.largeletter.w,this.largeletter.x=width/2-this.largeletter.w/2,this.largeletter.y=height/2-this.largeletter.h/2,this.rock={img:imgs.marsrock,x:this.letter.x-20,y:this.ground.y,w:this.letter.w+80,h:1},this.rock.h=this.rock.w*this.rock.img.height/this.rock.img.width,this.rock.y-=this.rock.h,this.rocket={img:imgs.rocketOn,x:this.ground.x+30,y:-300,w:150,h:1},this.rocket.h=this.rocket.w*this.rocket.img.getHeight()/this.rocket.img.getWidth(),this.rocket.collideH=23*this.rocket.h/24,this.working=1,this.stutterIndex=0,this.stutterTimer=5,this.stutterPath=[1,1,1,1,.3,1,1,1,.3,1,.3,.3,1,.3,.3,.3,0],this.player={img:imgs.player,x:this.rocket.x+this.rocket.w/4,y:this.ground.y,w:this.rocket.w/2,h:1,display:!1,s:-1},this.player.h=this.player.w*this.player.img.height/this.player.img.width,this.player.y-=this.player.h,this.martian={img:imgs.martian,x:width/2,y:-5,w:150,h:1},this.martian.h=this.martian.w*this.martian.img.height/this.martian.img.width,this.martian.y-=this.martian.h,this.text=["Oh &@#$!","I'm out of fuel!","I better go find some..."],this.textIndex=0,this.textTime=100,this.textTimer=this.textTime,this.playertext=this.text[0],this.displaytext=!1,this.stage="landing"},marsLanding.draw=function(){this.update(),this.display()},marsLanding.update=function(){switch(this.stage){case"landing":this.rocket.y+=15,this.rocket.y+this.rocket.collideH>=this.ground.y&&(this.rocket.y=this.ground.y-this.rocket.collideH,this.stage="player",this.rocket.img=imgs.rocketOff,this.player.display=!0);break;case"player":this.player.x+=5,this.player.x>=this.rock.x&&(this.player.x=this.rock.x+5,this.stage="letter",this.letterdelay=15,this.letter.y-=this.player.h/3);break;case"letter":this.letterdelay>0?this.letterdelay--:this.largeletter.display?(clicked||keys[32]||keys[" "])&&(this.largeletter.display=!1,this.stage="gotorocket",this.player.s=1,this.letter.y+=this.player.h/3):this.largeletter.display=!0;break;case"gotorocket":this.player.x-=5,this.player.x<=this.rocket.x&&(this.player.display=!1,this.player.x=this.rocket.x+this.rocket.w/2-this.player.w/2,this.stage="checkfuel");break;case"checkfuel":this.stutterTimer--,this.stutterTimer<=0&&(this.stutterTimer+=5,this.stutterIndex++,this.working=this.stutterPath[this.stutterIndex]),this.working>.5?this.rocket.img=imgs.rocketOn:this.working<.1?(this.stage="nofuel",this.player.display=!0,this.player.s=-1):this.rocket.img=imgs.rocketOff;break;case"nofuel":this.player.x<this.rocket.x+this.rocket.w+15?this.player.x+=5:(this.displaytext=!0,this.textTimer--,this.textTimer<=0&&(this.textTimer=this.textTime,this.textIndex++,this.textIndex>=this.text.length?(this.stage="leave",this.displaytext=!1):this.playertext=this.text[this.textIndex]));break;case"leave":this.player.x+=5,this.player.x>1.1*width&&(this.stage="martian");break;case"martian":this.martian.y+this.martian.h<this.ground.y?(this.martian.y+=15,this.martian.y=min(this.martian.y,this.ground.y-this.martian.h)):(this.martian.x+=5,this.martian.x>1.1*width&&game.continue())}},marsLanding.displayObject=function(t){image(t.img,t.x,t.y,t.w,t.h)},marsLanding.display=function(){if(this.displayObject(this.background),this.displayObject(this.ground),this.displayObject(this.rock),this.displayObject(this.letter),this.displayObject(this.martian),this.player.display&&(push(),translate(this.player.x+this.player.w/2,this.player.y),scale(this.player.s,1),image(this.player.img,-this.player.w/2,0,this.player.w,this.player.h),pop()),drawAnimation(this.rocket.img,this.rocket.x+this.rocket.w/2,this.rocket.y+this.rocket.h/2,this.rocket.w,this.rocket.h),this.displaytext){push(),fill(255),stroke(232),strokeWeight(2),textSize(25),textFont(fonts.pixel);var t=textAscent()+textDescent();textAlign(LEFT,TOP),rect(this.player.x-5,this.player.y-t-20,textWidth(this.playertext)+10,t+15),noStroke(),fill(0),text(this.playertext,this.player.x,this.player.y-t-10),pop()}this.largeletter.display&&(push(),noStroke(),fill(0,80),rect(0,0,width,height),pop(),this.displayObject(this.largeletter))};let moonGun={appear:!1,x:0,y:0,run:function(){if(this.appear){this.display();let t=moonPlayer;this.x>t.x+t.w/4&&(this.x-=3),this.y<t.y+t.h/2&&(this.y+=3)}},display:function(){push(),translate(this.x,this.y),scale(.025),image(imgs.moonGun,0,0),pop()},init:function(){this.appear=!1,this.x=manOnTheMoon.x,this.y=height/2}};function moon(){for(var t=0;t<width;t+=height)image(imgs.stars,t,0,height,height);manOnTheMoon.run(),image(imgs.moon,0,0,width,height),moonShip.run(),moonPlayer.run(),moonGun.run(),moonTextBox.run()}moon.init=function(){manOnTheMoon.init(),moonShip.init(),moonPlayer.init(),moonTextBox.init(),moonGun.init()};let manOnTheMoon={x:0,y:0,w:0,h:0,img:0,appear:!1,run:function(){this.display(),this.appear&&this.y>.67*height-this.h/2?this.y-=3:this.appear&&moonTextBox.line<20&&(moonTextBox.show=!0)},display:function(){push(),translate(this.x,this.y),imageMode(CENTER),image(this.img,0,0,this.w,this.h),pop()},init:function(){this.appear=!1,this.img=imgs.momdefault,this.w=max(width/3,height/2),this.h=this.w*this.img.height/this.img.width,this.x=width/2,this.y=height+this.w*this.img.height/this.img.width-50}},moonPlayer={x:0,y:0,w:40,h:0,direction:"right",wait:0,runAway:!1,run:function(){this.display(),this.appeared&&(this.wait++,this.wait>30&&(this.direction="left"),this.wait>60&&(this.direction="right"),this.wait>65&&(manOnTheMoon.appear=!0),this.runAway&&moonGun.x<this.x+this.w/2&&moonGun.y>this.y-this.h/2&&(this.direction="left",this.x-=3,this.x<-this.w/2&&game.continue()))},display:function(){push(),translate(this.x+this.w/2,this.y),"right"===this.direction&&scale(-1,1),image(this.img,-this.w/2,0,this.w,this.h),pop()},appear:function(){this.x=moonShip.x,this.y=moonShip.y-30,this.appeared=!0},init:function(){this.direction="right",this.x=-500,this.y=-500,this.img=imgs.player,this.h=this.w*this.img.height/this.img.width}},moonShip={x:0,y:0,w:100,h:40,moving:!0,offImgs:{},onImg:{},playerWait:0,run:function(){this.y<height/2+150?this.y+=3:(this.moving=!1,this.playerWait++,this.playerWait>40&&this.playerWait<100&&moonPlayer.appear()),this.display()},init:function(){this.x=width/2-350,this.y=-50,this.offImg=imgs.rocketOff,this.onImg=imgs.rocketOn,this.h=this.w*this.onImg.getHeight()/this.onImg.getWidth()},display:function(){push(),imageMode(CENTER),translate(this.x,this.y),this.moving?drawAnimation(this.onImg,0,0,this.w,this.h):drawAnimation(this.offImg,0,0,this.w,this.h),pop()}},moonConversation=["Fee fi fo fum! It is I, the man on the moon!","Wait, your the guy from dream works!","Yes that was me. However, my looks haven't quite stayed the same since I got space Diabetes.","Wow, you've aged so much since then.","How dare you! I'll have you know that I'm at the young age of 4.53 billion years. I'm in my prime! I'm practically fresh out of the womb!","But your hair is gray!","Shut up, space diabetes has some unspeakable effects.","I'm sorry, I shouldn't have mentioned your incredibly miserable space Diabetes.","You're right, you should have! Listen, why did you come to my neck of the woods?","There are no trees here.","Yeah, but there are necks.","You said 'neck' singular.","It's a figure of speech!","Ok sure. In response to your earlier inquiry, I'm here to refuel. The human race abandoned me yesterday and I am heading to Mars. Any advice?","Yeah, don't let the Martians bite you, if you do the tip of the side of your left ring finger will hurt for two weeks, four days, three hours, fourteen minutes, and seventy two seconds","There are martians?","yeah, and I'm warning you, their bites are more painful than you would believe! Don't let them bite you. Here, I want you to have this.","","This gun is incredibly important to me. Take care of it. It has been passed down through my family for generations. My father gave it to me shortly before he passed away, along with a very important message, to uphold the family honor. In his last breath, he requested that--","Ok thanks!"],moonTextBox={x:0,y:0,w:400,h:200,padding:10,text:"",textShowing:0,line:0,show:!1,run:function(){!0===this.show&&(this.textShowing>=this.text.length&&(keysReleased[" "]||keysReleased[32]||clicked)?(this.line++,17===this.line&&(this.line++,moonGun.appear=!0),this.line<20?(this.text=moonConversation[this.line],this.textShowing=0):(this.show=!1,this.text="",moonPlayer.runAway=!0)):(keysReleased[" "]||keysReleased[32]||clicked)&&(this.textShowing=this.text.length),this.display(),this.textShowing+=.5)},display:function(){this.line%2==0?this.speaker="Man On The Moon":this.speaker="Tom",push(),fill(232),stroke(240),strokeWeight(5),rect(this.x,this.y,this.w,this.h),fill(0,0,0),textSize(15),stroke(255),strokeWeight(1),textFont(fonts.pixel),this.line<20&&text(this.speaker+": "+this.text.substr(0,this.textShowing),this.x+this.padding,this.y+this.padding,this.w-2*this.padding,this.h-2*this.padding),0===this.line&&this.textShowing>=this.text.length&&text("Press space to continue",this.x+this.padding,this.y+this.h-20-2*this.padding),pop()},init:function(){this.x=width/2-this.w/2,this.y=height-this.h-20,this.line=0,this.show=!1,this.text=moonConversation[this.line],this.textShowing=0}};function RocketBuilt(){RocketBuilt.draw()}function UfoCutscene(){UfoCutscene.draw()}function wakeUpScene(){wakeUpScene.draw()}function MBullet(t,i,e){this.x=t,this.y=i,this.w=40,this.h=10,this.vx=e}function MFuel(t,i,e){this.x=t,this.y=i,this.img=imgs.fueltank,this.w=e,this.h=this.w*this.img.height/this.img.width,this.collected=!1}RocketBuilt.init=function(){this.ground={y:5*height/6},this.buildings=[];for(var t=-100;t<width+100;t+=90){var i=random(height/2,3*height/4),e=imgs.buildings[~~random(imgs.buildings.length)],s={img:e,x:t+random(50),y:this.ground.y-i,h:i,w:i*e.width/e.height};this.buildings.push(s)}this.buildings.sort(function(t,i){return t.h-i.h}),this.player={x:-100,y:this.ground.y+30,w:80,h:0,img:imgs.player,showing:!0},this.player.h=this.player.w*this.player.img.height/this.player.img.width,this.player.y-=this.player.h,this.pieces=[{x:width/2-15,y:-100,w:100,img:imgs.rocketfin,falling:!0,landY:this.ground.y+10},{x:width/2+30,y:-500,w:100,img:imgs.rocketengine.images[0],falling:!0,landY:this.ground.y+25},{x:width/2+15,y:-200,w:100,img:imgs.rockettail,falling:!0,landY:this.ground.y+50}];for(t=0;t<this.pieces.length;t++){var h=this.pieces[t];h.h=h.w*h.img.height/h.img.width}this.light={x:width/2,y:height/2,w:width/100,h:height/100,a:255,on:!1},this.rocket={img:imgs.rocketOff,built:!1,x:width/2,y:this.ground.y+70,w:250,countdown:20},this.rocket.h=this.rocket.w*this.rocket.img.getHeight()/this.rocket.img.getWidth(),this.rocket.y-=this.rocket.h,this.stage="enter"},RocketBuilt.draw=function(){this.update(),this.display()},RocketBuilt.update=function(){switch(this.stage){case"enter":this.player.x+=5,this.player.x>width/3&&(this.stage="pieces");break;case"pieces":for(var t=!0,i=0;i<this.pieces.length;i++){var e=this.pieces[i];e.falling&&(e.y+=15,e.y+e.h>e.landY&&(e.falling=!1,e.y=e.landY-e.h),t=!1)}t&&(this.stage="light",this.light.on=!0);break;case"light":this.light.w>4*width?(this.light.w=3*width,this.light.h=3*height,this.light.a=254,this.pieces=[],this.rocket.built=!0):255==this.light.a?(this.light.w*=1.1,this.light.h*=1.1):this.light.a<=0?this.stage="board":this.light.a-=5;break;case"board":this.player.x+this.player.w/2<this.rocket.x+this.rocket.w/2?this.player.x+=5:(this.stage="takeoff",this.rocket.img=imgs.rocketOn,this.player.showing=!1);break;case"takeoff":this.rocket.countdown>0?this.rocket.countdown--:this.rocket.y<-height?game.continue():this.rocket.y-=20}},RocketBuilt.display=function(){background(100,200,255),push(),noStroke(),fill(100,120,120,100);for(var t=0;t<this.buildings.length;t++){var i=this.buildings[t];t/5==round(t/5)&&rect(0,0,width,height),image(i.img,i.x,i.y,i.w,i.h)}rect(0,0,width,height),fill(0,80,0),rect(0,this.ground.y,width,height-this.ground.y),pop(),this.player.showing&&(push(),translate(this.player.x+this.player.w/2,this.player.y),scale(-1,1),image(this.player.img,-this.player.w,0,this.player.w,this.player.h),pop());for(t=0;t<this.pieces.length;t++){var e=this.pieces[t];image(e.img,e.x,e.y,e.w,e.h)}this.rocket.built&&drawAnimation(this.rocket.img,this.rocket.x+this.rocket.w/2,this.rocket.y+this.rocket.h/2,this.rocket.w,this.rocket.h),this.light.on&&(push(),noStroke(),fill(255,this.light.a),ellipse(this.light.x,this.light.y,this.light.w,this.light.h),pop())},UfoCutscene.init=function(){this.n=width/1e3,this.t=0,this.background={img:imgs.stars,x:0,y:0,w:width,h:height},this.venus={img:imgs.venus,x:2*width/3,y:2*height/3,w:width/4,h:width/4},this.ufo={img:imgs.ufoboss,x:width/3+25*this.n,y:0,w:width/3,init:function(){this.h=this.w*this.img.height/this.img.width,this.y-=this.h,this.x-=this.w/2}},this.ufo.init(),this.rocket={img:imgs.rocketOn,r:120,x:0,y:0,w:100,init:function(){this.h=this.w*this.img.getHeight()/this.img.getWidth(),this.y-=this.h/2,this.x-=1.5*this.h}},this.rocket.init(),this.stage="flyin-rocket"},UfoCutscene.update=function(){this.t++;var t=this.rocket,i=this.ufo,e=i=>{var e=sin(t.r)*this.n*5,s=-cos(t.r)*this.n*5;t.x+=e,t.y+=s};switch(this.stage){case"flyin-rocket":e(),t.x+t.w/2>width/3&&(this.stage="flyin-ufo");break;case"flyin-ufo":e();var s=height+i.h,h=width/2-25*this.n,o=i.y-s,n=i.x-h,r=mag(o,n),a=n,l=o;o/=r,n/=r;var u=10*this.n/n/r;a*=u,l*=u,i.x+=a,i.y+=l,i.y>height/3&&(t.r=lerp(t.r,-90,.1)),i.y>s&&(this.stage="flyout-rocket");break;case"flyout-rocket":e(),t.x<1.5*-t.h&&game.continue()}},UfoCutscene.displayObject=function(t){push(),translate(t.x+t.w/2,t.y+t.h/2),"number"==typeof t.r&&rotate(t.r),"function"==typeof t.img.getHeight?drawAnimation(t.img,0,0,t.w,t.h):image(t.img,-t.w/2,-t.h/2,t.w,t.h),pop()},UfoCutscene.display=function(){this.displayObject(this.background),this.displayObject(this.venus),this.displayObject(this.ufo),this.displayObject(this.rocket)},UfoCutscene.draw=function(){background(0),this.update(),this.display()},wakeUpScene.draw=function(){if(background(255),this.update(),push(),scale(1/this.c.s),translate(-this.c.tx,-this.c.ty),image(this.roomimg,0,0,this.rw,this.rh),image(imgs[this.openMouth?"newsclosed":"newsopen"],this.tv.x,this.tv.y,this.tv.w,this.tv.h),this.player.isSleeping){push(),translate(this.player.tx,this.player.y),scale(-1,1),rotate(90);this.rw;image(imgs.player,0,0,this.player.w,this.player.h),pop()}else{push(),translate(this.player.tx,this.player.y),scale(-1,1);this.rw;image(imgs.player,this.player.x,0,this.player.w,this.player.h),fill(0,50),noStroke(),ellipse(this.player.x+.45*this.player.w,.99*this.player.h,this.player.w,this.player.w/4),pop()}this.textBox.run(),pop()},wakeUpScene.update=function(){switch(this.time++,this.mouthDelay--,this.mouthDelay<=0&&(this.openMouth=!this.openMouth,this.mouthDelay+=random(30,80)),this.time>30&&"sleep"==this.stage&&(this.stage="zoom",this.c.t=0),this.player.runAway&&(this.player.x-=8,this.player.x<-width&&game.continue()),this.stage){case"zoom":var t=.05,i={x:this.tv.x-.1*width,y:this.tv.y-.05*width,s:3};i.s=1/i.s,this.c.t++,this.c.t<100?(this.c.tx=lerp(this.c.tx,i.x,t),this.c.ty=lerp(this.c.ty,i.y,t),this.c.s=lerp(this.c.s,i.s,t)):this.stage="subtitles";break;case"subtitles":this.textBox.show=!0,this.c.t=0;break;case"zoomout":if(this.textBox.show=!1,this.c.t++,this.c.t<100){t=.05;this.c.tx=lerp(this.c.tx,0,t),this.c.ty=lerp(this.c.ty,0,t),this.c.s=lerp(this.c.s,1,t)}else this.stage="###",this.textBox.show=!0,this.player.isSleeping=!1,this.player.y=.52*this.rh,this.player.x-=this.player.w;break;case"###":this.textBox.show||(this.stage="player");break;case"player":this.textBox.show=!1,this.player.runAway=!0}},wakeUpScene.init=function(){this.time=0,this.stage="sleep",this.roomimg=imgs.homeroom;var t=this.roomimg,i=t.width/t.height;i<width/height?(this.rw=width,this.rh=width/i):(this.rh=height,this.rw=this.rh*i);var e=170,s={x:74,y:44,w:22,h:12},h=this.rw/e;this.tv={x:h*s.x,y:h*s.y,w:h*s.w,h:h*s.h},this.player={tx:.38*this.rw,x:0,y:.58*this.rh,w:this.rw/15,isSleeping:!0},this.player.h=this.player.w*imgs.player.height/imgs.player.width,this.openMouth=!1,this.mouthDelay=50,this.c={tx:0,ty:0,s:1},this.textBox.init(),this.textBox.x=width/2-this.textBox.w/2,this.textBox.y=25,this.player.x=0},wakeUpScene.textBox={x:0,y:0,w:400,h:200,padding:10,text:"",textShowing:0,line:0,show:!1,run:function(){!0===this.show&&(this.textShowing>=this.text.length&&(keysReleased[" "]||keysReleased[32]||clicked)?(this.line++,7==this.line&&(this.parent.stage="zoomout"),this.line<8?(this.text=this.conversation[this.line],this.textShowing=0):"###"==this.parent.stage&&(this.show=!1,this.text="")):(keysReleased[" "]||keysReleased[32]||clicked)&&(this.textShowing=this.text.length),this.adjust(),this.display(),this.textShowing+=.5)},adjust:function(){var t=this.parent;"subtitles"==t.stage?(this.x=t.tv.x-1,this.y=t.tv.y-1,this.w=t.tv.w+2,this.h=t.tv.h+2,this.ts=8,this.bg=color(0,200),this.st=color(0,0),this.tc=color(255,200),this.tst=color(0,0)):"###"==t.stage&&(this.w=300,this.h=50,this.x=t.player.tx-t.player.x-this.w/2-t.player.w/2,this.y=t.player.y-this.h-this.padding,this.ts=20,this.bg=null,this.st=null,this.tc=null,this.tst=null)},display:function(){push(),fill(this.bg||232),stroke(this.st||255),strokeWeight(5),rect(this.x,this.y,this.w,this.h),fill(this.tc||0),stroke(this.tst||255),strokeWeight(1),textFont(fonts.pixel),textSize(this.ts||15),this.line<9&&text(this.text.substr(0,this.textShowing),this.x+this.padding,this.y+this.padding,this.w-2*this.padding,this.h-2*this.padding),0===this.line&&this.textShowing>=this.text.length&&text("Press space to continue",this.x+this.padding,this.y+this.h-this.padding),pop()},init:function(){this.parent=wakeUpScene,this.x=width/2-this.w/2,this.y=height-this.h-20,this.line=0,this.text=this.conversation[this.line],this.show=!1,this.textShowing=0}},wakeUpScene.textBox.conversation=["Clint Stinkwood: Good afternoon ladies and gentlemen, I'm Clint Stinkwood and I'm here in Los Angeles, at The News Show studio, a few miles away from the launch site of the Savior space shuttle.","Clint Stinkwood: We're just minutes away from the \"All aboard\" time, at which point the Savior will close all it's doors and prepare for launch.","Clint Stinkwood: It's been a long and hard journey to get to this point, the human race is no longer capable of remaining here on earth with all of the toxic waste that has filled our streets and cities.","Clint Stinkwood: After many years of trying to study and inventions, we are finally ready for the human race to make the epic journey to Mars on the Savior, where we will rebuild our civilization.","Clint Stinkwood: It's time to say goodbye to our once beautiful and colorful planet earth, and make way for a new era of cleanliness and save living once again!","Clint Stinkwood: I'm Clint Stinkwood on channel 953.673B, The News Show, and I'll see you next time on the planet Mars.","PLEASE NOTE THAT ANYONE NOT ON THE SAVIOR BY THE ALL ABOARD TIME WILL BE LEFT BEHIND. IF YOU HAVE NOT YET ENTERED THE SHUTTLE, PLEASE GET YOU AND YOUR FAMILY MEMBERS ONTO IT AS SOON AS POSSIBLE.","Tom: Oh @!%#! I gotta go!"],MBullet.prototype.collide=function(t){let i=abs(this.vx);this.x+i>t.x&&this.x-i<t.x+t.w&&this.y+this.h/2>t.y&&this.y-this.h/2<t.y+t.h&&(t.kvx+=this.vx>0?15:-15,"function"==typeof t.jump&&t.jump(),t.health--,this.dead=!0)},MBullet.prototype.update=function(){this.x+=this.vx},MBullet.prototype.display=function(){noStroke(),push(),fill(200,225,255),rectMode(CENTER),rect(this.x,this.y,this.w,this.h),pop()},MBullet.prototype.run=function(t){for(var i=0;i<t.length;i++)this.collide(t[i]);this.update(),this.display()},MFuel.prototype.collide=function(t){t.x+t.w>this.x&&t.x<this.x+this.w&&t.y+t.h>this.y&&t.y<this.y+this.h&&(this.collected=!0,t.fuel++)},MFuel.prototype.display=function(){push(),translate(this.x+this.w/2,this.y),scale(cos(3*frameCount),1),image(this.img,-this.w/2,0,this.w,this.h),pop()},MFuel.prototype.run=function(t){this.collide(t),this.display()};let mGame={player:null,martians:[],bullets:[],fuels:[],rocks:[],ground:{y:0,w:5e3,h:0,display:function(){push(),imageMode(CENTER),image(this.img,0,this.y+this.h/2,this.w,this.h),pop()},collide:function(t){for(var i=0;i<t.length;i++){let e=t[i],s=2*abs(e.vy);e.x+e.w>-this.w/2&&e.x<this.w/2&&e.y+e.h+s/2>this.y&&e.y+.9*e.h-s<this.y&&(e.y=this.y-e.h,e.vy=min(e.vy,0),e.grounded=!0)}}},background:{w:0,h:0,img:{}},transX:0,transY:0,timePassed:0,init:function(t){this.player=new MPlayer(-30,-200,60),this.ground.img=imgs.marsarena,this.ground.h=this.ground.w*this.ground.img.height/this.ground.img.width,this.background={img:imgs.marsbackground,x:0,y:0},this.background.aspect=this.background.img.width/this.background.img.height;let i=width/height;if(this.background.aspect>i?(this.background.h=height+1/this.background.aspect*200,this.background.w=this.background.h*this.background.aspect):(this.background.w=width+200*this.background.aspect,this.background.h=this.background.w*(1/this.background.aspect)),this.bw=this.ground.w/40,"object"==typeof t){this.rocks=[];for(var e=0;e<t.length;e++){let i=t[e];"string"==typeof i.x&&(i.x=parseFloat(i.x)),"string"==typeof i.y&&(i.y=parseFloat(i.y)),this.rocks.push(new MRock(map(i.x,-100,100,-this.ground.w/2,this.ground.w/2-this.bw),i.y,this.bw))}}this.reload(),this.freeplayLevel=null},reload:function(){this.player.reset(),this.martians=[],this.martians.push(new Martian(-this.ground.w/2+50,-200,100)),this.bullets=[],this.fuels=[],this.timePassed=0},reset:function(){this.player=new MPlayer(-30,-200,60),this.reload()},finish:function(){"playlevel"==game.currentScene?(this.freeplayLevel&&this.freeplayLevel.levelBuilderLevel&&(this.freeplayLevel.verified=!0,levelBuilder.save()),game.setScene(this.gobackto)):game.continue()},run:function(){this.timePassed++,this.martians.length<constrain(map(this.timePassed,50,1e3,1,3),1,8)&&frameCount%180==0&&(this.player.x>0?this.martians.push(new Martian(random(-this.ground.w/2,-width/2-110),-200,100)):this.martians.push(new Martian(random(this.ground.w/2-100,width/2+110),-200,100))),push(),translate(map(this.transX,-this.ground.w/2,this.ground.w/2,-50,50)+width/2,map(this.transY,-height,height,-50,50)+height/2),imageMode(CENTER),image(this.background.img,0,0,this.background.w,this.background.h),pop(),push(),this.player.update(),translate(this.transX+width/2,this.transY+height/2),this.ground.display(),this.ground.collide([this.player].concat(this.martians));for(var t=this.martians.length-1;t>-1;t--)this.martians[t].run(this.player),this.martians[t].dead&&this.martians.splice(t,1);for(t=0;t<this.rocks.length;t++)this.rocks[t].run([this.player].concat(this.martians));this.player.display();for(t=this.bullets.length-1;t>-1;t--)this.bullets[t].run(this.martians),this.bullets[t].dead&&this.bullets.splice(t,1);for(t=this.fuels.length-1;t>-1;t--)this.fuels[t].run(this.player),this.fuels[t].collected&&this.fuels.splice(t,1);pop(),this.player.displayStatus()}};function fightMartians(){background(0),mGame.run()}function Martian(t,i,e){this.x=t,this.y=i,this.vx=0,this.kvx=0,this.vy=0,this.img=imgs.martian,this.w=e,this.h=this.w*this.img.height/this.img.width,this.maxHealth=random(1.5,2.5),this.health=this.maxHealth,this.dhealth=this.health,this.dead=!1}function MPlayer(t,i,e){this.x=t,this.y=i,this.ox=this.x,this.oy=this.y,this.vx=0,this.kvx=0,this.vy=0,this.img=imgs.player,this.w=e,this.h=this.w*this.img.height/this.img.width,this.gun=imgs.moonGun,this.gun.w=this.w/2,this.gun.h=this.gun.w,this.fuelIcon=imgs.fueltank,this.heartIcon=imgs.pixelheart,this.maxlifes=3,this.lifes=this.maxlifes,this.maxHealth=6,this.health=this.maxHealth,this.dhealth=this.health,this.neededFuel=10,this.fuel=0,this.dfuel=this.fuel,this.reload=0,this.reloadTime=36,this.cooldownTime=30,this.cooldown=this.cooldownTime,this.direction=RIGHT}function MRock(t,i,e){this.x=t,this.y=0,this.img=imgs.marsrock,this.w=e,this.h=this.w*this.img.height/this.img.width,this.y-=this.h*(i+1)}fightMartians.init=function(t){mGame.init(t||mrocks)},Martian.prototype.jump=function(){this.grounded&&this.vy>=-.5&&(this.vy-=15,this.grounded=!1)},Martian.prototype.collide=function(t){let i=abs(this.vx)+abs(t.vx),e=abs(this.vy)+abs(t.vy);this.x+this.w-i>t.x&&this.x+i<t.x+t.w&&this.y+this.h-e>t.y&&this.y+e<t.y+t.h&&(this.jump(),t.damage(),this.x+this.w/2>t.x+t.w/2?(t.kvx-=25,this.kvs-=15):(t.kvx+=25,this.kvs+=15))},Martian.prototype.control=function(t){this.x>t.x+t.w?this.vx-=2.5:this.x+this.w<t.x?this.vx+=2.5:this.jump()},Martian.prototype.update=function(t){this.control(t),this.collision&&(this.jump(),this.collision=!1),this.grounded||(this.vy+=.5),this.vx*=.75,this.kvx*=.9,this.vy*=.99,this.x+=this.vx+this.kvx,this.y+=this.vy,this.grounded=!1,this.health<=0&&(~~random(2)&&mGame.fuels.push(new MFuel(this.x+this.w/8,this.y,6*this.w/8)),this.dead=!0),this.y>1.5*height&&(this.dead=!0),this.dhealth=lerp(this.dhealth,this.health,.1),this.y>3*height&&(this.dead=!0)},Martian.prototype.display=function(){push(),translate(this.x+this.w/2,this.y),push(),this.vx>=0&&scale(-1,1),image(this.img,-this.w/2,0,this.w,this.h),pop(),this.health!=this.maxHealth&&(push(),fill(lerpColor(color(200,0,0),color(0,200,0),this.dhealth/this.maxHealth)),noStroke(),rect(-this.w/2,-50,this.dhealth/this.maxHealth*this.w,30),stroke(100),strokeWeight(2),strokeCap(SQUARE),noFill(),rect(-this.w/2,-50,this.w,30),pop()),pop()},Martian.prototype.run=function(t){this.collide(t),this.update(t),this.display()},MPlayer.prototype.damage=function(){0==this.cooldown&&(this.health--,this.cooldown=this.cooldownTime)},MPlayer.prototype.control=function(){(keys[RIGHT_ARROW]||keys.d)&&(this.vx+=5,this.direction=RIGHT),(keys[LEFT_ARROW]||keys.a)&&(this.direction=LEFT,this.vx-=5),(keys[UP_ARROW]||keys.w)&&this.grounded&&this.vy>-1&&(this.vy-=20,this.grounded=!1),(keys[32]||keys[" "])&&0==this.reload&&(this.reload=this.reloadTime,mGame.bullets.push(new MBullet(this.x+this.w/2,this.y+this.h/9+this.h/2,20*(this.direction==RIGHT?1:-1)+this.vx)))},MPlayer.prototype.update=function(){this.control(),this.reload>0&&this.reload--,this.cooldown>0&&this.cooldown--,this.vy+=.5,this.vx*=.75,this.kvx*=.9,this.vy*=.99,this.x+=this.vx+this.kvx,this.y+=this.vy;mGame.transX=lerp(mGame.transX,constrain(-this.x,-mGame.ground.w,mGame.ground.w),.2),mGame.transY=lerp(mGame.transY,max(-this.y-this.h/2,-height),.2),this.y>1.5*height&&(this.health-=.2),this.health<=0&&(this.lifes--,this.lifes<=0?mGame.reset():mGame.reload()),this.grounded=!1,this.fuel>=this.neededFuel&&mGame.finish(),this.dfuel=lerp(this.dfuel,this.fuel,.1),this.dhealth=lerp(this.dhealth,this.health,.1)},MPlayer.prototype.display=function(){(0==this.cooldown||frameCount%8<4)&&(push(),translate(this.x+this.w/2,this.y+this.h/2),this.direction==RIGHT&&scale(-1,1),imageMode(CENTER),image(this.img,0,0,this.w,this.h),scale(-1,1),image(this.gun,-this.w/8,this.h/9,this.gun.w,this.gun.h),pop())},MPlayer.prototype.displayStatus=function(){push(),translate(width,0),push(),noStroke();for(var t=0;t<this.lifes;t++){let i=50;image(this.heartIcon,200*-(t+1)/3+i/8-30,10,i,i)}fill(lerpColor(color(200,0,0),color(0,200,0),this.dhealth/this.maxHealth)),rect(-230,70,this.dhealth/this.maxHealth*200,50),fill(200,120,0),rect(-230,130,this.dfuel/this.neededFuel*200,50),imageMode(CENTER),image(this.fuelIcon,-130,155,40*this.fuelIcon.width/this.fuelIcon.height,40),pop(),push(),stroke(100),strokeWeight(5),strokeCap(SQUARE),noFill(),rect(-230,70,200,50),rect(-230,130,200,50),pop(),pop()},MPlayer.prototype.reset=function(){this.x=this.ox,this.y=this.oy,this.vx=0,this.vy=0,this.health=this.maxHealth},MRock.prototype.collide=function(t){let i=abs(t.vx)+abs(t.kvx),e=abs(t.vy);t.x+t.w+i+1>this.x&&t.x-i-1<this.x+this.w&&t.y+t.h+e>this.y&&t.y-e<this.y+this.h&&(t.x+t.w-2*i-1>this.x&&t.x+2*i+1<this.x+this.w?t.y+t.h/2>this.y+this.h/2?(t.y=max(t.y,this.y+this.h),t.y<=this.y+this.h&&(t.vy=max(t.vy,0))):(t.y=min(t.y,this.y-t.h),t.vy=min(t.vy,0),t.vy>=0&&(t.grounded=!0)):t.y+t.h-e-1>this.y&&t.y+e+1<this.y+this.h&&(t instanceof Martian&&(t.collision=!0),t.x+t.w/2>this.x+this.w/2?(t.x=max(t.x,this.x+this.w),t.x<=this.x+this.w&&(t.vx=max(t.vx,0),t.kvx=max(t.kvx,0))):(t.x=min(t.x,this.x-t.w),t.x+t.w>=this.x&&(t.vx=min(t.vx,0),t.kvx=min(t.kvx,0)))))},MRock.prototype.display=function(){push(),image(this.img,this.x,this.y,this.w,this.h),pop()},MRock.prototype.run=function(t){for(var i=0;i<t.length;i++)this.collide(t[i]);this.display()};let mrocks=[{x:-100,y:0},{x:-99,y:.8},{x:-96,y:0},{x:-50,y:0},{x:-47,y:.2},{x:-44,y:0},{x:17,y:0},{x:20,y:0},{x:23,y:0},{x:22,y:.8},{x:18,y:.8},{x:20,y:1.6},{x:60,y:0},{x:62,y:.75},{x:64,y:1.5},{x:64.5,y:.75},{x:64.5,y:0},{x:80,y:0},{x:83,y:.5}];function Asteroid(t,i,e){this.x=t,this.y=i,this.radius=e,this.health=3,this.dead=!1,this.frame=0}Asteroid.prototype.run=function(t){this.display(),this.dead||t&&this.collide(t),this.health<1&&(this.dead=!0)},Asteroid.prototype.collide=function(t){let i=dist(this.x,this.y,t.x,t.y),e=this.radius+(t.w+t.h)/4;for(var s in i<e&&(this.dead=!0,t.health--),lasers){let t=lasers[s];(i=dist(this.x,this.y,t.x,t.y))<(e=t.radius+this.radius)&&(t.dead=!0,this.health--)}},Asteroid.prototype.display=function(){this.dead?(this.img=imgs.explosion[round(this.frame/2)],this.frame++):this.img=imgs.asteroid,push(),imageMode(CENTER),image(this.img,this.x,this.y,2*this.radius,2*this.radius),pop()};let asteroids=[];function FlyFreeplay(){push(),background(0,0,0),FlyFreeplay.transX=0;var t=FlyFreeplay.level.w,i=width/2;flyPlayer.x>i&&flyPlayer.x<t?FlyFreeplay.transX=-flyPlayer.x+i:flyPlayer.x>t&&(FlyFreeplay.transX=-t+i),flyPlayer.x>t+i&&(game.setScene(FlyFreeplay.gobackto),FlyFreeplay.levelObject.levelBuilderLevel&&(FlyFreeplay.levelObject.verified=!0,levelBuilder.save())),translate(FlyFreeplay.transX,0),displayStars();for(var e=lasers.length-1;e>-1;e--)lasers[e].run(),lasers[e].dead&&lasers.splice(e,1);for(e=ufos.length-1;e>-1;e--)ufos[e].run(flyPlayer),ufos[e].dead&&ufos[e].frame>20&&ufos.splice(e,1);for(e=asteroids.length-1;e>-1;e--)asteroids[e].run(flyPlayer),asteroids[e].dead&&asteroids[e].frame>20&&asteroids.splice(e,1);for(e=bosses.length-1;e>-1;e--)bosses[e].run(flyPlayer),bosses[e].dead&&bosses[e].frame>20&&bosses.splice(e,1);flyPlayer.run(),pop(),flyPlayer.displayHealth()}function Laser(t,i,e,s,h){this.x=t+50*sin(e),this.y=i-50*cos(e),this.r=e,this.radius=10,this.speed=s,this.dead=!1,this.belongsTo=h||"player"}FlyFreeplay.set=function(t,i){this.levelObject=t,this.level=this.levelObject.objects,this.gobackto=i},FlyFreeplay.init=function(){(flyPlayer=new FlyPlayer(50,height/2)).init(),this.level.w=this.level.width/100*height,loadDynamicLevel(this.level)},Laser.prototype.run=function(){this.display(),this.update()},Laser.prototype.update=function(){this.x+=this.speed*sin(this.r),this.y-=this.speed*cos(this.r)},Laser.prototype.display=function(){stroke(201,34,34),push(),strokeWeight(this.radius),translate(this.x,this.y),rotate(this.r),line(0,0,0,this.radius),pop()};let lasers=[];var bosses=[];function loadLevel(t){for(var i in flySigns=[],asteroids=[],bosses=[],t.boss)bosses.push(new UfoBoss(t.boss[i][0],t.boss[i][1]));for(var i in t.asteroids){let e=t.asteroids[i];asteroids.push(new Asteroid(e[0],e[1],e[2]))}for(var i in ufos=[],t.ufos){let e=t.ufos[i];ufos.push(new Ufo(e[0],e[1]*height/100))}}function loadDynamicLevel(t){if(flySigns=[],asteroids=[],ufos=[],bosses=[],t.asteroids)for(var i=0;i<t.asteroids.length;i++){let s=t.asteroids[i];for(var e=0;e<s.length;e++)"string"==typeof s[e]&&(s[e]=parseFloat(s[e]));asteroids.push(new Asteroid(s[0]/100*height,s[1]/100*height,s[2]/200*height))}if(t.ufos)for(i=0;i<t.ufos.length;i++){let s=t.ufos[i];for(e=0;e<s.length;e++)"string"==typeof s[e]&&(s[e]=parseFloat(s[e]));ufos.push(new Ufo(s[0]/100*height,s[1]/100*height,s[2]/200*height))}if(t.boss)for(i=0;i<t.boss.length;i++){var s=t.boss[i];for(e=0;e<s.length;e++)"string"==typeof s[e]&&(s[e]=parseFloat(s[e]));bosses.push(new UfoBoss(s[0]/100*height,s[1]/100*height,s[2]/200*height))}}function flyToMars(){for(var t in background(0),push(),flyPlayer.x>width/2&&(flyPlayer.x<6750?translate(-flyPlayer.x+width/2,0):flyPlayer.x>6750+width/2?game.continue():translate(width/2-6750,0)),displayStars(),image(imgs.moonsphere,-height/5,3*height/4,height/3,height/3),image(imgs.mars,6750+width/2-height/7,height/4,height/5,height/5),lasers)lasers[t].run(),lasers[t].dead&&lasers.splice(t,1);for(t=ufos.length-1;t>-1;t--)ufos[t].run(flyPlayer),ufos[t].dead&&ufos[t].frame>20&&ufos.splice(t,1);flyPlayer.run();for(t=asteroids.length-1;t>-1;t--)asteroids[t].run(flyPlayer),asteroids[t].dead&&asteroids[t].frame>20&&asteroids.splice(t,1);pop(),flyPlayer.displayHealth()}function flyToMoon(){for(var t in push(),background(0,0,0),flyPlayer.x>width/2&&flyPlayer.x<5500?translate(-flyPlayer.x+width/2,0):flyPlayer.x>5500&&translate(width/2-5500,0),flyPlayer.x>5500+width/2&&game.continue(),displayStars(),image(imgs.moonsphere,5500+width/2-height/7,height/4,height/5,height/5),flySigns)flySigns[t].display(flyPlayer);for(var t in lasers)lasers[t].run(),lasers[t].dead&&lasers.splice(t,1);for(var t in flyPlayer.run(),asteroids)asteroids[t].run(flyPlayer),asteroids[t].dead&&asteroids[t].frame>20&&asteroids.splice(t,1);pop(),flyPlayer.displayHealth()}function FlyPlayer(t,i){this.x=t,this.y=i,this.vx=0,this.vy=0,this.maxv=14,this.r=90,this.health=3,this.w=100,this.h=40,this.speed=5,this.rvel=0,this.offImg={},this.onImg={},this.shootCooldown=0,this.thrustCooldown=30}flyToMars.init=function(){(flyPlayer=new FlyPlayer(50,height/2)).init(),this.level={asteroids:[[1200,height/2,100],[1800,150,95],[2e3,height-100,95],[2400,height-125,80],[2900,height/2,125],[4500,100,100],[4500,height-100,100],[4700,height/2+150,100],[4700,height/2-150,100]],ufos:[[1800,height/2],[3400,200],[4e3,100],[4e3,height-100],[6500,height/2],[6500,100],[6500,height-100]]},loadLevel(this.level)},flyToMoon.init=function(){(flyPlayer=new FlyPlayer(50,height/2)).init(),(flySigns=[]).push(new FlySign(200,"Press space to accelerate, use the left and right arrow keys or a and d to steer")),asteroids=[],flySigns.push(new FlySign(2900,"Look out for asteroids!"));for(var t=-300;t<height+300;t+=300)asteroids.push(new Asteroid(5200,t,150));flySigns.push(new FlySign(4400,"Press Z to shoot, try blowing up an asteroid")),asteroids.push(new Asteroid(3500,height/2,125))},FlyPlayer.prototype.init=function(){this.offImg=imgs.rocketOff,this.onImg=imgs.rocketOn,this.h=this.w*this.onImg.getHeight()/this.onImg.getWidth()},FlyPlayer.prototype.run=function(t){this.display(),this.control(),this.update(t),this.collide(),this.health<1&&game.getFunc().init()},FlyPlayer.prototype.displayHealth=function(){push(),stroke(94,94,94),strokeWeight(10),fill(0,0,0),rect(width-200,50,150,50),fill(39,183,20),noStroke(),rect(width-200+5,55,map(this.health,0,3,0,140),40),pop()},FlyPlayer.prototype.update=function(t){this.shootCooldown++,this.thrustCooldown++,this.r+=this.rvel,this.rvel*=.9,this.x+=this.vx,this.y+=this.vy;var i=mag(this.vx,this.vy);i>this.maxv&&(this.vx*=this.maxv/i,this.vy*=this.maxv/i),this.speed*=.9,this.speed=constrain(this.speed,-5,5),this.y-this.h/1.7>height?this.y-=height+this.h/1.8+this.h/1.7:this.y+this.h/1.7<0&&(this.y+=height+this.h/1.8+this.h/1.7),this.x="number"==typeof t?constrain(this.x,0,abs(t)):max(this.x,0)},FlyPlayer.prototype.collide=function(){for(var t in lasers){var i=lasers[t];if("player"!==i.belongsTo){dist(this.x,this.y,i.x,i.y)<i.radius+(this.w+this.h)/4&&(i.dead=!0,this.health--)}}},FlyPlayer.prototype.control=function(){(keys[" "]||keys[32])&&this.thrustCooldown>30?(this.speed+=.3,this.vx*=.8,this.vy*=.8,this.vx+=this.speed*sin(this.r),this.vy-=this.speed*cos(this.r)):(this.vx*=.99,this.vy*=.99),keys.z&&this.shootCooldown>15&&(lasers.push(new Laser(this.x,this.y,this.r,20)),this.shootCooldown=0),(keys[RIGHT_ARROW]||keys.d)&&(this.rvel+=.5),(keys[LEFT_ARROW]||keys.a)&&(this.rvel-=.5),keys.x&&(this.speed*=.8,this.vx*=.8,this.vy*=.8)},FlyPlayer.prototype.display=function(){push(),imageMode(CENTER),translate(this.x,this.y),rotate(this.r),keys[" "]||keys[32]?drawAnimation(this.onImg,0,0,this.w,this.h):drawAnimation(this.offImg,0,0,this.w,this.h),pop()};let flyPlayer=new FlyPlayer(100,100),stars=[];function displayStars(){for(var t=0;t<7e3;t+=imgs.stars.width*(height/imgs.stars.height))push(),translate(t,0),scale(height/imgs.stars.height),image(imgs.stars,0,0),pop()}function drawStars(){for(var t in push(),noStroke(),stars){var i=stars[t];fill(255,255,255,i.a),ellipse(i.x,i.y,i.d,i.d)}pop()}function FlySign(t,i){this.x=t,this.w=600,this.h=350,this.y=height/2-this.h/2,this.txt=i,this.padding=100,this.img=imgs.spacesign.clone()}FlySign.prototype.display=function(t){push(),drawAnimation(this.img,this.x+this.w/2,this.y+this.h/2,this.w,this.h),fill(0),noStroke(),textSize(35),textFont(fonts.pixel),text(this.txt,this.x+this.padding,this.y+this.padding,this.w-2*this.padding,this.h-2*this.padding),pop()};let flySigns=[];function Ufo(t,i,e){this.x=t,this.y=i,this.radius=e||100,this.img=imgs.ufo.clone(),this.w=2*this.radius,this.h=this.w*this.img.getHeight()/this.img.getWidth(),this.radius=(this.w+this.h)/4,this.speed=5,this.health=2,this.frame=0}Ufo.prototype.run=function(t){this.display(),this.dead||t&&(this.collide(t),dist(this.x,this.y,t.x,t.y)<1e3&&this.update(t)),this.health<1&&(this.dead=!0)},Ufo.prototype.update=function(t){this.x<t.x&&(this.x+=this.speed),this.x>t.x&&(this.x-=this.speed),this.y<t.y&&(this.y+=this.speed),this.y>t.y&&(this.y-=this.speed)},Ufo.prototype.collide=function(t){let i=dist(this.x,this.y,t.x,t.y),e=this.radius+(t.w+t.h)/4;for(var s in i<e&&(this.dead=!0,t.health--),lasers){let t=lasers[s];(i=dist(this.x,this.y,t.x,t.y))<(e=t.radius+this.radius)&&(t.dead=!0,this.health--)}},Ufo.prototype.display=function(){if(push(),translate(this.x,this.y),this.dead){let t=imgs.explosion[~~(this.frame/2)];this.frame++,imageMode(CENTER),image(t,0,0,2*this.radius,2*this.radius)}else drawAnimation(this.img,0,0,this.w,this.h);pop()};let ufos=[];function UfoBoss(t,i,e){this.x=t,this.y=i,this.img=imgs.ufoboss,this.r=e||300,this.w=2*this.r,this.h=this.w*this.img.height/this.img.width,this.r=(this.w+this.h)/4,this.health=100,this.radius=this.w/2,this.frame=0,this.shootWait=120}function ufoBossFight(){for(var t in background(0,0,0),push(),flyPlayer.x>3e3-width/2?translate(-3e3+width,0):flyPlayer.x>width/2&&translate(-flyPlayer.x+width/2,0),displayStars(),lasers)lasers[t].run(),lasers[t].dead&&lasers.splice(t,1);for(t=ufos.length-1;t>-1;t--)ufos[t].run(flyPlayer),ufos[t].dead&&ufos[t].frame>20&&ufos.splice(t,1);for(var t in bosses)bosses[t].run(flyPlayer),bosses[t].dead&&bosses[t].frame>20&&(bosses.splice(t,1),0===bosses.length&&game.continue());flyPlayer.run(3e3);for(t=asteroids.length-1;t>-1;t--)asteroids[t].run(flyPlayer),asteroids[t].dead&&asteroids[t].frame>20&&asteroids.splice(t,1);pop(),flyPlayer.displayHealth()}function flyToVenus(){for(var t in background(0,0,0),push(),flyPlayer.x>width/2&&(flyPlayer.x<4e3?translate(-flyPlayer.x+width/2,0):flyPlayer.x>4e3+width/2?game.continue():translate(width/2-4e3,0)),displayStars(),image(imgs.mars,-height/5,-height/12,height/3,height/3),image(imgs.venus,4e3+width/2-height/6,3*height/4,height/5,height/5),lasers)lasers[t].run(),lasers[t].dead&&lasers.splice(t,1);for(t=ufos.length-1;t>-1;t--)ufos[t].run(flyPlayer),ufos[t].dead&&ufos[t].frame>20&&ufos.splice(t,1);flyPlayer.run();for(t=asteroids.length-1;t>-1;t--)asteroids[t].run(flyPlayer),asteroids[t].dead&&asteroids[t].frame>20&&asteroids.splice(t,1);pop(),flyPlayer.displayHealth()}function buildPlatformer(){for(var t in background(200,225,250),push(),translate(0,buildPlatformer.itemBarHeight),scale(buildPlatformer.scaleFactor),buildPlatformer.player&&translate(buildPlatformer.player.getTransX(!0,buildPlatformer.w),0),buildPlatformer.displayGrid(),buildPlatformer.blocks)buildPlatformer.blocks[t].display();pop(),buildPlatformer.itemBar(),mouseY>buildPlatformer.itemBarHeight&&buildPlatformer.displayItem(),mouseIsPressed&&buildPlatformer.placing&&(buildPlatformer.placeItem(),buildPlatformer.reload())}function BuildMenuButton(t,i,e,s,h){switch(this.notBlock=!0,this.x=i||0,this.y=e||0,this.type=t,this.img={},t){case"pause":this.img=imgs.pausebtn;break;case"edit":this.img=imgs.editicon;break;case"player":case"@":this.img=imgs.player;break;case"left":this.img=imgs.leftarrow;break;case"right":this.img=imgs.rightarrow;break;default:this.img=imgs.x}"@"==t&&"number"==typeof s?(this.w=s,this.h=this.img.height/this.img.width*this.w,this.bw=h):(this.w=s||100,this.h=this.w)}function communityLevels(){if(background(225),communityLevels.home.check(),communityLevels.hasLoaded){push(),translate(0,100),scroller.update();let n=20;var t=n,i=n;let r=communityDisplays[0].w,a=communityDisplays[0].h;for(var e=floor(width/(r+n)),s=0,h=0,o=0;o<communityDisplays.length;o++)communityDisplays[o].draw(t,i),t+=n+r,++s>=e&&(t=n,s=0,o!=communityDisplays.length-1&&(i+=a+n)+a>height-150&&(h=i+a-height+150+n));scroller.maxY=-h,pop()}else{cLevels.length>0&&(communityLevels.hasLoaded=!0,communityLevels.init()),push(),textAlign(CENTER),fill(0),textFont(fonts.londrina),textSize(40);let t="",i=frameCount%100;text("Loading."+(t+=i>25?i>50?i>75?"...":"..":".":""),width/2,height/2),pop()}push(),noStroke(),fill(0,0,0,10),rect(0,95,width,10),fill(255),rect(0,0,width,100),textAlign(CENTER,BOTTOM),fill(0),textFont(fonts.arcade),textSize(50),stroke(200),strokeWeight(3),text("Community Levels",width/2,75),pop(),push(),fill(255),stroke(0),strokeWeight(5),textFont(fonts.bladerunner),textSize(25),communityLevels.home.display(color(0)),pop()}UfoBoss.prototype.run=function(t){this.display(),this.collide(t),this.update(t)},UfoBoss.prototype.update=function(t){this.health<1&&(this.dead=!0,this.img=imgs.explosion[round(this.frame/2)],this.frame++),frameCount%this.shootWait==0&&(lasers.push(new Laser(this.x,this.y,-atan2(this.x-t.x,this.y-t.y),4,"boss")),this.shootWait=round(random(80,140)))},UfoBoss.prototype.collide=function(t){let i=dist(this.x,this.y,t.x,t.y),e=this.r+(t.w+t.h)/4;if(i<e){t.x-=t.vx,t.y-=t.vy,t.thrustCooldown=0;var s=2*mag(t.vx,t.vy),h=t.x-this.x,o=t.y-this.y,n=s/mag(h,o);h*=n,o*=n,t.vx+=h,t.vy+=o,t.health--}for(var r in lasers){let t=lasers[r];"boss"!==t.belongsTo&&(i=dist(this.x,this.y,t.x,t.y))<(e=t.radius+this.radius)&&(t.dead=!0,this.health--)}},UfoBoss.prototype.display=function(){push(),translate(this.x,this.y),imageMode(CENTER),image(this.img,0,0,this.w,this.h),pop(),this.displayHealth()},UfoBoss.prototype.displayHealth=function(){push(),noStroke(),fill(204,14,14),rect(this.x-this.w/3,this.y-.8*this.h,2*this.w/3*this.health/100,.2*this.h),stroke(94,94,94),strokeWeight(10),noFill(),rect(this.x-this.w/3,this.y-.8*this.h,2*this.w/3,.2*this.h),pop()},ufoBossFight.level={boss:[[1500,window.innerHeight/2]]},ufoBossFight.init=function(){lasers=[],(flyPlayer=new FlyPlayer(50,height/2)).init(),loadLevel(this.level)},flyToVenus.init=function(){(flyPlayer=new FlyPlayer(50,height/2)).init(),this.level={asteroids:[[1200,height/2,height/2],[3e3,height/2,100],[3e3,height/2-200,100],[3e3,height-200,100]],ufos:[[1600,height/2],[2e3,100],[2400,height-100],[2800,height/2],[3500,height/2],[3500,height]]},loadLevel(this.level)},buildPlatformer.init=function(){for(var t in this.bw=100,this.bh=100,this.itemsKey=["_","a","#","r","-","'","^","v","~","x","o","0","f","%","player","pause","edit","left","right"],this.items=Array(this.itemsKey.length),this.itemPadding=width/100,this.iw=width/this.items.length-2*this.itemPadding,this.itemsKey){var i=bGame.getConst(this.itemsKey[t]);this.items[t]=i?new i(0,0):new BuildMenuButton(this.itemsKey[t]),this.items[t].w=this.iw,this.items[t].h=this.iw,this.items[t].keyValue=this.itemsKey[t]}this.itemSpace=100*this.items.length,this.itemBarHeight=width/this.items.length,this.load(),this.player=new BPlayer(0,0)},buildPlatformer.load=function(){var t=currentBuildingLevel.level;this.scaleFactor=(height-this.itemBarHeight)/(t.length*this.bh),this.h=t.length*this.bh,this.w=t[0].length*this.bw,this.sw=1/this.scaleFactor*width,this.sh=1/this.scaleFactor*height,this.reload()},buildPlatformer.reload=function(){this.blocks=[];for(var t=currentBuildingLevel.level,i=0;i<t.length;i++)for(var e=0;e<t[i].length;e++){let s=t[i][e],h=e*this.bw,o=i*this.bh;bGame.getConst(s)&&this.blocks.push(new(bGame.getConst(s))(h,o,this.bw,this.bh)),"@"==s&&this.blocks.push(new BuildMenuButton("@",h,o,.75*this.bw,this.bw))}},buildPlatformer.placeItem=function(){var t=currentBuildingLevel.level,i=(mouseY-this.itemBarHeight)/this.scaleFactor,e=mouseX/this.scaleFactor-this.player.transX;if(!(mouseY<this.itemBarHeight)){var s=floor(e/this.bw),h=floor(i/this.bh);if("@"==this.placingItem)for(var o=0;o<t.length;o++)for(var n=0;n<t[o].length;n++)"@"==t[o][n]&&(currentBuildingLevel.level[o]=currentBuildingLevel.level[o].replaceAt(n,"_"));currentBuildingLevel.level[h]=currentBuildingLevel.level[h].replaceAt(s,this.placingItem),currentBuildingLevel.verified=!1}},buildPlatformer.itemBar=function(){push(),fill(41,41,41,100),noStroke(),rect(0,0,width,this.itemBarHeight);var t=0;for(var i in this.items){var e=this.items[i];t=map(i,0,this.items.length,0,width);if(e.x=t+this.itemPadding,e.y=this.itemPadding,e.display(!0),mouseX>e.x&&mouseX<e.x+e.w&&mouseY>e.y&&mouseY<e.y+e.h)if(cursor(HAND),clicked){if(e.notBlock)switch(e.type){case"pause":levelBuilder.pause();break;case"edit":levelBuilder.editStats();break;case"player":this.placing=!0,this.placingItem="@"}else this.placing=!0,this.placingItem=this.itemsKey[i];clicked=!1}else mouseIsPressed&&e.notBlock&&("left"==e.type?this.player.x-=10:"right"==e.type&&(this.player.x+=10))}pop(),keys[LEFT_ARROW]||keys.a?this.player.x-=10:(keys[RIGHT_ARROW]||keys.d)&&(this.player.x+=10),this.player.x=constrain(this.player.x,0,this.w-this.sw)},buildPlatformer.displayGrid=function(){var t=currentBuildingLevel.level;for(var i in t)for(var e in t[i]){var s=e*this.bw,h=i*this.bh;push(),stroke(255,64),strokeWeight(2),noFill(),rectMode(LEFT),rect(s,h,this.bw,this.bh),pop()}},buildPlatformer.displayItem=function(){if(this.placing){var t=this.items.find(function(t){return t.keyValue==buildPlatformer.placingItem||"player"==t.keyValue&&"@"==buildPlatformer.placingItem});if(!t)return console.warn("No item to display");var i={x:t.x,y:t.y,w:t.w,h:t.h},e=1.2*this.bh/t.h;for(var s in t.w*=e,t.h*=e,t.x=mouseX-t.w/2,t.y=mouseY-t.h/2,t.display(!0),i)t[s]=i[s]}},String.prototype.replaceAt=function(t,i){var e=this.split("");return e[t]=i,e.join("")},BuildMenuButton.prototype.display=function(){push();var t=this.x+(this.w||this.bw)/2;translate(t,0),"@"!=this.type&&"player"!=this.type||scale(-1,1),translate(-t,0),imageMode(CORNER);let i=this.img;if("@"==this.type)image(i,this.x,this.y+this.bw-this.h,this.w,this.h);else if("player"==this.type){var e=this.w*i.width/i.height;image(i,this.x+this.w/2-e/2,this.y,e,this.h)}else image(i,this.x,this.y,this.w,this.h);pop()},communityLevels.hasLoaded=!1,communityLevels.init=function(){if(communityLevels.home=new Button("Home",10,height-60,100,50,function(){game.setScene("home")}),!(cLevels.length<=0||communityDisplays.length>0)){var t=cLevels.filter(function(t){return t.featured}),i=cLevels.filter(function(t){return!t.featured});cLevels=t.concat(i),communityLevels.hasLoaded=!0;for(var e=0;e<cLevels.length;e++)communityDisplays.push(new LevelDisplay(cLevels[e],200,250));scroller.reset()}};let scroller={x:0,y:0,ax:0,ay:0,update:function(){mouseY<200&&mouseY>100?this.y=min(this.y+map(mouseY,100,200,15,5),0):mouseY>height-100&&(this.y=max(this.y-map(mouseY,height,height-100,15,5),this.maxY||0)),(keys[DOWN_ARROW]||keys.s)&&(this.y=max(this.y-10,this.maxY||0)),(keys[UP_ARROW]||keys.w)&&(this.y=min(this.y+10,0)),this.ax=this.x,this.ay=this.y+100,translate(this.x,this.y)},reset:function(){this.x=0,this.y=0,this.ax=0,this.ay=0}},cLevels=[];function getCommunityLevels(){var t="https://escape-from-earth.herokuapp.com/levels";$.getJSON(t,function(t){cLevels=t}).catch(function(){t="/scripts/levelbuilder/stashedcommunitylevels.json",$.getJSON(t,function(t){console.log("Failed to load external resource, stuck with local"),communityLevels.level=t}).catch(function(){console.log("Failed to load any community levels")})})}function postLevel(t){t.waitingForUpdate=!0,$.post("https://escape-from-earth.herokuapp.com/levels/new",t,function(t){getCommunityLevels();for(var i=0;i<levelsBuilt.length;i++){var e;if((e=levelsBuilt[i]).waitingForUpdate)if(e.title==t.title&&e.creator==t.creator||e._id==t._id)levelsBuilt[i]=t,(e=levelsBuilt[i]).waitingForUpdate=!1,e.uploaded=!0,levelBuilder.save()}}).catch(function(t,i,e){console.log("Error posting new level"),console.log(i),console.log(e)})}function LevelBuilderLevel(t,i,e,s){switch(this.title=t||"New Level",this.creator=i||"Anonymous",this.type=e||"",this.difficulty=s||1,this.verified=!1,this.uploaded=!1,this.waitingForUpdate=!1,this.levelBuilderLevel=!0,this.type){case"run":this.map="_______________%";break;case"build":this.level=["________________________","________________________","________________________","________________________","________________________","________________________","________________________"];break;case"space":this.objects={width:200,asteroids:[],ufos:[],boss:[]};break;case"mars":this.objects={blocks:[]}}}function LevelDisplay(t,i,e,s){this.level=t,this.x=0,this.y=0,this.w=i,this.h=e,this.editable=s}getCommunityLevels(),setInterval(getCommunityLevels,1e4),LevelBuilderLevel.updateLevel=function(t,i,e,s,h){if(t.title=i||t.title,t.creator=e||t.creator,s)switch(t.type){case"run":for(var o=t.map.split("");o.length>s;)o.pop(),o[o.length-1]="%";for(;o.length<s;)o.push("%"),o[o.length-2]="_";t.map=o.join("");break;case"build":if(h){for(;t.level.length>h;)t.level.pop();for(;t.level.length<h;){var n=new Array(t.level[0].length);n.fill("_"),t.level.push(n.join(""))}}if(s){for(;t.level[0].length>s;)for(var r=0;r<t.level.length;r++)t.level[r]=t.level[r].replaceAt(t.level[r].length-1,"");for(;t.level[0].length<s;)for(r=0;r<t.level.length;r++)t.level[r]+="_"}break;case"space":t.objects.width=s}},LevelDisplay.prototype.go=function(){playLevel.setup(this.level,game.currentScene),console.log(this.level),game.setScene("playlevel")},LevelDisplay.prototype.check=function(){this.editable?mouseX>this.x+10&&mouseX<this.x+this.w-10&&(mouseY>max(this.y+this.w+50+scroller.ay,100)&&mouseY<this.y+this.w+90+scroller.ay?(cursor(HAND),clicked&&(mouseX<this.x+this.w/2?this.go():levelBuilder.openLevel(this.level.index)),pressed=!1,clicked=!1):this.level.verified&&mouseY>max(this.y+this.w+100+scroller.ay,100)&&mouseY<this.y+this.w+140+scroller.ay&&mouseX>this.x+this.w/2+5&&(cursor(HAND),clicked&&postLevel(this.level),pressed=!1,clicked=!1)):mouseX>this.x&&mouseX<this.x+this.w&&mouseY>max(100,this.y+scroller.ay)&&mouseY<this.y+scroller.ay+this.h&&(cursor(HAND),pressed?(this.go(),pressed=!1):clicked&&(clicked=!1))},LevelDisplay.prototype.display=function(){var t;switch(push(),this.level.type){case"run":t=imgs.runthumb;break;case"build":t=imgs.buildthumb;break;case"space":t=imgs.spacethumb;break;case"mars":t=imgs.marsthumb;break;default:t=imgs.x}image(t,this.x,this.y,this.w,this.w),fill(this.level.featured?color(200,150,0):0),textAlign(LEFT,TOP),textFont(fonts.londrina),textSize(15);var i=textAscent()+textDescent();text(this.level.title,this.x+5,this.y+this.w+5,this.w-10,i),text(this.level.creator,this.x+5,this.y+this.w+5+i,this.w-10,i),this.editable&&(push(),fill(245),strokeWeight(5),stroke(10),rect(this.x+10,this.y+this.w+50,this.w/2-15,40,5),rect(this.x+this.w/2+5,this.y+this.w+50,this.w/2-15,40,5),this.level.verified&&rect(this.x+this.w/2+5,this.y+this.w+100,this.w/2-15,40,5),fill(10),noStroke(),textFont(fonts.londrina),textSize(12),textAlign(CENTER,CENTER),text("Play",this.x+5+this.w/4,this.y+this.w+70),text("Edit",this.x-5+3*this.w/4,this.y+this.w+70),this.level.verified&&text("Upload",this.x-5+3*this.w/4,this.y+this.w+120),fill(this.level.verified?color(0,200,0):color(200,0,0)),textAlign(LEFT,CENTER),textSize(20),text(this.level.verified?"Verified":"Unverified",this.x+10,this.y+this.w+120),pop()),strokeWeight(5),noFill(),stroke(0),rect(this.x,this.y,this.w,this.h,8),pop()},LevelDisplay.prototype.draw=function(t,i){this.x=t,this.y=i,this.check(),this.display()};var communityDisplays=[],levelBuildDisplays=[],levelsBuilt=JSON.parse(localStorage.myLevels||"[]"),currentBuildingLevel=null;function levelBuilder(){return levelBuilder.isPaused?levelBuilder.paused():levelBuilder.isEditingStats?levelBuilder.editingStats():void levelBuilder.getFunc()()}function buildArena(){buildArena.run()}function levelBuilderMenu(){if(background(225),levelBuilderMenu.home.check(),levelsBuilt.length<=0)push(),textAlign(CENTER,BOTTOM),fill(0),textFont(fonts.londrina),textSize(40),text("You don't have any levels",width/2,height/2-60),pop(),push(),fill(255),stroke(0),strokeWeight(5),textFont(fonts.londrina),textSize(25),levelBuilderMenu.newLevel.draw(color(0)),pop();else if(levelBuildDisplays.length>0){push(),translate(0,100),scroller.update();let r=20;var t=r,i=r;let a=levelBuildDisplays[0].w,l=levelBuildDisplays[0].h;for(var e=floor(width/(a+r)),s=0,h=0,o=-1;o<levelBuildDisplays.length;o++){if(-1==o){push(),fill(240),strokeWeight(5),stroke(10),rect(t,i,a,l,r),push(),strokeWeight(10);var n=min(a,l/2)/4;line(t+a/2-n,i+l/4,t+a/2+n,i+l/4),line(t+a/2,i+l/4-n,t+a/2,i+l/4+n),pop(),textFont(fonts.londrina),textSize(25),noStroke(),fill(10),textAlign(CENTER,CENTER),text("New Level",t,i+l/4+n,a,3*l/4-n),mouseX>t&&mouseX<t+a&&mouseY>max(100,scroller.ay+i)&&mouseY<max(i+l+scroller.ay)&&(cursor(HAND),clicked&&(clicked=!1,levelBuilderMenu.newLevel.func())),pop()}else levelBuildDisplays[o].draw(t,i);t+=r+a,++s>=e&&(t=r,s=0,o!=communityDisplays.length-1&&(i+=l+r)+l>height-150&&(h=i+l-height+150+r))}scroller.maxY=-h,pop()}else levelBuilderMenu.createDisplays();push(),noStroke(),fill(0,0,0,10),rect(0,95,width,10),fill(255),rect(0,0,width,100),textAlign(CENTER,BOTTOM),fill(0),textFont(fonts.arcade),textSize(50),stroke(200),strokeWeight(3),text("Level Builder",width/2,75),pop(),push(),fill(255),stroke(0),strokeWeight(5),textFont(fonts.bladerunner),textSize(25),levelBuilderMenu.home.display(color(0)),pop()}function createNewLevel(){background(255),localStorage.author=inputs.creator.value(),createNewLevel.waitForRelease&&clicked&&(clicked=!1,createLevel())}function createLevel(){levelBuilder.addLevel(new LevelBuilderLevel(inputs.name.value(),inputs.creator.value(),inputs.type.value())),levelBuilder.openLevel(0),levelBuilder.setType(inputs.type.value()),inputs.destroyAll(),clicked=!1}levelBuilder.getFunc=function(){switch(levelBuilder.building){case"run":return buildRunMap;case"build":return buildPlatformer;case"space":return buildSpaceLevel;case"mars":return buildArena;case"new":return createNewLevel;case"none":return levelBuilderMenu;default:return levelBuilder.building="none",levelBuilderMenu}},levelBuilder.setType=function(t){levelBuilder.building=t,"function"==typeof this.getFunc().init&&this.getFunc().init(),this.save()},levelBuilder.addLevel=function(t){levelsBuilt.unshift(t),this.save(),console.log("added a level")},levelBuilder.removeLevel=function(t){levelsBuilt.splice(t,1),this.save()},levelBuilder.openLevel=function(t){currentBuildingLevel=levelsBuilt[t],this.setType(currentBuildingLevel.type),currentBuildingLevel.levelBuilderLevel=!0},levelBuilder.save=function(){for(var t=0;t<levelsBuilt.length;t++)levelsBuilt[t].index=t;localStorage.myLevels=JSON.stringify(levelsBuilt||"[]")},levelBuilder.pause=function(){this.isPaused=!0,this.isEditingStats=!1,push(),resetMatrix(),noStroke(),fill(0,0,0,200),rect(0,0,width,height),pop(),isMobile||(this.pausedImg=get())},levelBuilder.paused=function(){push(),resetMatrix(),isMobile?background(80,80,80):image(this.pausedImg,0,0,width,height),fill(255),textFont(fonts.londrina),textSize(80),textAlign(CENTER,TOP),text(currentBuildingLevel.name,width/2,10),fill(245),stroke(10),strokeWeight(3),rect(width/4,100,width/2,80,20),rect(width/4,200,width/4-10,80,20),rect(width/2+10,200,width/4-10,80,20),rect(width/4,300,width/4-10,60,20),rect(width/2+10,300,width/4-10,60,20),noStroke(),fill(10),textFont(fonts.londrina),textSize(50),textAlign(CENTER,CENTER),text("Resume",width/2,140),textSize(30),text("Save",width/4,240,width/4),text("Save & Quit",width/2+10,240,width/4-10),textSize(25),text("Delete Level",width/4,330,width/4),text("Play",width/2+10,330,width/4-10),pop(),mouseX>width/4&&mouseX<3*width/4&&(mouseY>100&&mouseY<180&&(cursor(HAND),clicked&&(this.isPaused=!1)),mouseX<width/2-10?mouseY>200&&mouseY<280?(cursor(HAND),clicked&&this.save()):mouseY>300&&mouseY<360&&(cursor(HAND),clicked&&(this.removeLevel(currentBuildingLevel.index),this.setType("none"),this.isPaused=!1)):mouseX>width/2+10&&(mouseY>200&&mouseY<280?(cursor(HAND),clicked&&(this.save(),this.setType("none"),this.isPaused=!1)):mouseY>300&&mouseY<360&&(cursor(HAND),clicked&&(playLevel.setup(currentBuildingLevel,game.currentScene),game.setScene("playlevel"),this.isPaused=!1)))),clicked=!1},levelBuilder.editStats=function(){this.isEditingStats=!0,this.isPaused=!1,this.ei={};var t,i,e,s,h,o,n=this.ei;switch(n.title=createInput(currentBuildingLevel.title,"text"),n.title.attribute("placeholder","Title"),n.title.position(width/4,50),n.title.style("width",width/2+"px"),n.title.addClass("big-text"),n.creator=createInput(currentBuildingLevel.creator,"text"),n.creator.attribute("placeholder","Creator"),n.creator.position(width/4,150),n.creator.style("width",width/2+"px"),n.creator.addClass("big-text"),currentBuildingLevel.type){case"run":t=!0,i=10,e=currentBuildingLevel.map.length;break;case"build":t=!0,i=15,e=currentBuildingLevel.level[0].length,s=!0,h=6,o=currentBuildingLevel.level.length;break;case"space":t=!0,i=200,e=currentBuildingLevel.objects.width}var r=250;t&&(n.width=createInput(e,"number"),n.width.attribute("placeholder","Width"),n.width.position(width/4,250),n.width.style("width",width/2+"px"),n.minWidth=i,r+=80),s&&(n.height=createInput(o,"number"),n.height.attribute("placeholder","Height"),n.height.position(width/4,330),n.height.style("width",width/2+"px"),n.minHeight=h,r+=80),n.submit=createButton("Save"),n.submit.position(width/4,r),n.submit.style("width",width/4-10+"px"),n.submit.mouseReleased(function(){n.waitFor.submit=!0}),n.cancel=createButton("Cancel"),n.cancel.position(width/2+10,r),n.cancel.style("width",width/4-10+"px"),n.cancel.mouseReleased(function(){n.waitFor.cancel=!0}),n.waitFor={},n.destroyInputs=function(){for(var t in n)"object"==typeof n[t]&&"function"==typeof n[t].remove&&n[t].remove()}},levelBuilder.editingStats=function(){background(245);var t=this.ei;t.width&&(t.width.value()<t.minWidth?t.width.style("color","#ff0000"):t.width.style("color","#000000")),t.height&&(t.height.value()<t.minHeight?t.height.style("color","#ff0000"):t.height.style("color","#000000")),clicked&&(t.waitFor.submit?(t.width&&t.width.value(max(t.minWidth,t.width.value())),t.height&&t.height.value(max(t.minHeight,t.height.value())),LevelBuilderLevel.updateLevel(currentBuildingLevel,t.title.value(),t.creator.value(),t.width?t.width.value():null,t.height?t.height.value():null),this.isEditingStats=!1,t.destroyInputs(),this.save(),"function"==typeof this.getFunc().init&&this.getFunc().init()):t.waitFor.cancel&&(this.isEditingStats=!1,t.destroyInputs()))},levelBuilder.init=function(){this.isPaused=!1,this.isEditingStats=!1,this.setType(levelBuilder.building||"none"),levelBuilderMenu.init()},levelBuilder.createNew=function(){levelBuilder.building="new"},buildArena.init=function(){this.dock={w:100,h:100,p:10,items:["pause","edit","switch"]},this.dock.w*=this.dock.items.length,this.background={img:imgs.marsbackground,x:0,y:0},this.background.aspect=this.background.img.width/this.background.img.height;let t=width/height;this.background.aspect>t?(this.background.h=height,this.background.w=this.background.h*this.background.aspect):(this.background.w=width,this.background.h=this.background.w*(1/this.background.aspect)),this.ground={img:imgs.marsarena,x:width/2,y:3*height/4,w:7*width/8},buildArena.updateBlocks(),this.bw=mGame.bw;var i=new MRock(0,0,this.bw);this.bh=i.h,this.bm=this.ground.w/mGame.ground.w,this.sm=1/this.bm,this.mode="rock",this.constraints={x:{min:-100,max:100},y:{min:0,max:15}}},buildArena.updateBlocks=function(){mGame.init(currentBuildingLevel.objects.blocks),this.rocks=mGame.rocks},buildArena.run=function(){this.display(),this.displayObjects(),this.runDock(),clicked&&this.placeObject()},buildArena.placeObject=function(){if(currentBuildingLevel.verified=!1,"rock"==this.mode){var t=constrain(map(mouseX,this.ground.x-this.ground.w/2+this.bw*this.bm/2,this.ground.x+this.ground.w/2-this.bw*this.bm/2,-100,100),this.constraints.x.min,this.constraints.x.max),i=constrain(map(mouseY+this.bh*this.bm/2,this.ground.y,this.ground.y-this.bh*this.bm,0,1),this.constraints.y.min,this.constraints.y.max);currentBuildingLevel.objects.blocks.push({x:t,y:i})}else for(var e=this.rocks.length-1;e>-1;e--){var s=this.rocks[e].x,h=this.rocks[e].y,o=s+this.rocks[e].w,n=h+this.rocks[e].h;s*=this.bm,h*=this.bm,o*=this.bm,n*=this.bm,s+=this.ground.x,h+=this.ground.y,o+=this.ground.x,n+=this.ground.y,mouseX>s&&mouseX<o&&mouseY>h&&mouseY<n&&currentBuildingLevel.objects.blocks.splice(e,1)}this.updateBlocks()},buildArena.display=function(){image(this.background.img,0,0,this.background.w,this.background.h),image(this.ground.img,this.ground.x-this.ground.w/2,this.ground.y,this.ground.w,this.ground.w*this.ground.img.height/this.ground.img.width);var t=map(this.constraints.y.max+1,0,1,this.ground.y,this.ground.y-this.bh*this.bm);push(),fill(0,100),noStroke(),beginShape(),vertex(0,0),vertex(width,0),vertex(width,height),vertex(0,height),vertex(0,0),vertex(this.ground.x-this.ground.w/2,t),vertex(this.ground.x-this.ground.w/2,this.ground.y),vertex(this.ground.x+this.ground.w/2,this.ground.y),vertex(this.ground.x+this.ground.w/2,t),vertex(this.ground.x-this.ground.w/2,t),endShape(),pop()},buildArena.displayObjects=function(){push(),translate(this.ground.x,this.ground.y),scale(this.bm);for(var t=0;t<this.rocks.length;t++)this.rocks[t].display();pop()},buildArena.runDock=function(){push(),noStroke(),fill(200,150),rect(0,0,this.dock.w,this.dock.h,this.dock.p);for(var t=this.dock.p,i=this.dock.p,e=this.dock.w/this.dock.items.length-2*this.dock.p,s=this.dock.h-2*this.dock.p,h=0;h<this.dock.items.length;h++){var o=this.dock.items[h],n={pause:"pausebtn",edit:"editicon",switch:"rock"==this.mode?"marsrock":"x"};if("object"==typeof imgs[n[o]]&&image(imgs[n[o]],t,i,e,s),mouseX>t&&mouseX<t+e&&mouseY>i&&mouseY<i+s&&(cursor(HAND),clicked))if("switch"==o)this.mode="rock"==this.mode?"x":"rock";else{var r={pause:"pause",edit:"editStats"};"function"==typeof levelBuilder[r[o]]&&levelBuilder[r[o]]()}t+=this.dock.w/this.dock.items.length}mouseX<this.dock.w&&mouseY<this.dock.h&&(pressed=!1,clicked=!1),pop()},levelBuilderMenu.init=function(){this.home=new Button("Home",10,height-60,100,50,function(){game.setScene("home")}),this.newLevel=new Button("New Level",width/2-100,height/2-30,200,60,function(){levelBuilder.building="new",createNewLevel.init()}),this.createDisplays(),scroller.reset()},levelBuilderMenu.createDisplays=function(){levelBuildDisplays=[];for(var t=0;t<levelsBuilt.length;t++)levelBuildDisplays.push(new LevelDisplay(levelsBuilt[t],200,350,!0))},createNewLevel.init=function(){this.waitForRelease=!1,inputs.name=createInput("New Level","text"),inputs.name.position(width/4,50),inputs.name.addClass("big-text"),inputs.name.attribute("placeholder","Level Name"),inputs.name.style("width",width/2+"px"),inputs.creator=createInput(localStorage.author||"Anonymous","text"),inputs.creator.position(width/4,150),inputs.creator.addClass("big-text"),inputs.creator.attribute("placeholder","Creator"),inputs.creator.style("width",width/2+"px"),inputs.type=createSelect("run"),inputs.type.position(width/4,250),inputs.type.style("width",width/2+"px"),inputs.type.option("Run","run"),inputs.type.option("Platformer","build"),inputs.type.option("Space","space"),inputs.type.option("Mars","mars"),inputs.submit=createButton("Create!"),inputs.submit.position(width/4,320),inputs.submit.style("width",width/2+50+"px"),inputs.submit.mouseReleased(function(){createNewLevel.waitForRelease=!0})};var inputs={};function playLevel(){switch(playLevel.level.type){case"run":runToRocket();break;case"build":buildRocket();break;case"space":FlyFreeplay();break;case"mars":fightMartians();break;default:game.setScene("home")}}function buildRunMap(){if(background(200,225,250),"object"!=typeof currentBuildingLevel)return levelBuilder.setType("none");"number"!=typeof buildRunObjs.length&&buildRunMap.update(),push(),translate(runPlayer.transX,0),runGround.display();for(var t=0;t<buildRunObjs.length;t++){buildRunObjs[t].display()}push(),stroke(0),strokeWeight(2);for(t=0;t<currentBuildingLevel.map.length+1;t++)line(t*runObstacleWidth,0,t*runObstacleWidth,height);if(pop(),currentBuildingLevel.map.length>=10){push(),fill(240),strokeWeight(5),stroke(10);var i=(currentBuildingLevel.map.length-1)*runObstacleWidth,e=runObstacleWidth;rect(i+5,10,e-10,e-10),strokeWeight(7),line(i+15,10+(e-10)/2,i+e-15,10+(e-10)/2),mouseX-=runPlayer.transX,mouseX>i+5&&mouseX<i+e-10&&mouseY>10&&mouseY<10+e-10&&(cursor(HAND),clicked&&(clicked=!1,buildRunMap.menu.popMap())),mouseX+=runPlayer.transX,pop()}pop(),runPlayer.updateTranslate(!0,currentBuildingLevel.map),buildRunMap.menu.runItems(),clicked&&buildRunMap.menu.handleClick()}inputs.destroyAll=function(){for(var t in inputs)"function"!=typeof inputs[t]&&inputs[t].remove()},playLevel.init=function(){let t=playLevel.level;switch(t.type){case"run":loadRun.init();break;case"build":bGame.init();break;case"space":FlyFreeplay.init();break;case"mars":fightMartians.init(t.objects.blocks),mGame.freeplayLevel=t;break;default:game.setScene("home")}},playLevel.level={},playLevel.gobackto="communitylevels",playLevel.setup=function(t,i){playLevel.level=t;let e=playLevel.level;switch(e.type){case"run":loadRun.current=e,loadRun.gobackto=i;break;case"build":bGame.rawLevelObject=e,bGame.map=e.level,bGame.gobackto=i;break;case"space":FlyFreeplay.set(e,i);break;case"mars":mGame.gobackto=i;break;default:game.setScene("communitylevels")}};var buildRunObjs=null;function buildSpaceLevel(){buildSpaceLevel.run()}buildRunMap.init=function(){this.carrying="x",runPlayer.reset(),runPlayer.x=0,runGround.init(),this.menu.init()},buildRunMap.menu={carrying:"_",items:{},paused:!1,pause:function(){resetMatrix(),push(),fill(0,0,0,150),noStroke(),rect(0,0,width,height),pop(),this.pausedImg=get(),this.paused=!0},update:function(){buildRunObjs=[];for(var t=currentBuildingLevel.map,i=0;i<t.length;i++)switch(t[i]){case"x":buildRunObjs.push(new RunTrash(i*runObstacleWidth));break;case"c":buildRunObjs.push(new RunCar(i*runObstacleWidth));break;case"^":buildRunObjs.push(new RunSpike(i*runObstacleWidth));break;case"l":buildRunObjs.push(new RunStreetLight(i*runObstacleWidth))}},getDockDimensions:function(){var t=this.items.length*this.iconSize+this.items.length*this.padding,i=2*this.padding+this.iconSize;return{x:width/2-t/2,y:this.padding,w:t,h:i}},runItems:function(){var t,i;push(),fill(255,200),noStroke();var e=this.getDockDimensions();rect(e.x,e.y,e.w,e.h,this.padding);var s=0;for(var h in this.items)if("length"!=h){var o=map(s,0,this.items.length,e.x+this.padding,e.x+e.w-this.padding);image(this.items[h].img,o+(this.iconSize-this.items[h].w)/2,e.y+this.padding+(this.iconSize-this.items[h].h)/2,this.items[h].w,this.items[h].h),mouseX>o&&mouseX<o+this.iconSize&&mouseY>e.y+this.padding&&mouseY<e.y+e.h-this.padding&&(cursor(HAND),clicked&&("pause"==h?t=!0:"edit"==h?i=!0:this.carrying=h,clicked=!1)),s++}pop();var n={cy:height/2,w:175,h:175};push(),rectMode(CENTER),fill(255,200),noStroke(),rect(0,n.cy,2*n.w,n.h,20),rect(width,n.cy,2*n.w,n.h,20),pop();var r=5;if((keys[RIGHT_ARROW]||keys.d)&&(runPlayer.x+=r),(keys[LEFT_ARROW]||keys.a)&&(runPlayer.x-=r),mouseIsPressed&&(r*=3),mouseY>n.cy-n.h/2&&mouseY<n.cy+n.h/2&&(mouseX<n.w?(clicked&&(clicked=!1),runPlayer.x-=r):mouseX>width-n.w&&(runPlayer.x+=r,clicked&&(clicked=!1))),t)return levelBuilder.pause();if(i)return levelBuilder.editStats();if(mouseX>e.x&&mouseX<e.x+e.w&&mouseY>e.y&&mouseY<e.y+e.h)clicked=!1;else{cursor("none");var a=this.items[this.carrying];image(a.img,mouseX-a.w/2,mouseY-a.h/2,a.w,a.h)}},popMap:function(){var t=currentBuildingLevel.map.split("");t.pop(),"="==t[t.length-1]&&(t[t.length-2]="_"),t[t.length-1]="%",currentBuildingLevel.map=t.join(""),this.update()},handleClick:function(){this.placeBlock(),this.verified=!1},placeBlock:function(){var t=floor((mouseX-runPlayer.transX)/runObstacleWidth),i=currentBuildingLevel.map.split("");"="==i[t]?i[t-1]="_":"c"==i[t]&&(i[t+1]="_"),i[t]=this.carrying,"c"==this.carrying&&(i[t+1]="="),currentBuildingLevel.map=i.join(""),"%"!=currentBuildingLevel.map[currentBuildingLevel.map.length-1]&&(currentBuildingLevel.map+="%"),this.update()},init:function(){this.padding=20,this.iconSize=80,this.update();var t={x:"trash","^":"spike",l:"streetlight",c:"brokenCar",_:"x",pause:"pausebtn",edit:"editicon"};for(var i in this.items={},this.items.length=0,t)this.items[i]={img:imgs[t[i]]},this.items[i].img.width>this.items[i].img.height?(this.items[i].w=this.iconSize,this.items[i].h=this.iconSize*this.items[i].img.height/this.items[i].img.width):(this.items[i].h=this.iconSize,this.items[i].w=this.iconSize*this.items[i].img.width/this.items[i].img.height),this.items.length++}},buildSpaceLevel.init=function(){this.objects=currentBuildingLevel.objects,this.dock={w:150,h:height,p:10,items:["asteroids","ufos","boss","x","pause","edit","left","right","+","-"]},this.nm=height/100,this.loadObjects(),this.carrying="asteroids",this.carryingsize=25,this.tx=0},buildSpaceLevel.loadObjects=function(){(flyPlayer=new FlyPlayer(50,height/2)).init(),this.w=this.objects.width*this.nm,loadDynamicLevel(this.objects)},buildSpaceLevel.runDock=function(){push(),fill(50,200),rect(0,0,this.dock.w,this.dock.h);var t=this.dock.p,i=height/this.dock.items.length-2*this.dock.p,e=this.dock.w-2*this.dock.p,s=e/i;noStroke();for(var h=0;h<this.dock.items.length;h++){var o=null;switch(this.dock.items[h]){case"asteroids":o=imgs.asteroid;break;case"ufos":o=imgs.ufo.images[0];break;case"boss":o=imgs.ufoboss;break;case"x":o=imgs.x;break;case"pause":o=imgs.pausebtn;break;case"edit":o=imgs.editicon;break;case"left":o=imgs.leftarrow;break;case"right":o=imgs.rightarrow;break;case"+":o=imgs.plussign;break;case"-":o=imgs.minussign}if(o){var n=o.width,r=o.height;o.width/o.height<s?(n*=i/r,r=i,image(o,this.dock.p+e/2-n/2,t,n,r)):(r*=e/n,n=e,image(o,this.dock.p+e/2-n/2,t,n,r))}if(mouseX>this.dock.p&&mouseX<this.dock.p+e&&mouseY>t&&mouseY<t+i)if(cursor(HAND),clicked){clicked=!1;var a=this.dock.items[h];if("asteroids"==a||"ufos"==a||"boss"==a||"x"==a)this.carrying=a;else switch(a){case"pause":levelBuilder.pause();break;case"edit":levelBuilder.editStats()}}else if(mouseIsPressed){switch(this.dock.items[h]){case"left":this.tx-=30;break;case"right":this.tx+=30;break;case"+":this.carryingsize++;break;case"-":this.carryingsize--}this.carryingsize=constrain(this.carryingsize,5,80)}t+=i+2*this.dock.p}pop(),(keys[LEFT_ARROW]||keys.a)&&(this.tx-=30),(keys[RIGHT_ARROW]||keys.d)&&(this.tx+=30),clicked&&mouseX<this.dock.w&&(clicked=!1)},buildSpaceLevel.displayObjects=function(){push(),background(0,0,0),this.transX=0;var t=this.w;flyPlayer.x>0&&flyPlayer.x<t?this.transX=-flyPlayer.x:flyPlayer.x>t&&(this.transX=-t),translate(this.transX,0),displayStars();for(var i=0;i<asteroids.length;i++)asteroids[i].display();for(i=0;i<ufos.length;i++)ufos[i].display();for(i=0;i<bosses.length;i++)bosses[i].display();pop()},buildSpaceLevel.display=function(){push(),translate(this.dock.w,0),this.displayObjects(),pop(),this.displayHoldingObject()},buildSpaceLevel.displayHoldingObject=function(){var t=this.carryingsize*this.nm,i=null;switch(this.carrying){case"asteroids":i=imgs.asteroid;break;case"ufos":i=imgs.ufo.images[0];break;case"boss":i=imgs.ufoboss;break;case"x":i=imgs.x}mouseX>this.dock.w&&(clicked&&this.placeObject(),i&&(push(),imageMode(CENTER),image(i,mouseX,mouseY,t,t*i.height/i.width),pop())),i&&!isMobile&&(push(),tint(255,255,255,100),image(i,width-t,0,t,t*i.height/i.width),pop())},buildSpaceLevel.run=function(){this.display(),this.runDock(),this.tx=constrain(this.tx,0,this.w-width+this.dock.w),flyPlayer.x=this.tx},buildSpaceLevel.placeObject=function(){var t=mouseX-this.dock.w-this.transX,i=mouseY;if(this.objects[this.carrying]&&this.objects[this.carrying]instanceof Array){var e=t/height*100,s=i/height*100;this.objects[this.carrying].push([e,s,this.carryingsize])}else if("x"==this.carrying)for(var h in this.objects)if("object"==typeof this.objects[h]&&this.objects[h]instanceof Array)for(var o=this.objects[h].length-1;o>-1;o--){var n=this.objects[h][o],r=n[0]*this.nm,a=n[1]*this.nm,l=n[2]*this.nm||100;dist(t,i,r,a)<l&&this.objects[h].splice(o,1)}this.loadObjects(),currentBuildingLevel.verified=!1};let imgs={},fonts={};function waitingForFileCount(){background(0),push(),textAlign(CENTER),fill(255),textSize(50),text("Locating Images to Load...",width/2,height/2),pop(),waitingForFileCount.isWaiting||(fileLoader.loadAll(),fileLoader.isWaiting=!1)}function loadFiles(){fileLoader.run()}waitingForFileCount.isWaiting=!0;let fileLoader={loaded:0,loadProgress:0,needed:0,neededTypes:0,loadIndex:0,loading:"animations",typeIndex:0,counter:0,timeNeeded:0,order:["animations","fonts","images"],paths:{fonts:[],images:[],animations:[]},isWaiting:!0,onLoad:function(t){fileLoader.loaded++},failed:function(t){console.warn("File didn't load. Error was: "+t+"\nContinuing"),fileLoader.onLoad()},loadOne:function(){if(this.loadIndex>=this.paths[this.loading].length){if(this.loadIndex=0,this.typeIndex++,this.typeIndex>=this.neededTypes)return!0;this.loading=this.order[this.typeIndex]}let t,i,e,s,h="fonts"==this.loading?fonts:imgs,o="animations"==this.loading?loadAnimation:"images"==this.loading?loadImage:loadFont;return t=this.paths[this.loading][this.loadIndex],name=this.paths.names[this.loading][this.loadIndex],"animations"==this.loading?(i=t[1],e=t[2]):(i=t,e=fileLoader.onLoad,s=fileLoader.failed),h[name]=s?o(i,e,s):o(i,e),"animations"==this.loading&&(this.onLoad(),h[name].frameDelay=t[0]||4),this.loadIndex++,!1},loadAll:function(){frameRate(30),loadSpecial();do{}while(!this.loadOne())},update:function(){this.loadProgress=min(this.loadProgress+.01,this.loaded/this.needed),this.loaded<this.needed?(this.loadProgress=this.loaded/this.needed,this.counter++):0==this.timeNeeded?(this.timeNeeded=this.counter,this.counter=0):(this.counter++,this.loadProgress=this.counter/this.timeNeeded),this.loadProgress>=1&&(frameRate(60),game.continue(!0))},display:function(){background(0),push(),textAlign(CENTER),fill(255),textSize(50),text("Loading "+this.loading+"...",width/2,height/2),stroke(255),strokeWeight(5),rect(width/2-200,height/2+50,400*this.loadProgress,50,10),push(),noFill(),rect(width/2-200,height/2+50,400,50,10),pop(),pop()},run:function(){this.isWaiting?waitingForFileCount():(this.update(),this.display())}};function loadSpecial(){loadAnimation(),imgs.explosion=Array(11);let t="0";for(var i=0;i<imgs.explosion.length;i++)i>9&&(t=""),imgs.explosion[i]=loadImage("/imgs/space/explosion/"+t+i+".png");imgs.buildings=Array(7);for(i=0;i<imgs.buildings.length;i++)imgs.buildings[i]=loadImage("/imgs/earth/buildings/0"+i+".png");imgs.players=Array(5);for(i=0;i<imgs.players.length;i++){var e=i;0==i&&(e=""),imgs.players[i]=loadImage("/imgs/earth/player/player"+e+".png")}}function drawAnimation(t,i,e,s,h){if(!t)return console.warn("No animation provided");push(),translate(i,e),scale(s/t.getWidth(),h/t.getHeight()),animation(t,0,0),pop()}function RunBuilding(t,i,e,s){this.x=t,this.y=runGround.y-e,this.z=i,this.vx=1/this.z,this.img=imgs.buildings[s],this.w=e*this.img.width/this.img.height,this.h=e}function BuildBuilding(t,i,e,s){RunBuilding.call(this,t,i,e,s),this.y=height-e,this.vx*=bGame.scaleFactor}function RunCar(t){this.x=t,this.img=imgs.brokenCar,this.w=2*runObstacleWidth,this.h=this.w*this.img.height/this.img.width,this.y=runGround.y-this.h}function RunCloud(t){this.x=t,this.y=random(60,120),this.vx=random(-3,3),this.z=random(1.5,4),this.zvx=1/this.z,this.img=imgs.cloud.clone(),this.w=random(230,350),this.h=this.w*this.img.getHeight()/this.img.getWidth()}function RunGround(){this.y=0,this.h=100,this.particles=[]}$.getJSON("/scripts/files.json",function(t){for(var i in fileLoader.paths=t,t)if("names"!=i)for(var e in t[i])fileLoader.needed++;for(var i in t.names)fileLoader.neededTypes++;waitingForFileCount.isWaiting=!1}),RunBuilding.prototype.update=function(t){this.x-=this.vx*(t.ptransX-t.transX),this.x+this.w+10<0?this.x+=width+this.w+15:this.x-10>width&&(this.x-=width+this.w+15)},RunBuilding.prototype.display=function(){push(),image(this.img,this.x,this.y,this.w,this.h),pop()},RunBuilding.prototype.run=function(t){t&&this.update(t),this.display()},BuildBuilding.prototype=Object.create(RunBuilding.prototype),RunCar.prototype.display=function(){image(this.img,this.x,this.y,this.w,this.h)},RunCar.prototype.collide=function(t){let i=abs(t.vx),e=abs(t.vy);t.x+t.w+i>this.x&&t.x-i<this.x+this.w&&t.y+t.h+e>this.y&&(t.y+t.h-2*e-1<this.y&&(t.y=min(t.y,this.y-t.h),t.vy=min(t.vy,0),t.grounded=!0),t.x+t.w+i>this.x&&t.x+t.w<=this.x+i&&(t.vx=constrain(t.vx,-100,0),t.x=this.x-t.w))},RunCar.prototype.run=function(t){var i=this.x+runPlayer.transX;i+runPlayer.vx+this.w>0&&i-runPlayer.vx<width&&(this.collide(t),this.display())},RunCloud.prototype.update=function(t){this.x-=this.zvx*(t.ptransX-t.transX)+this.vx,this.x+this.w+10<0?this.x+=width+this.w+15:this.x-10>width&&(this.x-=width+this.w+15)},RunCloud.prototype.display=function(){push(),drawAnimation(this.img,this.x,this.y,this.w,this.h),pop()},RunCloud.prototype.run=function(t){this.update(t),this.display()},RunGround.prototype.init=function(){this.stroke=color(0,160,50),this.strokeWeight=10,this.fill=color(80,50,0),this.y=height-this.h,this.reset()},RunGround.prototype.reset=function(){this.particles=[];for(var t=0;t<width*this.h/5e3;t++)this.particles[t]={x:random(width),y:random(this.h-this.strokeWeight)+this.y+this.strokeWeight,w:random(15,30),sat:random(80,100)}},RunGround.prototype.display=function(){push(),translate(-runPlayer.transX,0),stroke(this.stroke),strokeWeight(this.strokeWeight),fill(this.fill),rect(-25,this.y+this.strokeWeight/2,width+50,this.h+this.strokeWeight),pop(),push(),noStroke();for(var t=0;t<this.particles.length;t++){var i=this.particles[t];fill(i.sat,.8*i.sat,0,100),rect(i.x,i.y,i.w,i.w,5),i.x+i.w<-runPlayer.transX&&(i.x+=2*i.w+width)}pop()};let runGround=new RunGround;function runToRocket(){background(200,225,255);for(var t=0;t<runScenery.length;t++)runScenery[t].run(runPlayer);fill(255,255,255,60),rect(0,0,width,height),push(),translate(runPlayer.transX,0);for(t=0;t<runSigns.length;t++)runSigns[t].display(runPlayer);runPlayer.run(),runGround.display();for(t=0;t<runObstacles.length;t++)runObstacles[t].run(runPlayer);pop()}function RunNext(t){this.x=t}runToRocket.init=function(){loadRun.init()},runToRocket.reload=function(){loadRun.reload()},runToRocket.reset=function(){loadRun.reset()},RunNext.prototype.collide=function(t){t.x>this.x&&(t.controlTrans=!1,t.x>this.x+width&&loadRun.next())},RunNext.prototype.run=function(t){this.collide(t)};let runObstacles=[],runSigns=[],runScenery=[];var loadRun={level:0,maps:[],current:{},map:"",key:{},buildings:20,clouds:3,hasLoaded:!1,mode:"story",init:function(){if(this.mode="run"==game.currentScene?"story":"freeplay",0==this.maps.length&&"story"==this.mode)return null;runGround.init(),runPlayer.init(),this.txtKey={j:'Click, Space, UP or "W" to jump!',f:"Use the arrow keys to move faster/slower",d:"S/DOWN to duck"},this.key={c:RunCar,x:RunTrash,"^":RunSpike,l:RunStreetLight,"%":RunNext},this.load(),this.hasLoaded=!0},load:function(){return this.maps[this.level]||0==this.maps.length||"story"!=this.mode?!("story"!=this.mode&&!this.current)&&("story"==this.mode&&(this.current=this.maps[this.level]),this.map=this.current.map,this.signs=this.current.txt,void this.reload()):game.continue()},reload:function(){runPlayer.reset(),runGround.reset(),runScenery=[],runSigns=[],runObstacles=[];for(var t=0;t<this.map.length;t++){var i=t*runObstacleWidth,e=this.key[this.map[t]];e&&runObstacles.push(new e(i))}if(this.signs)for(t=0;t<this.signs.length;t++){var s=this.txtKey[this.signs[t]];s&&runSigns.push(new RunSign(t*runObstacleWidth,s))}for(t=0;t<this.buildings;t++)runScenery.push(new RunBuilding(random(-200,width+200),random(2,6),random(400,500),~~random(imgs.buildings.length)));for(t=0;t<this.clouds;t++)runScenery.push(new RunCloud(random(-200,width+200)));runScenery.sort(function(t,i){return i.z-t.z})},next:function(){"story"==this.mode?(this.level++,this.load()):(game.setScene(this.gobackto),this.current.levelBuilderLevel&&(this.current.verified=!0,levelBuilder.save()))},reset:function(){this.level=0}},runObstacleWidth=100;function RunPlayer(t,i){this.x=t,this.ox=t,this.y=i,this.w=50,this.h=this.w,this.slowSpeed=6,this.normalSpeed=10,this.fastSpeed=15,this.vx=this.normalSpeed,this.gvx=this.vx,this.vy=0,this.mvx=5,this.mvy=20,this.transX=0,this.ptransX=this.transX,this.controlTrans=!0,this.grounded=!1,this.ducking=!1,this.walkingFrame=0}$.getJSON("/scripts/runtorocket/runmap.json",function(t){loadRun.maps=t.levels}),RunPlayer.prototype.init=function(){this.img=imgs.player,this.h=this.w*this.img.height/this.img.width,this.y=runGround.y-this.h,this.oy=this.y,this.dh=this.h/2.3,this.oh=this.h},RunPlayer.prototype.collide=function(){this.y+this.h+this.vy>runGround.y&&(this.grounded=!0,this.y=runGround.y-this.h)},RunPlayer.prototype.control=function(){var t=this.y+this.h,i=this.ducking?.6:1;keys[RIGHT_ARROW]||keys.d?this.gvx=this.fastSpeed*i:keys[LEFT_ARROW]||keys.a?this.gvx=this.slowSpeed*i:this.gvx=this.normalSpeed*i,(keys[UP_ARROW]||keys.w||keys[32]||keys[" "]||pressed)&&this.grounded&&this.vy>=0?(this.vy-=16,this.grounded=!1):keys[DOWN_ARROW]||keys.s?this.grounded&&!this.ducking?this.ducking=!0:this.grounded||(this.ducking=!1,this.vy+=.3):this.ducking=!1,this.h=this.ducking?this.dh:this.oh,this.y=t-this.h+1},RunPlayer.prototype.update=function(){this.collide(),this.grounded&&(this.vy=min(0,this.vy)),this.control(),this.grounded?frameCount%10==0&&(this.walkingFrame++,this.walkingFrame=this.walkingFrame%imgs.players.length,this.img=imgs.players[this.walkingFrame]):this.img=imgs.player,this.vy+=.5,this.vy*=.99,this.vy=constrain(this.vy,-this.mvy,this.mvy),this.vx=lerp(this.vx,this.gvx,.1),this.x+=this.vx,this.y+=this.vy,this.y=min(this.y,runGround.y-this.h),this.grounded=!1,this.updateTranslate()},RunPlayer.prototype.updateTranslate=function(t,i){this.ptransX=this.transX,this.viewSpace=t?0:width/3,this.x>this.viewSpace&&this.controlTrans&&(this.transX=-this.x+this.viewSpace),t&&(this.x=constrain(this.x,0,i.length*runObstacleWidth-width),this.x+width>=i.length*runObstacleWidth&&(this.transX=-i.length*runObstacleWidth+width))},RunPlayer.prototype.display=function(){push(),translate(this.x+this.w/2,this.y),this.vx>=0&&scale(-1,1),image(this.img,-this.w/2,0,this.w,this.h),pop()},RunPlayer.prototype.run=function(){this.update(),this.display()},RunPlayer.prototype.reset=function(){this.vx=0,this.vy=0,this.x=this.ox,this.y=this.oy,this.transX=0,this.controlTrans=!0};let runPlayer=new RunPlayer(-100,0);function RunSign(t,i){this.x=t,this.y=50,this.w=500,this.h=250,this.dx=this.x+1e3,this.txt=i,this.padding=50}function RunSpike(t){this.x=t,this.img=imgs.spike,this.w=runObstacleWidth,this.h=round(this.w*this.img.height/this.img.width),this.y=runGround.y-this.h}function RunStreetLight(t){this.img=imgs.streetlight,this.w=runObstacleWidth,this.h=this.w*this.img.height/this.img.width,this.x=t,this.y=runGround.y-this.h,this.ly=this.y+12*this.h/22}function RunTrash(t){this.x=t,this.img=imgs.trash,this.w=runObstacleWidth,this.h=this.w*this.img.height/this.img.width,this.y=runGround.y-this.h}function Button(t,i,e,s,h,o){this.text=t,this.x=i,this.y=e,this.w=s,this.h=h,this.func="function"==typeof o?o:function(){console.log("Placeholder function for button with text "+this.text)}}function ChooseUseSave(){background(0),image(imgs.stars,0,0,width,height),push(),translate(200,200),rotate(-45);drawAnimation(imgs.rocketOn,0,0,200,200*imgs.rocketOn.height/imgs.rocketOn.width),pop(),fill(0,0,0,100),rect(0,0,width,height),push(),noStroke(),textSize(50),fill(255),textAlign(CENTER,TOP),textFont(fonts.londrina),text("Would you like to start over, or resume your current game?",20,50,width-40,300),pop(),push(),fill(0,0,0,100),stroke(200),strokeWeight(5),textFont(fonts.londrina),textSize(50);var t=ChooseUseSave;t.resume.draw(),t.restart.draw(),textSize(25),t.alwaysResume.draw(),t.alwaysRestart.draw(),t.back.draw(),pop()}function Home(){background(0),image(imgs.stars,0,0,width,height),push(),translate(200,200),rotate(-45);drawAnimation(imgs.rocketOn,0,0,200,200*imgs.rocketOn.height/imgs.rocketOn.width),pop(),fill(0,0,0,100),rect(0,0,width,height),push(),noStroke(),textSize(80),fill(200),textAlign(CENTER,BOTTOM),textFont(fonts.bladerunner),text("Escape From",width/2,height/2-150),fill(255),strokeWeight(1),stroke(255),textAlign(CENTER,TOP),textSize(120),textFont(fonts.arcade),text("EARTH",width/2,height/2-150),pop(),push(),fill(0,0,0,100),stroke(200),strokeWeight(5),textFont(fonts.londrina),textSize(50),Home.play.draw(),textSize(25),Home.build.draw(),Home.community.draw(),localStorage.saves&&Home.load.draw(),pop()}RunSign.prototype.display=function(t){t.x>this.x&&this.x<this.dx&&(this.x+=t.vx),push(),image(imgs.woodsign,this.x,this.y,this.w,this.h),fill(0),noStroke(),textSize(40),textFont(fonts.pixel),text(this.txt,this.x+this.padding,this.y+this.padding,this.w-2*this.padding,this.h-2*this.padding),pop()},RunSpike.prototype.run=function(t){var i=this.x+runPlayer.transX;i+runPlayer.vx+this.w>0&&i-runPlayer.vx<width&&(this.display(),this.collide(t))},RunSpike.prototype.collide=function(t){function i(){loadRun.reload()}t.x+t.w>this.x&&t.x<this.x+this.w&&t.y+t.h>this.y&&t.y<this.y+this.h&&(t.x+t.w<this.x+this.w/2?t.y+t.h>map(t.x+t.w,this.x,this.x+this.w/2,this.y+this.h,this.y)&&i():t.x>this.x+this.w/2?t.y+t.h>map(t.x,this.x+this.w/2,this.x+this.w,this.y,this.y+this.h)&&i():i())},RunSpike.prototype.display=function(){push(),translate(this.x,this.y),image(this.img,0,0,this.w,this.h),pop()},RunStreetLight.prototype.collide=function(t){abs(t.vx);let i=abs(t.vy);t.x+t.w>this.x&&t.x<this.x+this.w&&t.y+t.h+i>this.y&&t.y-i<this.ly&&(t.x>this.x+this.w/2?t.y+t.h>map(t.x,this.x+this.w/2,this.x+this.w,this.y,this.ly-this.h/10)&&loadRun.reload():loadRun.reload())},RunStreetLight.prototype.display=function(){image(this.img,this.x,this.y,this.w,this.h)},RunStreetLight.prototype.run=function(t){this.collide(t),this.display()},RunTrash.prototype.display=function(){image(this.img,this.x,this.y,this.w,this.h)},RunTrash.prototype.collide=function(t){let i=abs(t.vx),e=abs(t.vy);t.x+t.w+i>this.x&&t.x-i<this.x+this.w&&t.y+t.h+e>this.y&&(t.y+t.h-2*e-1<this.y&&(t.y=min(t.y,this.y-t.h),t.vy=min(t.vy,0),t.grounded=!0),t.x+t.w+i>this.x&&t.x+t.w<=this.x+i&&(t.vx=constrain(t.vx,-100,0),t.x=this.x-t.w))},RunTrash.prototype.run=function(t){var i=this.x+runPlayer.transX;i+runPlayer.vx+this.w>0&&i-runPlayer.vx<width&&(this.collide(t),this.display())},Button.prototype.check=function(){mouseX>this.x&&mouseY>this.y&&mouseX<this.x+this.w&&mouseY<this.y+this.h&&(cursor(HAND),pressed&&(pressed=!1),clicked&&(clicked=!1,this.func()))},Button.prototype.display=function(t,i){push(),rect(this.x,this.y,this.w,this.h,5),i?(strokeWeight(2),stroke(i)):noStroke(),t?fill(t):fill(255),textAlign(CENTER,CENTER),text(this.text,this.x+this.w/2,this.y+this.h/2),pop()},Button.prototype.draw=function(t,i){this.check(),this.display(t,i)},ChooseUseSave.init=function(){this.resume=new Button("Resume",width/2-300,320,290,100,function(){game.loadProgress()}),this.alwaysResume=new Button("Always Resume",width/2-300,440,290,100,function(){game.loadFirstOnPlay="always",game.loadProgress()}),this.restart=new Button("Restart",width/2+10,320,290,100,function(){game.continue(),game.continue()}),this.alwaysRestart=new Button("Delete Save & Play",width/2+10,440,290,100,function(){delete localStorage.currentSave,game.setScene("home"),game.continue()}),this.back=new Button("Back",width/2-100,560,200,80,function(){game.setScene("home")})},Home.init=function(){Home.play=new Button("Play Story Mode",width/2-200,height/2+10,400,100,function(){return"always"==game.loadFirstOnPlay?game.loadProgress():"never"!=game.loadFirstOnPlay&&localStorage.currentSave?game.setScene("choose"):void game.continue()}),Home.build=new Button("Build Levels",width/2-200,height/2+130,190,100,function(){game.setScene("levelbuilder")}),Home.community=new Button("Play Community\nLevels",width/2+10,height/2+130,190,100,function(){game.setScene("communitylevels")}),Home.load=new Button("Load Save",width/2-150,height/2+250,300,60,function(){game.setScene("loadsaves")})};let hasWon=!!localStorage.hasWon;function LoadSaves(){background(0),image(imgs.stars,0,0,width,height),push(),translate(200,200),rotate(-45);drawAnimation(imgs.rocketOn,0,0,200,200*imgs.rocketOn.height/imgs.rocketOn.width),pop(),fill(0,0,0,100),rect(0,0,width,height),push(),noStroke(),textSize(80),fill(200),textAlign(CENTER,TOP),textFont(fonts.arcade),text("Load Saves",width/2,100),fill(255),strokeWeight(1),stroke(255),textAlign(CENTER,TOP),textSize(50),textFont(fonts.londrina);var t=LoadSaves.displaySave;textSize(20),fill(255,255,255,200),stroke(0),strokeWeight(5),textAlign(CENTER,CENTER);var i=50,e=250;var s=game.retrieveProgress(0,!0);if(s)for(var h=0;h<s.length;h++){t(s[h],i,e,200,70),(i+=210)+200>width-50&&(i=50,e+=120),e+70>height-50&&s.pop()}else game.setScene("home");pop(),push(),fill(0,0,0,100),stroke(200),strokeWeight(5),textFont(fonts.londrina),textSize(25),LoadSaves.HomeBtn.draw(),pop()}function Won(){background(0),image(imgs.stars,0,0,width,height),push(),translate(200,200),rotate(-45);drawAnimation(imgs.rocketOn,0,0,200,200*imgs.rocketOn.height/imgs.rocketOn.width),pop(),fill(0,0,0,100),rect(0,0,width,height),push(),noStroke(),textSize(80),fill(200),textAlign(CENTER,BOTTOM),textFont(fonts.arcade),text("Congratulations!",width/2,height/2-150),fill(255),strokeWeight(1),stroke(255),textAlign(CENTER,TOP),textSize(50),textFont(fonts.londrina),text("You made your own rocket, defeated martians, destroyed the UFO, and safely landed on Venus",100,height/2-150,width-200,200),pop(),fill(0,0,0,200),textSize(40),textFont(fonts.londrina),strokeWeight(5),stroke(240),Won.menu.draw()}LoadSaves.displaySave=function(t,i,e,s,h){rect(i,e,s,h,10),push(),fill(0),stroke(100),strokeWeight(2);var o={run:"Run to Rocket",launchpad:"Rocket Launchpad",build:"Collect Rocket Parts",rocektbuilt:"Build Rocket","fly-moon":"Fly to the Moon",moon:"Moon","fly-mars":"Fly to Mars",marslanding:"Mars Landing",fight:"Mars",leavemars:"Leave Mars","fly-venus":"Fly to Venus",seeufo:"UFO Sighting",ufo:"UFO Fight",landonvenus:"Land on Venus"}[t.scene];"number"==typeof t.data&&(o+=" - "+t.data),t.date&&(o+="\n"+t.date.month+"/"+t.date.day+" - "+t.date.hour+":"+t.date.minute),text(o,i+s/2,e+h/2),pop(),mouseX>i&&mouseX<i+s&&mouseY>e&&mouseY<e+h&&(cursor(HAND),clicked&&game.loadProgress(t))},LoadSaves.init=function(){this.HomeBtn=new Button("Home",10,height-60,100,50,function(){game.setScene("home")})},Won.init=function(){Won.menu=new Button("Menu",width/2-150,height/2+50,300,60,function(){game.setScene("home")}),localStorage.hasWon="true",hasWon=localStorage.hasWon,game.loadFirstOnPlay=!1,localStorage.currentSave=""};